{"componentChunkName":"component---src-templates-article-list-page-template-tsx","path":"/pages/1","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"id":"550f8597-f4a8-5fe3-a7ca-f1392da79702","html":"<p>Cloudflare Workers ä¹Ÿæ˜¯ Cloudflare çš„ä½›å¿ƒæœå‹™ä¹‹ä¸€ï¼Œå¯ä»¥æŠŠ node ç¨‹å¼éƒ¨ç½²åˆ° Cloudflare ä¸Šçš„çœ¾å¤šç¯€é»ï¼Œæ•ˆèƒ½ä¹Ÿä¸ä¿—ï¼Œæ¯å¤©é‚„æœ‰ 100,000 æ¬¡çš„å…è²»å‘¼å«ï¼Œä¹Ÿæ²’æœ‰å†·å•Ÿå‹•çš„å•é¡Œï¼Œå°æµé‡ä¸é«˜çš„ç¶²é ä¾†èªªå®Œå…¨å¤ ç”¨ã€‚å¦å¤–ï¼Œé‚„æœ‰ Workers KV å¯ä»¥ç”¨ä¾†å„²å­˜è³‡æ–™ï¼Œé€™å°±å¯ä»¥å¯«å‡ºç°¡å–®çš„å‹•æ…‹ç¶²é ï¼Œç”šè‡³æ˜¯ä¸€äº›æ›´è¤‡é›œçš„æ‡‰ç”¨ã€‚ä»Šå¤©å°±ä¾†å¯«ä¸€å€‹ Serverless çš„çŸ­ç¶²å€æœå‹™ï¼Œä¸¦æŠŠè³‡æ–™å­˜åœ¨ KV ä¸­ï¼Œå°±æˆ‘ç›®å‰è‡ªå·±æ¸¬è©¦ä¸‹ä¾†ï¼ŒWorkers çš„æ•ˆç‡çœŸçš„æ²’è©±èªªã€‚</p>\n<!--more-->\n<h2>Workers Playground</h2>\n<p>å¦‚æœæƒ³è¦åœ¨ç¶²é ä¸­å…ˆè©¦è©¦çœ‹ Workersï¼Œå¯ä»¥åˆ° <a href=\"https://cloudflareworkers.com/\">Cloudflare Workers</a> é€™å€‹ç¶²ç«™ã€‚</p>\n<p>æœƒæœ‰ä¸€å€‹é è¨­çš„æ¨¡æ¿é•·é€™æ¨£ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fetch\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Fetch and log a given request object\n * @param {Request} request\n */</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Got request\"</span><span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Got response\"</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è®“æˆ‘å€‘å…ˆä¾†ç†è§£ä¸€ä¸‹ç¨‹å¼ç¢¼ã€‚</p>\n<p>å¯ä»¥çœ‹åˆ°ç¨‹å¼æœ‰å…©å€‹ functionï¼Œå…¶ä¸­ <code class=\"language-text\">addEventListener(...)</code> å°±æ˜¯ç¨‹å¼çš„å…¥å£ï¼Œç•¶ Workers æ”¶åˆ° Request ä¹‹å¾Œï¼Œå°±æœƒå‚³å…¥ä½ çµ¦ä»–çš„ functionï¼Œç„¶å¾Œå†æ±ºå®šè¦ç”¨ä»€éº¼ Response å›å‚³åˆ° Clientï¼Œé€™è£¡ä»–å¯«äº†ä¸€å€‹ <code class=\"language-text\">handleRequest</code> çš„ function ä¾†è™•ç†ã€‚æ‰€ä»¥é€™å€‹ç¨‹å¼ç¢¼å¯¦éš›ä¸Šåšçš„äº‹ï¼Œå°±åªæœ‰æŠŠ Request å’Œ Response çµ¦ log å‡ºä¾†ï¼Œå›å‚³åŸæœ¬çš„ç¶²é çš„æ¨£å­ä¸åšä»»ä½•æ›´å‹•ã€‚</p>\n<p>ä¸‹åœ–æ˜¯ Workers åœ¨ Cloudflare ä¸Šçš„é‹è¡Œé †åºï¼Œå¯ä»¥çœ‹åˆ° Workers è¢«æ”¾åœ¨æœ€å¾Œä¸€å€‹ï¼Œä¹Ÿå°±æ˜¯æœ€å¾Œä¸€å€‹æ±ºå®šè¦å›å‚³ä»€éº¼å…§å®¹çµ¦ User çš„åœ°æ–¹ï¼Œä¹Ÿå¯ä»¥ç†è§£ç‚ºå¯ä»¥åœ¨é€™è£¡å°åŸæœ¬çš„ Response åšæœ€å¾Œçš„æ›´å‹•ï¼Œå†å›å‚³çµ¦ Clientã€‚</p>\n<p>æ‰€ä»¥é€™å€‹ Playground ä¸Šå¯ä»¥è¼¸å…¥ä»»æ„çš„ URLï¼Œä¾†é è¦½ä½ çš„ Workers åœ¨ä»»ä½•ä¸€å€‹ç¶²ç«™ä¸Šï¼Œæœƒå° Response åšçš„æ›´å‹•ã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/32bd1508-ba78-4e94-76a0-adec503fe000/public\" alt=\"img\"></p>\n<p>ä¹Ÿå°±æ˜¯èªªå¦‚æœæŠŠç¨‹å¼æ”¹æˆä¸‹é¢é€™æ¨£ï¼Œå°±å¯ä»¥ç™¼ç¾ä»»æ„ç¶²ç«™éƒ½æœƒè®Šæˆ Google çš„æ¨¡æ¨£ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fetch\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">respondWith</span><span class=\"token punctuation\">(</span><span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">handleRequest</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">request</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://google.com\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/d7409a8b-8203-4e23-6491-309a4cc5b500/public\" alt=\"img\"></p>\n<p>ç†è§£å¾Œå°±æœƒç™¼ç¾ï¼Œå…¶å¯¦ Workers å¯ä»¥å°ç¶²é æœ‰å³æ™‚æ€§çš„æ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯èªªå¯ä»¥å°ç¾æœ‰çš„ç¶²é åŠ ä¸Šæ–°åŠŸèƒ½ï¼Œæˆ–æ˜¯åœ¨ä¸æ›´å‹•åŸæœ¬ç¶²é çš„æƒ…æ³ä¸‹å»ä¿® bugã€‚</p>\n<h2>Wrangler</h2>\n<p>Wrangler æ˜¯ç®¡ç† Workers æœƒç”¨åˆ°çš„ cli å·¥å…·ï¼Œé›–ç„¶ä¸å®‰è£ä¹Ÿæ˜¯å¯ä»¥åœ¨ç¶²é ä¸­æ’°å¯« Workers ï¼Œä½†æ˜¯åŠŸèƒ½å°±æœƒå°‘å¾ˆå¤šï¼Œæ‰€ä»¥é‚„æ˜¯å»ºè­°å®‰è£ä¸€ä¸‹ã€‚é€™è£¡æ˜¯å®˜æ–¹çš„ Repo <a href=\"https://github.com/cloudflare/wrangler2\">cloudflare/wrangler2</a>ã€‚</p>\n<p>ç”¨ npm å®‰è£åˆ° Globalï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> i @cloudflare/wrangler -g</code></pre></div>\n<p>é‚„æ˜¯å»ºè­°å»å®˜æ–¹ Repo çœ‹ä¸‹æœ‰æ²’æœ‰å…¶ä»–æ³¨æ„äº‹é …</p>\n<p>å®‰è£å®Œæˆå¾Œè¦ç™»å…¥ Cloudflare å¸³è™Ÿï¼Œ<code class=\"language-text\">wrangler login</code>ï¼Œå†ç”¨ç€è¦½å™¨ç™»å…¥å³å¯ã€‚</p>\n<h2>Init Project</h2>\n<p><code class=\"language-text\">wrangler init &lt;project-name></code> å‰µå»ºæ–°çš„å°ˆæ¡ˆï¼Œé€™ç•¶ä¸­ Wrangler æœƒå•ä¸€äº›å•é¡Œï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ±ºå®šã€‚</p>\n<p>init å®Œæˆå¾Œï¼Œå¯ä»¥çœ‹åˆ°è‡ªå‹•ç”¢ç”Ÿäº†ä¸€äº›æª”æ¡ˆï¼ŒåŸºæœ¬ä¸Šæœƒç”¨åˆ°çš„åªæœ‰ <code class=\"language-text\">wrangler.toml</code> å’Œ <code class=\"language-text\">index.js</code> å…©å€‹æª”æ¡ˆã€‚</p>\n<p>ç¾åœ¨å¯ä»¥å…ˆåœ¨ Terminal ä¸­è¼¸å…¥ <code class=\"language-text\">wrangler dev</code>ï¼Œå°±å¯ä»¥è®“ Workers è·‘åœ¨æœ¬åœ°ã€‚</p>\n<h3>Bug</h3>\n<p>å› ç‚ºæˆ‘çš„ Cloudflare ä¸€æ¬¡ç™»å…¥å¤šå€‹ Userï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ wrangler çš„ <strong>2.0.14</strong> æ™‚å€™æœƒå‡º bug ç›´æ¥é–ƒé€€ï¼Œæˆ‘è§£æ±ºçš„æ–¹å¼æ˜¯ç›´æ¥åœ¨ <code class=\"language-text\">wrangler.toml</code> ä¸­è¼¸å…¥ <code class=\"language-text\">account_id</code> ä¾†é¿å… wrangler æœƒéœ€è¦é¸æ“‡å¸³è™Ÿçš„å•é¡Œã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token key property\">account_id</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"xxxxxxxxxxxxxxx\"</span></code></pre></div>\n<h2>Cloudflare Workers KV</h2>\n<p>çœ‹åˆ°åå­—å–ä½œ KVï¼Œç›´è§€çš„å°±æ˜¯è¡¨ç¤º <code class=\"language-text\">key-value</code> éµå€¼å°ï¼Œç¼ºé»æ˜¯ Key åªèƒ½å°ä¸Šä¸€å€‹ Valueï¼Œä¸èƒ½è¦å·¢ç‹€çš„ Value (åƒæ˜¯ Json é‚£æ¨£)ï¼Œè§£æ±ºçš„æ–¹å¼å…¶å¯¦ä¹Ÿæ˜¯ä¸é›£ï¼Œå¯ä»¥ç›´æ¥åœ¨ Value ä¸­å­˜ä¸Šæ•´çš„ Json æª”æ¡ˆï¼Œä½†åœ¨æœ¬æ–‡ä¸æœƒå¤šåšèªªæ˜ï¼Œå¯ä»¥è‡ªå·±ç ”ç©¶çœ‹çœ‹ã€‚</p>\n<p>å¦å¤– Cloudflare ä¹Ÿæœ‰æåˆ°ï¼ŒKV å­˜å–åœ¨å…¨çƒå¯èƒ½ä¸æ˜¯å³æ™‚æ€§çš„ï¼Œå¥½åƒæ˜¯åªä¿è­‰ 60 ç§’å¾ŒæœƒåŒæ­¥åˆ°æ‰€æœ‰ Serverï¼Œé›–ç„¶æˆ‘è¦ºå¾—æœ€æ…¢æ‡‰è©²ä¹Ÿæ˜¯ 5 å…§ç§’å•¦ï¼Œæˆ‘å¾ä¾†æ²’æœ‰æ„Ÿå—åˆ°å»¶é²éï¼Œä½†å¦‚æœå°å³æ™‚æ€§æœ‰ç–‘æ…®çš„å°ˆæ¡ˆå¯èƒ½ä¹Ÿè¦æ³¨æ„ä¸€ä¸‹ã€‚</p>\n<p>ä¸‹é¢å°±ä¾†å‰µå»ºä¸€å€‹ KV namespaceï¼Œé€™å°±æ˜¯ä¸€å€‹ Database çš„åŸºæœ¬å–®ä½ï¼Œç›®å‰ Cloudflare æ˜¯å…è¨±ä¸€å€‹å¸³è™Ÿæœ‰ 100 å€‹ KV namespaceï¼Œæ‰€ä»¥æ­£å¸¸ä¾†èªªæ‡‰è©²ä¹Ÿä¸ç”¨æ“”å¿ƒæœƒç”¨å®Œã€‚ä¸‹é¢ç”¨ <code class=\"language-text\">URLS</code> ç•¶ä½œ namespace çš„åç¨±ï¼Œå› ç‚ºæˆ‘å€‘æ˜¯è¦å­˜çŸ­ç¶²å€çš„è³‡æ–™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ wrangler kv:namespace create <span class=\"token string\">\"URLS\"</span>\n\nğŸŒ€  Creating namespace with title <span class=\"token string\">\"my-site-MY_KV\"</span>\nâœ¨  Success<span class=\"token operator\">!</span>\nAdd the following to your configuration file:\nkv_namespaces <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> binding <span class=\"token operator\">=</span> <span class=\"token string\">\"URLS\"</span>, <span class=\"token function\">id</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"xxxxxxxxxxxxxxxxxxxxxxx\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>ç„¶å¾Œ wrangler æœƒæœ‰å€‹çµ¦ä½ ä¸€å€‹ binding å’Œ idï¼Œå°±ç›´æ¥è¤‡è£½è²¼ä¸Šåˆ° <code class=\"language-text\">wrangler.tmol</code> ä¸­å³å¯ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token key property\">kv_namespaces</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token key property\">binding</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"URLS\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">id</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"xxxxxxxxxxxxxxxxxxxxxxx\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>å¦‚æœè¦åœ¨ wrangler çš„ dev æ¨¡å¼ä¸­æ¸¬è©¦ KVï¼Œå°±å¤šç”³è«‹ä¸€å€‹ Preview KVï¼Œä¾†é¿å…å°å·²ç¶“ä¸Šç·šçš„æœå‹™é€ æˆå½±éŸ¿ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ wrangler kv:namespace create <span class=\"token string\">\"URLS\"</span> --preview\n\nâ›…ï¸ wrangler <span class=\"token number\">2.0</span>.14\n--------------------\nğŸŒ€ Creating namespace with title <span class=\"token string\">\"URLS\"</span>\nâœ¨ Success<span class=\"token operator\">!</span>\nAdd the following to your configuration <span class=\"token function\">file</span> <span class=\"token keyword\">in</span> your kv_namespaces array:\n<span class=\"token punctuation\">{</span> binding <span class=\"token operator\">=</span> <span class=\"token string\">\"URLS\"</span>, preview_id <span class=\"token operator\">=</span> <span class=\"token string\">\"xxxxxxxxxxxxxxxxxxxx2\"</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>é€™æ¬¡æŠŠ <code class=\"language-text\">preview_id</code> å®¶åœ¨åŸæœ¬çš„ id å¾Œæ–¹å³å¯ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token key property\">kv_namespaces</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> <span class=\"token key property\">binding</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"URLS\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">id</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"xxxxxxxxxxxxxxxxxxxx\"</span><span class=\"token punctuation\">,</span> <span class=\"token key property\">preview_id</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"xxxxxxxxxxxxxxxxxxxx2\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>è¨­å®šå¥½å¾Œï¼Œwrangler æœƒç›´æ¥æŠŠä½ å‰›å‰›å–çš„åå­—ç›´æ¥ç”¨ç’°å¢ƒè®Šæ•¸ (ENV) å‚³å…¥ï¼Œå…·é«”çš„ä½¿ç”¨æ–¹å¼å¯ä»¥ç¹¼çºŒå¾€ä¸‹çœ‹ã€‚</p>\n<h2>Routing</h2>\n<p>ç‚ºäº†æ–¹ä¾¿ç­‰ç­‰æˆ‘å€‘è™•ç†å‚³å…¥çš„ Routingï¼Œæˆ‘å€‘å…ˆä¾†å®‰è£ä¸€å€‹ npm å¥—ä»¶ã€‚å°ä½ æ²’çœ‹éŒ¯ï¼ŒWorkers ä¹Ÿæ˜¯æ”¯æ´ npm å¥—ä»¶çš„ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> itty-router\n\n<span class=\"token function\">npm</span> i itty-router</code></pre></div>\n<p>é€™æ¨£ç­‰ç­‰å°±å¯ä»¥ç”¨ itty-router ä¾†è™•ç†å‚³å…¥çš„ requestã€‚</p>\n<p>æˆ‘å€‘å…ˆå°‡ Handle Request å®Œå…¨ä¸Ÿçµ¦çš„ itty-router ä¾†è™•ç†ï¼Œå°‡ index.js æ”¹æˆä¸‹æ–¹é€™æ¨£ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Router <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"itty-router\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">fetch</span><span class=\"token operator\">:</span> router<span class=\"token punctuation\">.</span>handle<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>å¯ä»¥çœ‹åˆ°ç›´æ¥ export router çš„ handle æ–¹æ³•ï¼Œé€™æ¨£å°±å®Œå…¨æŠŠ Requse äº¤çµ¦ Router ä¾†è™•ç†ã€‚æˆ‘å€‘å…ˆå°‡ root å›å‚³ Hello æ¸¬è©¦çœ‹çœ‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Router <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"itty-router\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> env</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello Workers\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">fetch</span><span class=\"token operator\">:</span> router<span class=\"token punctuation\">.</span>handle<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ç¾åœ¨å¯ä»¥ <code class=\"language-text\">wrangler dev</code> ä¸€ä¸‹ï¼Œç„¶å¾Œåˆ° <code class=\"language-text\">loclahost:8787/</code> çœ‹çœ‹æœƒä¸æœƒå›å‚³ Hello Workersã€‚</p>\n<blockquote>\n<p>ä¹‹å¾Œçš„ç¨‹å¼ç¢¼å°±ä¸å†å®Œæ•´çš„å¯«å‡ºä¾†äº†ï¼Œä½†å°±æ˜¯åœ¨é€™å€‹å¤§æ¡†æ¶ä¸‹æ’°å¯«</p>\n</blockquote>\n<h3>New çŸ­ç¶²å€</h3>\n<p>æˆ‘å€‘å¯«ä¸€å€‹ post æ–¹æ³•ä¾†æ¥æ”¶æ–°çš„ç¶²å€ï¼Œä¸¦å›å‚³ä»–çš„æ–°çŸ­ç¶²å€çµ¦ä»–ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">router<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/new\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> env</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> req<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        <span class=\"token comment\">// å–å¾— POST JSON BODY ä¸¦è½‰æˆ JS ç‰©ä»¶</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> <span class=\"token punctuation\">{</span> url<span class=\"token punctuation\">,</span> len <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> body<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url <span class=\"token operator\">==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">f00</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// JSON æœ‰èª¤ï¼Œå›å‚³ 400 éŒ¯èª¤</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">isValidHttpUrl</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">f00</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"URL is not valid\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// ç¢ºèªæ˜¯å¦ç‚º Http ç¶²å€</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> len <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>len <span class=\"token operator\">&lt;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">f00</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Lenght must be at least 4\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç¢ºèªè‡³å°‘å¤§æ–¼ç­‰æ–¼ 4</span>\n  <span class=\"token keyword\">var</span> s <span class=\"token operator\">=</span> <span class=\"token function\">getRandomString</span><span class=\"token punctuation\">(</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç”¢ç”Ÿè‹±æ–‡äº‚ç¢¼</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">URLS</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// å¾ kv ç¢ºèªæ²’æœ‰é‡è¤‡</span>\n    len<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> æœ‰é‡è¤‡å°‡ len <span class=\"token operator\">+</span><span class=\"token number\">1</span> å¾Œå†ç”¢ç”Ÿæ–°çš„\n    s <span class=\"token operator\">=</span> <span class=\"token function\">getRandomString</span><span class=\"token punctuation\">(</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">await</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">URLS</span><span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å­˜å…¥ kv</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">f00</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span>msg <span class=\"token operator\">?</span> msg <span class=\"token operator\">:</span> <span class=\"token string\">\"BAD REQUEST\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">isValidHttpUrl</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> url<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    url <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">URL</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> url<span class=\"token punctuation\">.</span>protocol <span class=\"token operator\">===</span> <span class=\"token string\">\"http:\"</span> <span class=\"token operator\">||</span> url<span class=\"token punctuation\">.</span>protocol <span class=\"token operator\">===</span> <span class=\"token string\">\"https:\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getRandomString</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">len</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">var</span> s <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> len<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    s <span class=\"token operator\">+=</span> String<span class=\"token punctuation\">.</span><span class=\"token function\">fromCharCode</span><span class=\"token punctuation\">(</span><span class=\"token function\">getRandomInt</span><span class=\"token punctuation\">(</span><span class=\"token number\">26</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">97</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>é€™å€‹ POST è¦åƒä¸€å€‹åƒæ˜¯ä¸‹é¢çš„ json bodyï¼Œåˆ†åˆ¥æœ‰è¦ç¸®çš„ç¶²å€ï¼Œå’Œè¦ç”¢å‡ºçš„çŸ­ç¶²å€é•·åº¦ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://tonypepe.com\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"len\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å¯ä»¥ç™¼ç¾æˆ‘å€‘æ˜¯æ²’æœ‰åšæ¬Šé™æª¢æŸ¥çš„ï¼Œæ‰€ä»¥ä»»ä½•äººåªè¦å° POST <code class=\"language-text\">/new</code>ï¼Œéƒ½å¯ä»¥ç”¢ç”Ÿæ–°çš„çŸ­ç¶²å€ï¼Œä½†æˆ‘è‡ªå·±æ˜¯è¦ºå¾—å•é¡Œä¹Ÿä¸å¤§ï¼Œç•¢ç«Ÿ Cloudflare å°±æ˜¯ä¸€å®¶ ddos é˜²è­·å•†ï¼Œæ‰€ä»¥è¦è¢«æ”»æ“Šåˆ°ä¸€å¤©çš„ä½¿ç”¨é‡éƒ½ç”¨å®Œæ‡‰è©²ä¹Ÿå¾ˆé›£ã€‚æˆ–æ˜¯ä½ æƒ³è¦åšæ¬Šé™æª¢æŸ¥ï¼Œä¹Ÿå¯ä»¥è©¦è‘—å¯¦ä½œçœ‹çœ‹ã€‚</p>\n<h2>Redirect é‡æ–°å°å‘</h2>\n<p>æœ€å¾Œä¸€æ­¥å°±æ˜¯æŠŠçŸ­ç¶²å€é‡æ–°å°å‘åˆ°åŸæœ¬çš„ç¶²å€ï¼Œé€™éƒ¨ä»½å¾ˆç°¡å–®ï¼Œå°±æ˜¯å¾ kv å–å¾—åŸæœ¬çš„ç¶²å€ï¼Œç„¶å¾Œ Response HTTP 303 ä¾†åšé‡æ–°å°å‘ï¼Œå–ä¸åˆ° value å°±çµ¦ 404ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">router<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/:path\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> env</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> env<span class=\"token punctuation\">.</span><span class=\"token constant\">URLS</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url <span class=\"token operator\">==</span> <span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"NOT FOUND\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">404</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Response</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> <span class=\"token number\">303</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  response<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Location\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Publish</h2>\n<p><code class=\"language-text\">wrangler publish</code> å°±å¯ä»¥æŠŠç¨‹å¼ç¢¼éƒ¨ç½²åˆ°å…¨çƒçš„ Cloudflare ç¯€é»ï¼Œå¦‚æœæ²’æœ‰è‡ªå·±ç¶²åŸŸï¼ŒCloudflare ä¹Ÿæœƒçµ¦ä½ ä¸€å€‹ <code class=\"language-text\">xxx.workers.dev</code> çš„ç¶²åŸŸå…è²»ä½¿ç”¨ï¼Œå¯ä»¥ç¾åœ¨é€™è£¡æ¸¬è©¦çœ‹çœ‹ï¼Œå†æ±ºå®šè¦ä¸è¦æŠŠè‡ªå·±çš„ç¶²åŸŸç¶å®šä¸Šå»ã€‚</p>\n<h2>å¾Œè¨˜</h2>\n<p>é€™ç¯‡ç”¨ä¸åˆ° 100 è¡Œç¨‹å¼ç¢¼ç†Ÿç·´äº† Cloudflare çš„ Serverless æœå‹™ï¼Œå’Œå¯«å‡ºäº†çŸ­ç¶²å€æ‡‰ç”¨ï¼Œè®“æˆ‘å€‘ä¸ç”¨è‡ªå·±æ¶è¨­è‡ªå·±çš„ Server å°±å¯ä»¥æœ‰å‹•æ…‹ç¶²é çš„åŠŸèƒ½ã€‚æˆ‘é‚„çœ‹åˆ°å®˜æ–¹çš„æ–‡ä»¶ä¸­å¯ä»¥æŠŠ Response åŠ ä¸Š Cors çš„æ¨™é ­ï¼Œè®“åŸæœ¬ä¸å…è¨±è·¨ç«™å­˜å–çš„ api å¯ä»¥è·¨ç«™å­˜å–ï¼Œé›–ç„¶å¾ˆä¸é“å¾·ï¼Œä½†æ˜¯æˆ‘å–œæ­¡ã€‚æˆ‘è‡ªå·±é‚„æƒ³åˆ°å¯ä»¥å°åŸæœ¬çš„éœæ…‹ç¶²é åŠ ä¸Šé™åˆ¶å­˜å–çš„åŠŸèƒ½ï¼Œæˆ–æ˜¯ç¶²é æœ‰èª¤ç›´æ¥æŠŠç¶²é å…ˆå°å‘ 404ï¼Œé€™éƒ½æ˜¯å¾ˆæœ‰è¶£çš„æ‡‰ç”¨ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±ç™¼æ®çœ‹çœ‹ã€‚</p>\n<p>å¦‚æœè¦å®Œæ•´ç¨‹å¼ç¢¼ï¼š<a href=\"https://gist.github.com/TonyPepeBear/f435dae11b83fc2626a49a6b3cc9848b\">Gist</a></p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://developers.cloudflare.com/workers/\">Cloudflare Workers documentation</a></li>\n</ul>","rawMarkdownBody":"\nCloudflare Workers ä¹Ÿæ˜¯ Cloudflare çš„ä½›å¿ƒæœå‹™ä¹‹ä¸€ï¼Œå¯ä»¥æŠŠ node ç¨‹å¼éƒ¨ç½²åˆ° Cloudflare ä¸Šçš„çœ¾å¤šç¯€é»ï¼Œæ•ˆèƒ½ä¹Ÿä¸ä¿—ï¼Œæ¯å¤©é‚„æœ‰ 100,000 æ¬¡çš„å…è²»å‘¼å«ï¼Œä¹Ÿæ²’æœ‰å†·å•Ÿå‹•çš„å•é¡Œï¼Œå°æµé‡ä¸é«˜çš„ç¶²é ä¾†èªªå®Œå…¨å¤ ç”¨ã€‚å¦å¤–ï¼Œé‚„æœ‰ Workers KV å¯ä»¥ç”¨ä¾†å„²å­˜è³‡æ–™ï¼Œé€™å°±å¯ä»¥å¯«å‡ºç°¡å–®çš„å‹•æ…‹ç¶²é ï¼Œç”šè‡³æ˜¯ä¸€äº›æ›´è¤‡é›œçš„æ‡‰ç”¨ã€‚ä»Šå¤©å°±ä¾†å¯«ä¸€å€‹ Serverless çš„çŸ­ç¶²å€æœå‹™ï¼Œä¸¦æŠŠè³‡æ–™å­˜åœ¨ KV ä¸­ï¼Œå°±æˆ‘ç›®å‰è‡ªå·±æ¸¬è©¦ä¸‹ä¾†ï¼ŒWorkers çš„æ•ˆç‡çœŸçš„æ²’è©±èªªã€‚\n\n<!--more-->\n\n## Workers Playground\n\nå¦‚æœæƒ³è¦åœ¨ç¶²é ä¸­å…ˆè©¦è©¦çœ‹ Workersï¼Œå¯ä»¥åˆ° [Cloudflare Workers](https://cloudflareworkers.com/) é€™å€‹ç¶²ç«™ã€‚\n\næœƒæœ‰ä¸€å€‹é è¨­çš„æ¨¡æ¿é•·é€™æ¨£ï¼š\n\n```js\naddEventListener(\"fetch\", (event) => {\n  event.respondWith(handleRequest(event.request));\n});\n\n/**\n * Fetch and log a given request object\n * @param {Request} request\n */\nasync function handleRequest(request) {\n  console.log(\"Got request\", request);\n  const response = await fetch(request);\n  console.log(\"Got response\", response);\n  return response;\n}\n```\n\nè®“æˆ‘å€‘å…ˆä¾†ç†è§£ä¸€ä¸‹ç¨‹å¼ç¢¼ã€‚\n\nå¯ä»¥çœ‹åˆ°ç¨‹å¼æœ‰å…©å€‹ functionï¼Œå…¶ä¸­ `addEventListener(...)` å°±æ˜¯ç¨‹å¼çš„å…¥å£ï¼Œç•¶ Workers æ”¶åˆ° Request ä¹‹å¾Œï¼Œå°±æœƒå‚³å…¥ä½ çµ¦ä»–çš„ functionï¼Œç„¶å¾Œå†æ±ºå®šè¦ç”¨ä»€éº¼ Response å›å‚³åˆ° Clientï¼Œé€™è£¡ä»–å¯«äº†ä¸€å€‹ `handleRequest` çš„ function ä¾†è™•ç†ã€‚æ‰€ä»¥é€™å€‹ç¨‹å¼ç¢¼å¯¦éš›ä¸Šåšçš„äº‹ï¼Œå°±åªæœ‰æŠŠ Request å’Œ Response çµ¦ log å‡ºä¾†ï¼Œå›å‚³åŸæœ¬çš„ç¶²é çš„æ¨£å­ä¸åšä»»ä½•æ›´å‹•ã€‚\n\nä¸‹åœ–æ˜¯ Workers åœ¨ Cloudflare ä¸Šçš„é‹è¡Œé †åºï¼Œå¯ä»¥çœ‹åˆ° Workers è¢«æ”¾åœ¨æœ€å¾Œä¸€å€‹ï¼Œä¹Ÿå°±æ˜¯æœ€å¾Œä¸€å€‹æ±ºå®šè¦å›å‚³ä»€éº¼å…§å®¹çµ¦ User çš„åœ°æ–¹ï¼Œä¹Ÿå¯ä»¥ç†è§£ç‚ºå¯ä»¥åœ¨é€™è£¡å°åŸæœ¬çš„ Response åšæœ€å¾Œçš„æ›´å‹•ï¼Œå†å›å‚³çµ¦ Clientã€‚\n\næ‰€ä»¥é€™å€‹ Playground ä¸Šå¯ä»¥è¼¸å…¥ä»»æ„çš„ URLï¼Œä¾†é è¦½ä½ çš„ Workers åœ¨ä»»ä½•ä¸€å€‹ç¶²ç«™ä¸Šï¼Œæœƒå° Response åšçš„æ›´å‹•ã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/32bd1508-ba78-4e94-76a0-adec503fe000/public)\n\nä¹Ÿå°±æ˜¯èªªå¦‚æœæŠŠç¨‹å¼æ”¹æˆä¸‹é¢é€™æ¨£ï¼Œå°±å¯ä»¥ç™¼ç¾ä»»æ„ç¶²ç«™éƒ½æœƒè®Šæˆ Google çš„æ¨¡æ¨£ã€‚\n\n```js\naddEventListener(\"fetch\", (event) => {\n  event.respondWith(handleRequest(event.request));\n});\n\nasync function handleRequest(request) {\n  const response = await fetch(\"https://google.com\");\n  return response;\n}\n```\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/d7409a8b-8203-4e23-6491-309a4cc5b500/public)\n\nç†è§£å¾Œå°±æœƒç™¼ç¾ï¼Œå…¶å¯¦ Workers å¯ä»¥å°ç¶²é æœ‰å³æ™‚æ€§çš„æ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯èªªå¯ä»¥å°ç¾æœ‰çš„ç¶²é åŠ ä¸Šæ–°åŠŸèƒ½ï¼Œæˆ–æ˜¯åœ¨ä¸æ›´å‹•åŸæœ¬ç¶²é çš„æƒ…æ³ä¸‹å»ä¿® bugã€‚\n\n## Wrangler\n\nWrangler æ˜¯ç®¡ç† Workers æœƒç”¨åˆ°çš„ cli å·¥å…·ï¼Œé›–ç„¶ä¸å®‰è£ä¹Ÿæ˜¯å¯ä»¥åœ¨ç¶²é ä¸­æ’°å¯« Workers ï¼Œä½†æ˜¯åŠŸèƒ½å°±æœƒå°‘å¾ˆå¤šï¼Œæ‰€ä»¥é‚„æ˜¯å»ºè­°å®‰è£ä¸€ä¸‹ã€‚é€™è£¡æ˜¯å®˜æ–¹çš„ Repo [cloudflare/wrangler2](https://github.com/cloudflare/wrangler2)ã€‚\n\nç”¨ npm å®‰è£åˆ° Globalï¼š\n\n```bash\nnpm i @cloudflare/wrangler -g\n```\n\né‚„æ˜¯å»ºè­°å»å®˜æ–¹ Repo çœ‹ä¸‹æœ‰æ²’æœ‰å…¶ä»–æ³¨æ„äº‹é …\n\nå®‰è£å®Œæˆå¾Œè¦ç™»å…¥ Cloudflare å¸³è™Ÿï¼Œ`wrangler login`ï¼Œå†ç”¨ç€è¦½å™¨ç™»å…¥å³å¯ã€‚\n\n## Init Project\n\n`wrangler init <project-name>` å‰µå»ºæ–°çš„å°ˆæ¡ˆï¼Œé€™ç•¶ä¸­ Wrangler æœƒå•ä¸€äº›å•é¡Œï¼Œå¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚æ±ºå®šã€‚\n\ninit å®Œæˆå¾Œï¼Œå¯ä»¥çœ‹åˆ°è‡ªå‹•ç”¢ç”Ÿäº†ä¸€äº›æª”æ¡ˆï¼ŒåŸºæœ¬ä¸Šæœƒç”¨åˆ°çš„åªæœ‰ `wrangler.toml` å’Œ `index.js` å…©å€‹æª”æ¡ˆã€‚\n\nç¾åœ¨å¯ä»¥å…ˆåœ¨ Terminal ä¸­è¼¸å…¥ `wrangler dev`ï¼Œå°±å¯ä»¥è®“ Workers è·‘åœ¨æœ¬åœ°ã€‚\n\n### Bug\n\nå› ç‚ºæˆ‘çš„ Cloudflare ä¸€æ¬¡ç™»å…¥å¤šå€‹ Userï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ wrangler çš„ **2.0.14** æ™‚å€™æœƒå‡º bug ç›´æ¥é–ƒé€€ï¼Œæˆ‘è§£æ±ºçš„æ–¹å¼æ˜¯ç›´æ¥åœ¨ `wrangler.toml` ä¸­è¼¸å…¥ `account_id` ä¾†é¿å… wrangler æœƒéœ€è¦é¸æ“‡å¸³è™Ÿçš„å•é¡Œã€‚\n\n```toml\naccount_id = \"xxxxxxxxxxxxxxx\"\n```\n\n## Cloudflare Workers KV\n\nçœ‹åˆ°åå­—å–ä½œ KVï¼Œç›´è§€çš„å°±æ˜¯è¡¨ç¤º `key-value` éµå€¼å°ï¼Œç¼ºé»æ˜¯ Key åªèƒ½å°ä¸Šä¸€å€‹ Valueï¼Œä¸èƒ½è¦å·¢ç‹€çš„ Value (åƒæ˜¯ Json é‚£æ¨£)ï¼Œè§£æ±ºçš„æ–¹å¼å…¶å¯¦ä¹Ÿæ˜¯ä¸é›£ï¼Œå¯ä»¥ç›´æ¥åœ¨ Value ä¸­å­˜ä¸Šæ•´çš„ Json æª”æ¡ˆï¼Œä½†åœ¨æœ¬æ–‡ä¸æœƒå¤šåšèªªæ˜ï¼Œå¯ä»¥è‡ªå·±ç ”ç©¶çœ‹çœ‹ã€‚\n\nå¦å¤– Cloudflare ä¹Ÿæœ‰æåˆ°ï¼ŒKV å­˜å–åœ¨å…¨çƒå¯èƒ½ä¸æ˜¯å³æ™‚æ€§çš„ï¼Œå¥½åƒæ˜¯åªä¿è­‰ 60 ç§’å¾ŒæœƒåŒæ­¥åˆ°æ‰€æœ‰ Serverï¼Œé›–ç„¶æˆ‘è¦ºå¾—æœ€æ…¢æ‡‰è©²ä¹Ÿæ˜¯ 5 å…§ç§’å•¦ï¼Œæˆ‘å¾ä¾†æ²’æœ‰æ„Ÿå—åˆ°å»¶é²éï¼Œä½†å¦‚æœå°å³æ™‚æ€§æœ‰ç–‘æ…®çš„å°ˆæ¡ˆå¯èƒ½ä¹Ÿè¦æ³¨æ„ä¸€ä¸‹ã€‚\n\nä¸‹é¢å°±ä¾†å‰µå»ºä¸€å€‹ KV namespaceï¼Œé€™å°±æ˜¯ä¸€å€‹ Database çš„åŸºæœ¬å–®ä½ï¼Œç›®å‰ Cloudflare æ˜¯å…è¨±ä¸€å€‹å¸³è™Ÿæœ‰ 100 å€‹ KV namespaceï¼Œæ‰€ä»¥æ­£å¸¸ä¾†èªªæ‡‰è©²ä¹Ÿä¸ç”¨æ“”å¿ƒæœƒç”¨å®Œã€‚ä¸‹é¢ç”¨ `URLS` ç•¶ä½œ namespace çš„åç¨±ï¼Œå› ç‚ºæˆ‘å€‘æ˜¯è¦å­˜çŸ­ç¶²å€çš„è³‡æ–™ã€‚\n\n```bash\n$ wrangler kv:namespace create \"URLS\"\n\nğŸŒ€  Creating namespace with title \"my-site-MY_KV\"\nâœ¨  Success!\nAdd the following to your configuration file:\nkv_namespaces = [\n  { binding = \"URLS\", id = \"xxxxxxxxxxxxxxxxxxxxxxx\" }\n]\n```\n\nç„¶å¾Œ wrangler æœƒæœ‰å€‹çµ¦ä½ ä¸€å€‹ binding å’Œ idï¼Œå°±ç›´æ¥è¤‡è£½è²¼ä¸Šåˆ° `wrangler.tmol` ä¸­å³å¯ï¼š\n\n```toml\nkv_namespaces = [\n  { binding = \"URLS\", id = \"xxxxxxxxxxxxxxxxxxxxxxx\" }\n]\n```\n\nå¦‚æœè¦åœ¨ wrangler çš„ dev æ¨¡å¼ä¸­æ¸¬è©¦ KVï¼Œå°±å¤šç”³è«‹ä¸€å€‹ Preview KVï¼Œä¾†é¿å…å°å·²ç¶“ä¸Šç·šçš„æœå‹™é€ æˆå½±éŸ¿ï¼š\n\n```bash\n$ wrangler kv:namespace create \"URLS\" --preview\n\nâ›…ï¸ wrangler 2.0.14\n--------------------\nğŸŒ€ Creating namespace with title \"URLS\"\nâœ¨ Success!\nAdd the following to your configuration file in your kv_namespaces array:\n{ binding = \"URLS\", preview_id = \"xxxxxxxxxxxxxxxxxxxx2\" }\n```\n\né€™æ¬¡æŠŠ `preview_id` å®¶åœ¨åŸæœ¬çš„ id å¾Œæ–¹å³å¯ï¼š\n\n```toml\nkv_namespaces = [\n    { binding = \"URLS\", id = \"xxxxxxxxxxxxxxxxxxxx\", preview_id = \"xxxxxxxxxxxxxxxxxxxx2\" }\n]\n```\n\nè¨­å®šå¥½å¾Œï¼Œwrangler æœƒç›´æ¥æŠŠä½ å‰›å‰›å–çš„åå­—ç›´æ¥ç”¨ç’°å¢ƒè®Šæ•¸ (ENV) å‚³å…¥ï¼Œå…·é«”çš„ä½¿ç”¨æ–¹å¼å¯ä»¥ç¹¼çºŒå¾€ä¸‹çœ‹ã€‚\n\n## Routing\n\nç‚ºäº†æ–¹ä¾¿ç­‰ç­‰æˆ‘å€‘è™•ç†å‚³å…¥çš„ Routingï¼Œæˆ‘å€‘å…ˆä¾†å®‰è£ä¸€å€‹ npm å¥—ä»¶ã€‚å°ä½ æ²’çœ‹éŒ¯ï¼ŒWorkers ä¹Ÿæ˜¯æ”¯æ´ npm å¥—ä»¶çš„ï¼š\n\n```bash\nyarn add itty-router\n\nnpm i itty-router\n```\n\né€™æ¨£ç­‰ç­‰å°±å¯ä»¥ç”¨ itty-router ä¾†è™•ç†å‚³å…¥çš„ requestã€‚\n\næˆ‘å€‘å…ˆå°‡ Handle Request å®Œå…¨ä¸Ÿçµ¦çš„ itty-router ä¾†è™•ç†ï¼Œå°‡ index.js æ”¹æˆä¸‹æ–¹é€™æ¨£ï¼š\n\n```js\nimport { Router } from \"itty-router\";\n\nconst router = Router();\n\nexport default {\n  fetch: router.handle,\n};\n```\n\nå¯ä»¥çœ‹åˆ°ç›´æ¥ export router çš„ handle æ–¹æ³•ï¼Œé€™æ¨£å°±å®Œå…¨æŠŠ Requse äº¤çµ¦ Router ä¾†è™•ç†ã€‚æˆ‘å€‘å…ˆå°‡ root å›å‚³ Hello æ¸¬è©¦çœ‹çœ‹ï¼š\n\n```js\nimport { Router } from \"itty-router\";\n\nconst router = Router();\n\nrouter.get(\"/\", async (req, env) => {\n  return new Response(\"Hello Workers\", {\n    status: 200,\n  });\n});\n\nexport default {\n  fetch: router.handle,\n};\n```\n\nç¾åœ¨å¯ä»¥ `wrangler dev` ä¸€ä¸‹ï¼Œç„¶å¾Œåˆ° `loclahost:8787/` çœ‹çœ‹æœƒä¸æœƒå›å‚³ Hello Workersã€‚\n\n> ä¹‹å¾Œçš„ç¨‹å¼ç¢¼å°±ä¸å†å®Œæ•´çš„å¯«å‡ºä¾†äº†ï¼Œä½†å°±æ˜¯åœ¨é€™å€‹å¤§æ¡†æ¶ä¸‹æ’°å¯«\n\n### New çŸ­ç¶²å€\n\næˆ‘å€‘å¯«ä¸€å€‹ post æ–¹æ³•ä¾†æ¥æ”¶æ–°çš„ç¶²å€ï¼Œä¸¦å›å‚³ä»–çš„æ–°çŸ­ç¶²å€çµ¦ä»–ã€‚\n\n```js\nrouter.post(\"/new\", async (req, env) => {\n  const body = await req.json();        // å–å¾— POST JSON BODY ä¸¦è½‰æˆ JS ç‰©ä»¶\n  console.log(JSON.stringify(body));\n  var { url, len } = body;\n  if (url == undefined) return f00(\"\"); // JSON æœ‰èª¤ï¼Œå›å‚³ 400 éŒ¯èª¤\n  if (!isValidHttpUrl(url)) return f00(\"URL is not valid\");  // ç¢ºèªæ˜¯å¦ç‚º Http ç¶²å€\n  if (len == undefined) len = 5;\n  if (len < 4) return f00(\"Lenght must be at least 4\"); // ç¢ºèªè‡³å°‘å¤§æ–¼ç­‰æ–¼ 4\n  var s = getRandomString(len); // ç”¢ç”Ÿè‹±æ–‡äº‚ç¢¼\n  while ((await env.URLS.get(s)) != undefined) { // å¾ kv ç¢ºèªæ²’æœ‰é‡è¤‡\n    len++; æœ‰é‡è¤‡å°‡ len +1 å¾Œå†ç”¢ç”Ÿæ–°çš„\n    s = getRandomString(len);\n  }\n  await env.URLS.put(s, url); // å­˜å…¥ kv\n  return new Response(s);\n});\n\nconst f00 = (msg) => new Response(msg ? msg : \"BAD REQUEST\", { status: 400 });\n\nfunction isValidHttpUrl(string) {\n  let url;\n  try {\n    url = new URL(string);\n  } catch (_) {\n    return false;\n  }\n  return url.protocol === \"http:\" || url.protocol === \"https:\";\n}\n\nfunction getRandomString(len) {\n  var s = \"\";\n  for (let i = 0; i < len; i++) {\n    s += String.fromCharCode(getRandomInt(26) + 97);\n  }\n  return s;\n}\n```\n\né€™å€‹ POST è¦åƒä¸€å€‹åƒæ˜¯ä¸‹é¢çš„ json bodyï¼Œåˆ†åˆ¥æœ‰è¦ç¸®çš„ç¶²å€ï¼Œå’Œè¦ç”¢å‡ºçš„çŸ­ç¶²å€é•·åº¦ï¼š\n\n```json\n{\n  \"url\": \"https://tonypepe.com\",\n  \"len\": 3\n}\n```\n\nå¯ä»¥ç™¼ç¾æˆ‘å€‘æ˜¯æ²’æœ‰åšæ¬Šé™æª¢æŸ¥çš„ï¼Œæ‰€ä»¥ä»»ä½•äººåªè¦å° POST `/new`ï¼Œéƒ½å¯ä»¥ç”¢ç”Ÿæ–°çš„çŸ­ç¶²å€ï¼Œä½†æˆ‘è‡ªå·±æ˜¯è¦ºå¾—å•é¡Œä¹Ÿä¸å¤§ï¼Œç•¢ç«Ÿ Cloudflare å°±æ˜¯ä¸€å®¶ ddos é˜²è­·å•†ï¼Œæ‰€ä»¥è¦è¢«æ”»æ“Šåˆ°ä¸€å¤©çš„ä½¿ç”¨é‡éƒ½ç”¨å®Œæ‡‰è©²ä¹Ÿå¾ˆé›£ã€‚æˆ–æ˜¯ä½ æƒ³è¦åšæ¬Šé™æª¢æŸ¥ï¼Œä¹Ÿå¯ä»¥è©¦è‘—å¯¦ä½œçœ‹çœ‹ã€‚\n\n## Redirect é‡æ–°å°å‘\n\næœ€å¾Œä¸€æ­¥å°±æ˜¯æŠŠçŸ­ç¶²å€é‡æ–°å°å‘åˆ°åŸæœ¬çš„ç¶²å€ï¼Œé€™éƒ¨ä»½å¾ˆç°¡å–®ï¼Œå°±æ˜¯å¾ kv å–å¾—åŸæœ¬çš„ç¶²å€ï¼Œç„¶å¾Œ Response HTTP 303 ä¾†åšé‡æ–°å°å‘ï¼Œå–ä¸åˆ° value å°±çµ¦ 404ã€‚\n\n```js\nrouter.get(\"/:path\", async (req, env) => {\n  const { params } = req;\n  const url = await env.URLS.get(params.path.toLowerCase());\n  if (url == undefined) return new Response(\"NOT FOUND\", { status: 404 });\n  const response = new Response(\"\", { status: 303 });\n  response.headers.append(\"Location\", url);\n  return response;\n});\n```\n\n## Publish\n\n`wrangler publish` å°±å¯ä»¥æŠŠç¨‹å¼ç¢¼éƒ¨ç½²åˆ°å…¨çƒçš„ Cloudflare ç¯€é»ï¼Œå¦‚æœæ²’æœ‰è‡ªå·±ç¶²åŸŸï¼ŒCloudflare ä¹Ÿæœƒçµ¦ä½ ä¸€å€‹ `xxx.workers.dev` çš„ç¶²åŸŸå…è²»ä½¿ç”¨ï¼Œå¯ä»¥ç¾åœ¨é€™è£¡æ¸¬è©¦çœ‹çœ‹ï¼Œå†æ±ºå®šè¦ä¸è¦æŠŠè‡ªå·±çš„ç¶²åŸŸç¶å®šä¸Šå»ã€‚\n\n## å¾Œè¨˜\n\né€™ç¯‡ç”¨ä¸åˆ° 100 è¡Œç¨‹å¼ç¢¼ç†Ÿç·´äº† Cloudflare çš„ Serverless æœå‹™ï¼Œå’Œå¯«å‡ºäº†çŸ­ç¶²å€æ‡‰ç”¨ï¼Œè®“æˆ‘å€‘ä¸ç”¨è‡ªå·±æ¶è¨­è‡ªå·±çš„ Server å°±å¯ä»¥æœ‰å‹•æ…‹ç¶²é çš„åŠŸèƒ½ã€‚æˆ‘é‚„çœ‹åˆ°å®˜æ–¹çš„æ–‡ä»¶ä¸­å¯ä»¥æŠŠ Response åŠ ä¸Š Cors çš„æ¨™é ­ï¼Œè®“åŸæœ¬ä¸å…è¨±è·¨ç«™å­˜å–çš„ api å¯ä»¥è·¨ç«™å­˜å–ï¼Œé›–ç„¶å¾ˆä¸é“å¾·ï¼Œä½†æ˜¯æˆ‘å–œæ­¡ã€‚æˆ‘è‡ªå·±é‚„æƒ³åˆ°å¯ä»¥å°åŸæœ¬çš„éœæ…‹ç¶²é åŠ ä¸Šé™åˆ¶å­˜å–çš„åŠŸèƒ½ï¼Œæˆ–æ˜¯ç¶²é æœ‰èª¤ç›´æ¥æŠŠç¶²é å…ˆå°å‘ 404ï¼Œé€™éƒ½æ˜¯å¾ˆæœ‰è¶£çš„æ‡‰ç”¨ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±ç™¼æ®çœ‹çœ‹ã€‚\n\nå¦‚æœè¦å®Œæ•´ç¨‹å¼ç¢¼ï¼š[Gist](https://gist.github.com/TonyPepeBear/f435dae11b83fc2626a49a6b3cc9848b)\n\n## Reference\n\n- [Cloudflare Workers documentation](https://developers.cloudflare.com/workers/)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/cf-workers-short-url.md","excerpt":"Cloudflare Workers ä¹Ÿæ˜¯ Cloudflare çš„ä½›å¿ƒæœå‹™ä¹‹ä¸€ï¼Œå¯ä»¥æŠŠ node ç¨‹å¼éƒ¨ç½²åˆ° Cloudflare ä¸Šçš„çœ¾å¤šç¯€é»ï¼Œæ•ˆèƒ½ä¹Ÿä¸ä¿—ï¼Œæ¯å¤©é‚„æœ‰ 100,000 æ¬¡çš„å…è²»å‘¼å«ï¼Œä¹Ÿæ²’æœ‰å†·å•Ÿå‹•çš„å•é¡Œï¼Œå°æµé‡ä¸é«˜çš„ç¶²é ä¾†èªªå®Œå…¨å¤ ç”¨ã€‚å¦å¤–ï¼Œé‚„æœ‰ Workers KV å¯ä»¥ç”¨ä¾†å„²å­˜è³‡æ–™ï¼Œé€™å°±å¯ä»¥å¯«å‡ºç°¡å–®çš„å‹•æ…‹ç¶²é ï¼Œç”šè‡³æ˜¯ä¸€äº›æ›´è¤‡é›œçš„æ‡‰ç”¨ã€‚ä»Šå¤©å°±ä¾†å¯«ä¸€å€‹ Serverless çš„çŸ­ç¶²â€¦","frontmatter":{"title":"ç”¨ Cloudflare Workers æ¶è¨­ Serverless çŸ­ç¶²å€æœå‹™","date":"2022-06-21T09:15:49.000Z","draft":false,"tags":["cloudflare","workers","worker","web","short","url"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/b6cf9d30-1028-4aa5-c136-0dbc6c098f00/public","description":null}}},{"node":{"id":"1f835006-d336-5140-acce-32c9475d47e1","html":"<p>æœ€è¿‘æŠŠç¶²ç«™å¾ Hugo é·ç§»åˆ° Gatsbyï¼Œé‡åˆ°äº†ä¸€äº›å•é¡Œï¼Œæˆ‘å°±ä¾†ç°¡å–®è¨˜éŒ„ä¸€ä¸‹è§£æ±ºå•é¡Œçš„éç¨‹ï¼Œè€Œä¸”å› ç‚ºæˆ‘å° Node ä¹Ÿä¸æ˜¯å¾ˆç†Ÿï¼Œæ‰€ä»¥ä¸»è¦æ˜¯åœ¨ç•¶ä½œæˆ‘ç·´ç¿’ Node å’Œ Reactã€‚</p>\n<!--more-->\n<h2>Whyï¼Ÿ</h2>\n<ol>\n<li>Hugo å¯¦åœ¨å¾ˆé›£ä½¿ç”¨ Node å¥—ä»¶</li>\n<li>å–®ç´”æƒ³çµ¦è‡ªå·±ä¸€å€‹æ¥è§¸ Node çš„æ©Ÿæœƒ</li>\n</ol>\n<p>è¨±å¤šç¶²é çš„å¥—ä»¶åº«éƒ½æ˜¯ä½¿ç”¨ node é–‹ç™¼çš„ï¼Œä½†å› ç‚º Hugo æ˜¯ç”¨ go é–‹ç™¼ï¼Œé›–ç„¶æœ‰æä¾›å° npm å¥—ä»¶çš„æ”¯æ´ï¼Œä½†æ˜¯é‚„æ˜¯æ²’æœ‰åŸç”Ÿçš„æ–¹ä¾¿ï¼Œåœ¨ç”¨å¥—ä»¶çš„æ™‚å€™å¸¸å¸¸æœƒé‡åˆ°å•é¡Œã€‚æ‰€ä»¥æˆ‘é‚„æ˜¯ä¸‹å®šæ±ºå¿ƒæ›åˆ° Gatsbyï¼Œä¹Ÿå¯ä»¥é †ä¾¿ç†Ÿæ‚‰ä¸€ä¸‹ Reactã€‚å¦å¤–ï¼Œæˆ‘æ˜¯ä½¿ç”¨ TypeScript ä¾†é–‹ç™¼ï¼Œé€™ä¹Ÿæ˜¯æœ‰é»è™å¾…è‡ªå·±ï¼Œä¸éé‚„å¥½é‚„æ˜¯é †åˆ©å®Œæˆï¼Œä¹Ÿå° TS æœ‰å¤šé»èªè­˜ã€‚</p>\n<p>ç›®å‰é‡åˆ°çš„ä¸€å€‹æœ€å¤§çš„ç¼ºé»ï¼Œå¤§æ¦‚å°±æ˜¯ Hugo ç”¢ç”Ÿç¶²é çš„é€Ÿåº¦çœŸçš„è¶…ç´šå¿«ï¼ŒGatsby å› ç‚ºä¾è³´ä¸€å¤§å † npm å¥—ä»¶ï¼Œæ‰€ä»¥æˆ‘åœ¨ Cloudflare Pages ä¸Šçš„å¹³å‡éœ€è¦å¤§ç´„ 5 åˆ†é˜ç¶²é æ‰èƒ½å»ºç½®å¥½ã€‚</p>\n<h2>é‡åˆ°çš„å•é¡Œ</h2>\n<p>ç›®å‰é‡åˆ°çš„ä¸»è¦å•é¡Œå¤§æ¦‚å°±æ˜¯ä¸‹é¢ä¸‰é»ï¼š</p>\n<ol>\n<li>npm build ä¸æˆåŠŸ</li>\n<li>è§€çœ‹æ›´å¤šçš„åŠŸèƒ½</li>\n<li>meilisearch</li>\n</ol>\n<h2>npm to yarn</h2>\n<p>ä¸€é–‹å§‹æˆ‘æ˜¯ä½¿ç”¨ npm ä½œç‚ºå¥—ä»¶ç®¡ç†ï¼Œæˆ‘åœ¨æœ¬æ©Ÿé–‹ç™¼æ™‚éƒ½æ²’æœ‰é‡åˆ°ä»€éº¼å•é¡Œï¼Œç›´åˆ°æˆ‘å¹¾ä¹éƒ½é–‹ç™¼å®Œæˆå¾Œï¼Œæˆ‘å°±å°‡ç¶²é  push åˆ° GitHub ä¸Šï¼ŒGitHub Actions åœ¨ Build æ™‚ä¹Ÿæ²’æœ‰é‡åˆ°å•é¡Œï¼Œç›´åˆ° Cloudflare Pages åœ¨å»ºç½®æ™‚ï¼Œå°±æ˜¯æœƒä¸€ç›´å¤±æ•—ï¼Œæˆ‘ä¹Ÿä¸€ç›´ç¢ºå®š node å’Œ npm ç‰ˆæœ¬è·Ÿæˆ‘æœ¬åœ°çš„ä¸€æ¨£ï¼Œä½†ç„¡è«–å¦‚ä½•å°±æ˜¯å¤±æ•—ï¼Œç›´åˆ°æˆ‘ä¸Šç¶²æŸ¥å¾Œï¼Œæ‰ç™¼ç¾ Gatsby å®˜æ–¹ä¹Ÿæ˜¯å»ºè­°ä½¿ç”¨ yarnï¼Œnpm å¥½åƒæœƒé‡åˆ°å•é¡Œã€‚æˆ‘å°±è©¦è‘— <code class=\"language-text\">yarn</code> ä¸€ä¸‹ï¼Œè®“å°ˆæ¡ˆè‡ªå‹•é·ç§»åˆ° yarnï¼Œå°±æ²’åˆå†å‡ºç¾å•é¡Œäº†ï¼Œå¯¦åœ¨è«åå…¶å¦™ã€‚æ‰€ä»¥ä¹Ÿæ˜¯å»ºè­°å¤§å®¶ä»¥å¾Œè‹¥æœ‰ä½¿ç”¨åˆ° Gatsbyï¼Œé‚„æ˜¯ä½¿ç”¨ yarn æ¯”è¼ƒå¥½ä¸€é»ã€‚</p>\n<h2>è§€çœ‹æ›´å¤š</h2>\n<p>åœ¨ Hugo æ™‚ï¼ŒHugo æ”¯æ´åœ¨ Markdown ä¸­ä½¿ç”¨ <code class=\"language-text\">&lt;!--more--></code> çš„æ¨™ç±¤ä¾†æå–æ¨™ç±¤å‰çš„éƒ¨åˆ†ç•¶ä½œæ–‡ç« æ‘˜è¦ï¼Œç”¨ä¾†é¡¯ç¤ºåœ¨ ListTemplateï¼Œè€Œ Gatsby åªæœ‰æä¾›æå–å‰ n å­—çš„åŠŸèƒ½ã€‚è€Œé€™å°æˆ‘ç¶²é çš„ç¾è§€ç¨‹åº¦å°±æœ‰ä¸€é»ä¸æ–¹ä¾¿ï¼Œå› ç‚ºæˆ‘ Hugo å·²ç¶“ç´¯è¨ˆäº†ä¸å°‘æ–‡ç« ï¼Œè‹¥è¦ç¾åœ¨å†å»ä¸€ç¯‡ç¯‡ä¿®æ”¹ï¼Œä¹Ÿæ˜¯æœƒæœ‰é»éº»ç…©ï¼Œæ‰€ä»¥åªå¥½è‡ªå·±ç¨å¾®ç ”ç©¶ä¸€ä¸‹è¦æ€éº¼è™•ç†ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"md\"><pre class=\"language-md\"><code class=\"language-md\">Hello\n\næ‘˜è¦\n\n<span class=\"token comment\">&lt;!--more--></span>\n\næ­£æ–‡\n\næ­£æ–‡</code></pre></div>\n<p>æˆ‘è™•ç†çš„æ–¹å¼ç°¡å–®æš´åŠ›ï¼Œæˆ‘ç™¼ç¾ Gatsby åœ¨ GraphQL çš„æ™‚å€™ï¼Œå¯ä»¥æ‹¿åˆ° RawMarkdownï¼Œè€Œä¸”é€™å€‹ä¹Ÿæœƒä¿ç•™è¨»è§£ï¼Œæ‰€ä»¥æˆ‘éˆæ©Ÿä¸€å‹•ï¼Œæˆ‘å°±è‡ªå·±ä½¿ç”¨ Node å¥—ä»¶ï¼Œè‡ªå·±è§£æ Markdown ä¸å°±å¥½äº†ï¼Ÿæ‰€ä»¥æˆ‘å°±ç”¨ <code class=\"language-text\">marked</code> å¥—ä»¶ï¼Œå¹«æˆ‘æŠŠ md è½‰æˆ htmlã€‚ç¯„ä¾‹å¤§è‡´å¦‚ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> marked <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"marked\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Summary</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> Props<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> summary <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>rawMarkdownBody<span class=\"token punctuation\">.</span><span class=\"token function\">spllit</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;!--more-->\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div dangerouslaSetSetInnerHTML<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> __html<span class=\"token operator\">:</span> marked<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>summary<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>MeiliSearch</h2>\n<p>æˆ‘åŸæœ¬çš„ Hugo ç¶²é ï¼Œå°±æ˜¯ä½¿ç”¨ MeiliSearch ä¾†ç•¶æˆ‘çš„æœå°‹åŠŸèƒ½ï¼Œå¯ä»¥åƒè€ƒé€™å€‹ <a href=\"/search/tag?tag=meilisearch\">tag</a> ã€‚æ‰€ä»¥ä¸€æ¨£æ˜¯æœƒéœ€è¦ç”¢ç”Ÿä¸€å€‹ <code class=\"language-text\">SearchIndex.json</code>ï¼Œæˆ‘ç›´æ¥åœ¨ <code class=\"language-text\">gatsby-node.ts</code> è£¡çš„ <code class=\"language-text\">noPostBuild</code> æ‰‹å‹•ç”¢ç”Ÿ jsonï¼Œå†ç”¨ <code class=\"language-text\">fs</code> å¯«å…¥æª”æ¡ˆï¼Œç›´æ¥çµ¦å¤§å®¶ç¨‹å¼ç¢¼åƒè€ƒã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> onPostBuild<span class=\"token operator\">:</span> GatsbyNode<span class=\"token punctuation\">[</span><span class=\"token string\">\"onPostBuild\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  graphql<span class=\"token punctuation\">,</span>\n  actions<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> errors<span class=\"token punctuation\">,</span> data <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token generic-function\"><span class=\"token function\">graphql</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>ArticleListData<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>articleGraphql<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// SearchIndex.json</span>\n  <span class=\"token keyword\">const</span> searchArr<span class=\"token operator\">:</span> SearchIndex<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  data<span class=\"token operator\">!</span><span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>allMarkdownRemark<span class=\"token punctuation\">.</span>edges<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> node <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> summary <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>rawMarkdownBody<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"&lt;!--more-->\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span>\n      <span class=\"token string\">\"/posts/\"</span> <span class=\"token operator\">+</span>\n      node<span class=\"token punctuation\">.</span>fileAbsolutePath\n        <span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/posts/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".md\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> miliseconds <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    searchArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      id<span class=\"token operator\">:</span> index<span class=\"token punctuation\">,</span>\n      date<span class=\"token operator\">:</span> miliseconds<span class=\"token punctuation\">,</span>\n      url<span class=\"token operator\">:</span> url<span class=\"token punctuation\">,</span>\n      title<span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span>\n      summary<span class=\"token operator\">:</span> summary<span class=\"token punctuation\">,</span>\n      content<span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>internal<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      tags<span class=\"token operator\">:</span> node<span class=\"token punctuation\">.</span>frontmatter<span class=\"token punctuation\">.</span>tags<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./public/SearchIndex.json\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>searchArr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ç”¢ç”Ÿ Json å¾Œï¼Œæˆ‘ä¸€æ¨£æ˜¯ä½¿ç”¨ GitHub Actions ä¾†è‡ªå‹•æŠŠ Index æ¨åˆ° MeiliSearch Serverã€‚</p>\n<h2>Tag Page</h2>\n<p>å…¶å¯¦ Gatsby æ‡‰è©²ä¹Ÿæ˜¯æœ‰æ–¹æ³•å¯ä»¥ç”¢ç”Ÿ Tag Pageï¼Œä½†æ˜¯å› ç‚ºæˆ‘æƒ³åˆ°è¦ç”¨ Tag Page æ™‚ï¼Œæˆ‘å·²ç¶“å¼„å¥½ MeiliSearch äº†ï¼Œæ‰€ä»¥æˆ‘å°±éˆæ©Ÿä¸€å‹•ï¼Œæƒ³æƒ³æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç›´æ¥ç°¡å–®çš„ä½¿ç”¨ MeiliSearch ä¾†å‹•æ…‹çš„ç”¢ç”Ÿ Tag Page å°±å¥½ï¼Œçµæœé‚„çœŸçš„è¢«æˆ‘å¼„æˆåŠŸäº†ï¼Œå°±ä¾†ç´€éŒ„ä¸€ä¸‹æˆ‘å¤§æ¦‚çš„æ€è·¯ã€‚é›–ç„¶æˆ‘çŸ¥é“é€™å…«æˆä¸æ˜¯ä»€éº¼å¥½æ–¹æ³•ï¼Œä½†æ˜¯ç°¡å–®æš´åŠ›ã€‚</p>\n<p>MeiliSearch å¯ä»¥è¨­å®š <code class=\"language-text\">filterableAttributes</code> çš„å±¬æ€§ï¼Œæ‰€ä»¥æˆ‘æŠŠæˆ‘çš„ Index ä¸­çš„ Tag å±¬æ€§è¨­å®šæˆå¯ä»¥ Filterableï¼Œç„¶å¾Œå†å–å¾—ç¶²å€çš„ Paramsï¼Œæœ€å¾Œå‘ MeiliSearch æœå°‹å¾Œå‹•æ…‹çš„æŠŠçµæœé¡¯ç¤ºåœ¨ç¶²é ä¸Šã€‚ä¹Ÿå¯ä»¥åƒè€ƒ<a href=\"https://docs.meilisearch.com/learn/advanced/filtering_and_faceted_search.html#configuring-filters\">å®˜æ–¹æ–‡ä»¶</a>ã€‚</p>\n<p>é€™æ™‚é‡åˆ°çš„å•é¡Œå°±æ˜¯ Gatsby æ˜¯ Server Side Renderingï¼Œæ‰€ä»¥å–çš„ Params è¦ä½¿ç”¨é¡å¤–çš„ pluginï¼Œæˆ‘æ˜¯ä½¿ç”¨ <code class=\"language-text\">gatsby-plugin-use-query-params</code>ï¼Œå°±å¯ä»¥åƒæ˜¯ React çš„ useState çš„æ–¹å¼ä¾†å–çš„ç¶²å€çš„ Parmã€‚</p>\n<p>ä¹Ÿæ˜¯æä¾›éƒ¨åˆ†çš„ç¨‹å¼ç¢¼çµ¦å¤§å®¶åƒè€ƒï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">SearchTags</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> tag <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> tag<span class=\"token operator\">:</span> StringParam <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å–çš„ Params</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>result<span class=\"token punctuation\">,</span> setResult<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isLoading<span class=\"token punctuation\">,</span> setIsLoading<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  React<span class=\"token punctuation\">.</span><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// åŸ·è¡Œæœå°‹</span>\n    client\n      <span class=\"token punctuation\">.</span><span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gatsby-blog\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">search</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        filter<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"tags=\"</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>tag <span class=\"token operator\">?</span> tag <span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        limit<span class=\"token operator\">:</span> Number<span class=\"token punctuation\">.</span><span class=\"token constant\">MAX_SAFE_INTEGER</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>res<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">setResult</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>hits<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">setIsLoading</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>MainLayout title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"tag: \"</span> <span class=\"token operator\">+</span> tag <span class=\"token operator\">+</span> <span class=\"token string\">\" - TonyPepe\"</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>h1 className<span class=\"token operator\">=</span><span class=\"token string\">\"my-4 bg-white rounded-md py-4 px-6 text-2xl\"</span><span class=\"token operator\">></span>\n          <span class=\"token punctuation\">{</span><span class=\"token string\">\"Tag: \"</span> <span class=\"token operator\">+</span> tag<span class=\"token punctuation\">}</span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>isLoading <span class=\"token operator\">?</span> <span class=\"token operator\">&lt;</span>LoadingChild <span class=\"token operator\">/</span><span class=\"token operator\">></span> <span class=\"token operator\">:</span> <span class=\"token operator\">&lt;</span>ResultClild hits<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>result<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MainLayout<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MeiliSearch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  host<span class=\"token operator\">:</span> <span class=\"token string\">\"https://search.tonypepe.com\"</span><span class=\"token punctuation\">,</span>\n  apiKey<span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>å¾Œç´€</h2>\n<p>Node åœ¨å»ºç½®ä¸Šå¯¦åœ¨æ˜¯å¤ªæ…¢ï¼ŒçœŸçš„æœƒæœ‰ä¸€é»å—ä¸äº†ï¼Œæ¯æ¬¡å…‰æ˜¯è¦ Run èµ· Dev Serverï¼Œå°±è‡³å°‘éœ€è¦ 30 ç§’ï¼Œç›¸æ¯” Hugo å°±ç®—æ˜¯æœ‰è£ä¸€é»é»çš„ npm å¥—ä»¶ï¼Œé‚„æ˜¯åªè¦ 10 ç§’å·¦å³å°±å¯ä»¥é–‹å§‹å¯«ç¶²é äº†ã€‚</p>\n<p>ç•¶ç„¶ï¼Œä½¿ç”¨ Gatsby é–‹ç™¼çš„å¥½è™•ä¹Ÿæ˜¯å¾ˆå¤šï¼Œå¯ä»¥æœ€å¤§åŒ–çš„è‡ªè¨‚ç¶²é çš„é•·ç›¸å’ŒåŠŸèƒ½ï¼Œä¸æœƒè¢« Hugo çš„åŠŸèƒ½é™åˆ¶ä½ï¼Œå¦‚æœç¼ºå°‘äº†ä»€éº¼åŠŸèƒ½ï¼Œéƒ½å¯ä»¥è‡ªå·±ç”¨ js é–‹ç™¼å‡ºä¾†ï¼Œè€Œä¸”åœ¨ä½¿ç”¨ä¸€äº› Web Library å’Œ React çœŸçš„å¤ªæ–¹ä¾¿äº†ã€‚</p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://gatsbyjs.org/\">Gatsby</a></li>\n<li><a href=\"https://docs.meilisearch.com/learn/advanced/filtering_and_faceted_search.html#configuring-filters\">MeiliSearch - Filtering and faceted search</a></li>\n</ul>","rawMarkdownBody":"\næœ€è¿‘æŠŠç¶²ç«™å¾ Hugo é·ç§»åˆ° Gatsbyï¼Œé‡åˆ°äº†ä¸€äº›å•é¡Œï¼Œæˆ‘å°±ä¾†ç°¡å–®è¨˜éŒ„ä¸€ä¸‹è§£æ±ºå•é¡Œçš„éç¨‹ï¼Œè€Œä¸”å› ç‚ºæˆ‘å° Node ä¹Ÿä¸æ˜¯å¾ˆç†Ÿï¼Œæ‰€ä»¥ä¸»è¦æ˜¯åœ¨ç•¶ä½œæˆ‘ç·´ç¿’ Node å’Œ Reactã€‚\n\n<!--more-->\n\n## Whyï¼Ÿ\n\n1. Hugo å¯¦åœ¨å¾ˆé›£ä½¿ç”¨ Node å¥—ä»¶\n2. å–®ç´”æƒ³çµ¦è‡ªå·±ä¸€å€‹æ¥è§¸ Node çš„æ©Ÿæœƒ\n\nè¨±å¤šç¶²é çš„å¥—ä»¶åº«éƒ½æ˜¯ä½¿ç”¨ node é–‹ç™¼çš„ï¼Œä½†å› ç‚º Hugo æ˜¯ç”¨ go é–‹ç™¼ï¼Œé›–ç„¶æœ‰æä¾›å° npm å¥—ä»¶çš„æ”¯æ´ï¼Œä½†æ˜¯é‚„æ˜¯æ²’æœ‰åŸç”Ÿçš„æ–¹ä¾¿ï¼Œåœ¨ç”¨å¥—ä»¶çš„æ™‚å€™å¸¸å¸¸æœƒé‡åˆ°å•é¡Œã€‚æ‰€ä»¥æˆ‘é‚„æ˜¯ä¸‹å®šæ±ºå¿ƒæ›åˆ° Gatsbyï¼Œä¹Ÿå¯ä»¥é †ä¾¿ç†Ÿæ‚‰ä¸€ä¸‹ Reactã€‚å¦å¤–ï¼Œæˆ‘æ˜¯ä½¿ç”¨ TypeScript ä¾†é–‹ç™¼ï¼Œé€™ä¹Ÿæ˜¯æœ‰é»è™å¾…è‡ªå·±ï¼Œä¸éé‚„å¥½é‚„æ˜¯é †åˆ©å®Œæˆï¼Œä¹Ÿå° TS æœ‰å¤šé»èªè­˜ã€‚\n\nç›®å‰é‡åˆ°çš„ä¸€å€‹æœ€å¤§çš„ç¼ºé»ï¼Œå¤§æ¦‚å°±æ˜¯ Hugo ç”¢ç”Ÿç¶²é çš„é€Ÿåº¦çœŸçš„è¶…ç´šå¿«ï¼ŒGatsby å› ç‚ºä¾è³´ä¸€å¤§å † npm å¥—ä»¶ï¼Œæ‰€ä»¥æˆ‘åœ¨ Cloudflare Pages ä¸Šçš„å¹³å‡éœ€è¦å¤§ç´„ 5 åˆ†é˜ç¶²é æ‰èƒ½å»ºç½®å¥½ã€‚\n\n## é‡åˆ°çš„å•é¡Œ\n\nç›®å‰é‡åˆ°çš„ä¸»è¦å•é¡Œå¤§æ¦‚å°±æ˜¯ä¸‹é¢ä¸‰é»ï¼š\n\n1. npm build ä¸æˆåŠŸ\n2. è§€çœ‹æ›´å¤šçš„åŠŸèƒ½\n3. meilisearch\n\n## npm to yarn\n\nä¸€é–‹å§‹æˆ‘æ˜¯ä½¿ç”¨ npm ä½œç‚ºå¥—ä»¶ç®¡ç†ï¼Œæˆ‘åœ¨æœ¬æ©Ÿé–‹ç™¼æ™‚éƒ½æ²’æœ‰é‡åˆ°ä»€éº¼å•é¡Œï¼Œç›´åˆ°æˆ‘å¹¾ä¹éƒ½é–‹ç™¼å®Œæˆå¾Œï¼Œæˆ‘å°±å°‡ç¶²é  push åˆ° GitHub ä¸Šï¼ŒGitHub Actions åœ¨ Build æ™‚ä¹Ÿæ²’æœ‰é‡åˆ°å•é¡Œï¼Œç›´åˆ° Cloudflare Pages åœ¨å»ºç½®æ™‚ï¼Œå°±æ˜¯æœƒä¸€ç›´å¤±æ•—ï¼Œæˆ‘ä¹Ÿä¸€ç›´ç¢ºå®š node å’Œ npm ç‰ˆæœ¬è·Ÿæˆ‘æœ¬åœ°çš„ä¸€æ¨£ï¼Œä½†ç„¡è«–å¦‚ä½•å°±æ˜¯å¤±æ•—ï¼Œç›´åˆ°æˆ‘ä¸Šç¶²æŸ¥å¾Œï¼Œæ‰ç™¼ç¾ Gatsby å®˜æ–¹ä¹Ÿæ˜¯å»ºè­°ä½¿ç”¨ yarnï¼Œnpm å¥½åƒæœƒé‡åˆ°å•é¡Œã€‚æˆ‘å°±è©¦è‘— `yarn` ä¸€ä¸‹ï¼Œè®“å°ˆæ¡ˆè‡ªå‹•é·ç§»åˆ° yarnï¼Œå°±æ²’åˆå†å‡ºç¾å•é¡Œäº†ï¼Œå¯¦åœ¨è«åå…¶å¦™ã€‚æ‰€ä»¥ä¹Ÿæ˜¯å»ºè­°å¤§å®¶ä»¥å¾Œè‹¥æœ‰ä½¿ç”¨åˆ° Gatsbyï¼Œé‚„æ˜¯ä½¿ç”¨ yarn æ¯”è¼ƒå¥½ä¸€é»ã€‚\n\n## è§€çœ‹æ›´å¤š\n\nåœ¨ Hugo æ™‚ï¼ŒHugo æ”¯æ´åœ¨ Markdown ä¸­ä½¿ç”¨ `<!--more-->` çš„æ¨™ç±¤ä¾†æå–æ¨™ç±¤å‰çš„éƒ¨åˆ†ç•¶ä½œæ–‡ç« æ‘˜è¦ï¼Œç”¨ä¾†é¡¯ç¤ºåœ¨ ListTemplateï¼Œè€Œ Gatsby åªæœ‰æä¾›æå–å‰ n å­—çš„åŠŸèƒ½ã€‚è€Œé€™å°æˆ‘ç¶²é çš„ç¾è§€ç¨‹åº¦å°±æœ‰ä¸€é»ä¸æ–¹ä¾¿ï¼Œå› ç‚ºæˆ‘ Hugo å·²ç¶“ç´¯è¨ˆäº†ä¸å°‘æ–‡ç« ï¼Œè‹¥è¦ç¾åœ¨å†å»ä¸€ç¯‡ç¯‡ä¿®æ”¹ï¼Œä¹Ÿæ˜¯æœƒæœ‰é»éº»ç…©ï¼Œæ‰€ä»¥åªå¥½è‡ªå·±ç¨å¾®ç ”ç©¶ä¸€ä¸‹è¦æ€éº¼è™•ç†ã€‚\n\n```md\nHello\n\næ‘˜è¦\n\n<!--more-->\n\næ­£æ–‡\n\næ­£æ–‡\n```\n\næˆ‘è™•ç†çš„æ–¹å¼ç°¡å–®æš´åŠ›ï¼Œæˆ‘ç™¼ç¾ Gatsby åœ¨ GraphQL çš„æ™‚å€™ï¼Œå¯ä»¥æ‹¿åˆ° RawMarkdownï¼Œè€Œä¸”é€™å€‹ä¹Ÿæœƒä¿ç•™è¨»è§£ï¼Œæ‰€ä»¥æˆ‘éˆæ©Ÿä¸€å‹•ï¼Œæˆ‘å°±è‡ªå·±ä½¿ç”¨ Node å¥—ä»¶ï¼Œè‡ªå·±è§£æ Markdown ä¸å°±å¥½äº†ï¼Ÿæ‰€ä»¥æˆ‘å°±ç”¨ `marked` å¥—ä»¶ï¼Œå¹«æˆ‘æŠŠ md è½‰æˆ htmlã€‚ç¯„ä¾‹å¤§è‡´å¦‚ä¸‹ï¼š\n\n```typescript\nimport { marked } from \"marked\";\n\nexport default function Summary({ node }: Props) {\n  const summary = node.rawMarkdownBody.spllit(\"<!--more-->\")[0];\n  return <div dangerouslaSetSetInnerHTML={{ __html: marked.parse(summary) }} />;\n}\n```\n\n## MeiliSearch\n\næˆ‘åŸæœ¬çš„ Hugo ç¶²é ï¼Œå°±æ˜¯ä½¿ç”¨ MeiliSearch ä¾†ç•¶æˆ‘çš„æœå°‹åŠŸèƒ½ï¼Œå¯ä»¥åƒè€ƒé€™å€‹ [tag](/search/tag?tag=meilisearch) ã€‚æ‰€ä»¥ä¸€æ¨£æ˜¯æœƒéœ€è¦ç”¢ç”Ÿä¸€å€‹ `SearchIndex.json`ï¼Œæˆ‘ç›´æ¥åœ¨ `gatsby-node.ts` è£¡çš„ `noPostBuild` æ‰‹å‹•ç”¢ç”Ÿ jsonï¼Œå†ç”¨ `fs` å¯«å…¥æª”æ¡ˆï¼Œç›´æ¥çµ¦å¤§å®¶ç¨‹å¼ç¢¼åƒè€ƒã€‚\n\n```typescript\nexport const onPostBuild: GatsbyNode[\"onPostBuild\"] = async ({\n  graphql,\n  actions,\n}) => {\n  const { errors, data } = await graphql<ArticleListData>(articleGraphql);\n  // SearchIndex.json\n  const searchArr: SearchIndex[] = [];\n  data!!.allMarkdownRemark.edges.forEach(({ node }, index) => {\n    const summary = node.rawMarkdownBody.split(\"<!--more-->\")[0];\n    const url =\n      \"/posts/\" +\n      node.fileAbsolutePath\n        .split(\"/posts/\")[1]\n        .split(\".md\")[0]\n        .replace(\" \", \"-\")\n        .toLowerCase();\n    const miliseconds = new Date(node.frontmatter.date).getTime();\n    searchArr.push({\n      id: index,\n      date: miliseconds,\n      url: url,\n      title: node.frontmatter.title,\n      summary: summary,\n      content: node.internal.content.replace(\"\\n\", \" \"),\n      tags: node.frontmatter.tags,\n    });\n  });\n  fs.writeFileSync(\"./public/SearchIndex.json\", JSON.stringify(searchArr));\n};\n```\n\nç”¢ç”Ÿ Json å¾Œï¼Œæˆ‘ä¸€æ¨£æ˜¯ä½¿ç”¨ GitHub Actions ä¾†è‡ªå‹•æŠŠ Index æ¨åˆ° MeiliSearch Serverã€‚\n\n## Tag Page\n\nå…¶å¯¦ Gatsby æ‡‰è©²ä¹Ÿæ˜¯æœ‰æ–¹æ³•å¯ä»¥ç”¢ç”Ÿ Tag Pageï¼Œä½†æ˜¯å› ç‚ºæˆ‘æƒ³åˆ°è¦ç”¨ Tag Page æ™‚ï¼Œæˆ‘å·²ç¶“å¼„å¥½ MeiliSearch äº†ï¼Œæ‰€ä»¥æˆ‘å°±éˆæ©Ÿä¸€å‹•ï¼Œæƒ³æƒ³æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç›´æ¥ç°¡å–®çš„ä½¿ç”¨ MeiliSearch ä¾†å‹•æ…‹çš„ç”¢ç”Ÿ Tag Page å°±å¥½ï¼Œçµæœé‚„çœŸçš„è¢«æˆ‘å¼„æˆåŠŸäº†ï¼Œå°±ä¾†ç´€éŒ„ä¸€ä¸‹æˆ‘å¤§æ¦‚çš„æ€è·¯ã€‚é›–ç„¶æˆ‘çŸ¥é“é€™å…«æˆä¸æ˜¯ä»€éº¼å¥½æ–¹æ³•ï¼Œä½†æ˜¯ç°¡å–®æš´åŠ›ã€‚\n\nMeiliSearch å¯ä»¥è¨­å®š `filterableAttributes` çš„å±¬æ€§ï¼Œæ‰€ä»¥æˆ‘æŠŠæˆ‘çš„ Index ä¸­çš„ Tag å±¬æ€§è¨­å®šæˆå¯ä»¥ Filterableï¼Œç„¶å¾Œå†å–å¾—ç¶²å€çš„ Paramsï¼Œæœ€å¾Œå‘ MeiliSearch æœå°‹å¾Œå‹•æ…‹çš„æŠŠçµæœé¡¯ç¤ºåœ¨ç¶²é ä¸Šã€‚ä¹Ÿå¯ä»¥åƒè€ƒ[å®˜æ–¹æ–‡ä»¶](https://docs.meilisearch.com/learn/advanced/filtering_and_faceted_search.html#configuring-filters)ã€‚\n\né€™æ™‚é‡åˆ°çš„å•é¡Œå°±æ˜¯ Gatsby æ˜¯ Server Side Renderingï¼Œæ‰€ä»¥å–çš„ Params è¦ä½¿ç”¨é¡å¤–çš„ pluginï¼Œæˆ‘æ˜¯ä½¿ç”¨ `gatsby-plugin-use-query-params`ï¼Œå°±å¯ä»¥åƒæ˜¯ React çš„ useState çš„æ–¹å¼ä¾†å–çš„ç¶²å€çš„ Parmã€‚\n\nä¹Ÿæ˜¯æä¾›éƒ¨åˆ†çš„ç¨‹å¼ç¢¼çµ¦å¤§å®¶åƒè€ƒï¼š\n\n```typescript\nexport default function SearchTags() {\n  const [{ tag }, _] = useQueryParams({ tag: StringParam }); // å–çš„ Params\n  const [result, setResult] = React.useState([]);\n  const [isLoading, setIsLoading] = React.useState(true);\n  React.useEffect(() => {\n    // åŸ·è¡Œæœå°‹\n    client\n      .index(\"gatsby-blog\")\n      .search(\"\", {\n        filter: [\"tags=\" + (tag ? tag : \"\")],\n        limit: Number.MAX_SAFE_INTEGER,\n      })\n      .then((res: any) => {\n        setResult(res.hits);\n        setIsLoading(false);\n      });\n  }, []);\n  return (\n    <MainLayout title={\"tag: \" + tag + \" - TonyPepe\"}>\n      <div>\n        <h1 className=\"my-4 bg-white rounded-md py-4 px-6 text-2xl\">\n          {\"Tag: \" + tag}\n        </h1>\n        {isLoading ? <LoadingChild /> : <ResultClild hits={result} />}\n      </div>\n    </MainLayout>\n  );\n}\n\nconst client = new MeiliSearch({\n  host: \"https://search.tonypepe.com\",\n  apiKey: \"\",\n});\n```\n\n## å¾Œç´€\n\nNode åœ¨å»ºç½®ä¸Šå¯¦åœ¨æ˜¯å¤ªæ…¢ï¼ŒçœŸçš„æœƒæœ‰ä¸€é»å—ä¸äº†ï¼Œæ¯æ¬¡å…‰æ˜¯è¦ Run èµ· Dev Serverï¼Œå°±è‡³å°‘éœ€è¦ 30 ç§’ï¼Œç›¸æ¯” Hugo å°±ç®—æ˜¯æœ‰è£ä¸€é»é»çš„ npm å¥—ä»¶ï¼Œé‚„æ˜¯åªè¦ 10 ç§’å·¦å³å°±å¯ä»¥é–‹å§‹å¯«ç¶²é äº†ã€‚\n\nç•¶ç„¶ï¼Œä½¿ç”¨ Gatsby é–‹ç™¼çš„å¥½è™•ä¹Ÿæ˜¯å¾ˆå¤šï¼Œå¯ä»¥æœ€å¤§åŒ–çš„è‡ªè¨‚ç¶²é çš„é•·ç›¸å’ŒåŠŸèƒ½ï¼Œä¸æœƒè¢« Hugo çš„åŠŸèƒ½é™åˆ¶ä½ï¼Œå¦‚æœç¼ºå°‘äº†ä»€éº¼åŠŸèƒ½ï¼Œéƒ½å¯ä»¥è‡ªå·±ç”¨ js é–‹ç™¼å‡ºä¾†ï¼Œè€Œä¸”åœ¨ä½¿ç”¨ä¸€äº› Web Library å’Œ React çœŸçš„å¤ªæ–¹ä¾¿äº†ã€‚\n\n## Reference\n\n- [Gatsby](https://gatsbyjs.org/)\n- [MeiliSearch - Filtering and faceted search](https://docs.meilisearch.com/learn/advanced/filtering_and_faceted_search.html#configuring-filters)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/Web/hugo-to-gatsby.md","excerpt":"æœ€è¿‘æŠŠç¶²ç«™å¾ Hugo é·ç§»åˆ° Gatsbyï¼Œé‡åˆ°äº†ä¸€äº›å•é¡Œï¼Œæˆ‘å°±ä¾†ç°¡å–®è¨˜éŒ„ä¸€ä¸‹è§£æ±ºå•é¡Œçš„éç¨‹ï¼Œè€Œä¸”å› ç‚ºæˆ‘å° Node ä¹Ÿä¸æ˜¯å¾ˆç†Ÿï¼Œæ‰€ä»¥ä¸»è¦æ˜¯åœ¨ç•¶ä½œæˆ‘ç·´ç¿’ Node å’Œ Reactã€‚ Whyï¼Ÿ Hugo å¯¦åœ¨å¾ˆé›£ä½¿ç”¨ Node å¥—ä»¶ å–®ç´”æƒ³çµ¦è‡ªå·±ä¸€å€‹æ¥è§¸ Node çš„æ©Ÿæœƒ è¨±å¤šç¶²é çš„å¥—ä»¶åº«éƒ½æ˜¯ä½¿ç”¨ node é–‹ç™¼çš„ï¼Œä½†å› ç‚º Hugo æ˜¯ç”¨ go é–‹ç™¼ï¼Œé›–ç„¶æœ‰æä¾›å° npm å¥—ä»¶çš„æ”¯æ´ï¼Œä½†æ˜¯é‚„æ˜¯æ²’â€¦","frontmatter":{"title":"å¾ Hugo é·åˆ° Gatsby çš„ç´€éŒ„","date":"2022-06-01T15:17:28.142Z","draft":false,"tags":["hugo","gatsby","blog","web","node","npm","meilisearch","search"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/2892b2bf-2c12-4d17-21f7-ba2e57c98100/public","description":null}}},{"node":{"id":"af3c84b0-2162-5466-8b24-f810139828dd","html":"<p>è¨˜éŒ„ä¸€äº›æˆ‘æ€•å¿˜çš„ Command Line æŠ€å·§ï¼Œç•¶ä½œå­—å…¸ç”¨ã€‚</p>\n<!--more-->\n<h2>æ¸…è¢å¹•</h2>\n<p><code class=\"language-text\">clear</code> æˆ–æ˜¯ <code class=\"language-text\">ctrl + L</code></p>\n<h2>å®¶ç›®éŒ„</h2>\n<p><code class=\"language-text\">~</code> æ³¢æµªç¬¦å°±æ˜¯ä»£è¡¨å®¶ç›®éŒ„</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/etc$ <span class=\"token builtin class-name\">cd</span> ~\n\n~$</code></pre></div>\n<h2>é è¨­æ–‡å­—ç·¨è¼¯å™¨</h2>\n<p>æœ‰æ™‚é è¨­çš„æ–‡å­—ç·¨è¼¯å™¨ä¸æ˜¯ vimï¼Œè€Œæ˜¯ <code class=\"language-text\">nano</code> æˆ–æ˜¯ <code class=\"language-text\">emacs</code>ï¼Œåœ¨æ‰“ git æŒ‡ä»¤æ™‚ï¼Œæœƒé€²éŒ¯ç·¨è¼¯å™¨ã€‚åªè¦åœ¨ <code class=\"language-text\">.bashrc</code> ä¸­åŠ å…¥ä»¥ä¸‹å…©è¡Œï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">EDITOR</span><span class=\"token operator\">=</span>vim\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">VISUAL</span><span class=\"token operator\">=</span>vim</code></pre></div>\n<h2>è®Šæ›´ rc file å¾Œé¦¬ä¸Šç”Ÿæ•ˆ</h2>\n<p><code class=\"language-text\">source ~/.bashrc</code></p>\n<h2>è¿”å›ä¸Šä¸€å€‹è·¯å¾‘</h2>\n<p><code class=\"language-text\">cd -</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ <span class=\"token builtin class-name\">cd</span> /etc\n\n/etc$ <span class=\"token builtin class-name\">cd</span> /var\n\n/var$ <span class=\"token builtin class-name\">cd</span> -\n\n/etc$ <span class=\"token builtin class-name\">cd</span> ~\n\n~$</code></pre></div>\n<h2>æŠŠè·¯å¾‘æ”¾é€² Stack</h2>\n<p><code class=\"language-text\">pushd</code> æŠŠç¾åœ¨çš„è·¯å¾‘æ¨é€² Stackï¼Œä¸¦ cd åˆ°å¾Œé¢çš„åƒæ•¸</p>\n<p><code class=\"language-text\">popd</code> æ‹¿å‡ºä¾†</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">/etc$ <span class=\"token function\">pushd</span> /var\n/var /etc\n\n/var$ <span class=\"token function\">pushd</span> /home\n/home /var /etc\n\n/home$ <span class=\"token builtin class-name\">cd</span> ~\n\n~$ <span class=\"token builtin class-name\">cd</span> /var/\n\n~$ <span class=\"token builtin class-name\">cd</span> /var/lib/\n\n/var/lib$ <span class=\"token function\">popd</span>\n/var /etc\n\n/var$ <span class=\"token function\">popd</span>\n/etc\n\n/etc$</code></pre></div>\n<h2>æŠŠå·¥ä½œæ”¾åˆ°èƒŒæ™¯</h2>\n<p><code class=\"language-text\">ctrl + z</code></p>\n<p>æ³¨æ„ï¼Œé€™æœƒæš«åœæ•´å€‹ processï¼Œä¸¦ä¸æ˜¯æ”¾åˆ°èƒŒæ™¯åŸ·è¡Œ</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ <span class=\"token function\">vim</span> /proc/cpuinfo\n\n<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>+  Stopped                 <span class=\"token function\">vim</span> /proc/cpuinfo\n\n~$</code></pre></div>\n<p><code class=\"language-text\">fg</code> (foreground) æŠŠæ”¾åˆ°èƒŒæ™¯çš„ process å–å›å‰æ™¯ç¹¼çºŒåŸ·è¡Œ</p>\n<p>Shell çµæŸæ™‚ï¼Œæ‰€æœ‰è¢«æš«åœçš„ process ä¹Ÿæœƒä¸€èµ·è¢«æ®ºæ‰</p>\n<h2>é‡è¤‡ä¸Šä¸€å€‹ Command</h2>\n<p><code class=\"language-text\">!!</code> å°±æ˜¯ä»£è¡¨ä¸Šä¸€å€‹ Command</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ <span class=\"token builtin class-name\">echo</span> HI\nHI\n\n~$ <span class=\"token operator\">!</span><span class=\"token operator\">!</span>\n<span class=\"token builtin class-name\">echo</span> HI\nHI\n\n~$</code></pre></div>\n<p>é€™æ˜¯å¯ä»¥çµ„åˆæŠ€çš„ï¼šå¿˜è¨˜æ‰“ sudo å°± <code class=\"language-text\">sudo !!</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ <span class=\"token function\">apt</span> update\nReading package lists<span class=\"token punctuation\">..</span>. Done\nE: Could not <span class=\"token function\">open</span> lock <span class=\"token function\">file</span> /var/lib/apt/lists/lock - <span class=\"token function\">open</span> <span class=\"token punctuation\">(</span><span class=\"token number\">13</span>: Permission denied<span class=\"token punctuation\">)</span>\nE: Unable to lock directory /var/lib/apt/lists/\n\n~$ <span class=\"token function\">sudo</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update\nHit:1 http://archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://security.ubuntu.com/ubuntu jammy-security InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">110</span> kB<span class=\"token punctuation\">]</span>\nGet:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">109</span> kB<span class=\"token punctuation\">]</span>\nGet:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease <span class=\"token punctuation\">[</span><span class=\"token number\">99.8</span> kB<span class=\"token punctuation\">]</span>\nGet:5 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages <span class=\"token punctuation\">[</span><span class=\"token number\">230</span> kB<span class=\"token punctuation\">]</span>\nGet:6 http://archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages <span class=\"token punctuation\">[</span><span class=\"token number\">143</span> kB<span class=\"token punctuation\">]</span>\nFetched <span class=\"token number\">693</span> kB <span class=\"token keyword\">in</span> 2s <span class=\"token punctuation\">(</span><span class=\"token number\">328</span> kB/s<span class=\"token punctuation\">)</span>\nReading package lists<span class=\"token punctuation\">..</span>. Done\nBuilding dependency tree<span class=\"token punctuation\">..</span>. Done\nReading state information<span class=\"token punctuation\">..</span>. Done\n<span class=\"token number\">1</span> package can be upgraded. Run <span class=\"token string\">'apt list --upgradable'</span> to see it.\n~$</code></pre></div>\n<h2>sudo ä¸è¼¸å…¥å¯†ç¢¼</h2>\n<p>åªè¦è®“ä¸‹é¢é‚£ä¸€è¡Œå‡ºç¾åœ¨ <code class=\"language-text\">/etc/sudoers</code> ä¸­å°±å¯ä»¥ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">%sudo ALL=(ALL) NOPASSWD:ALL</code></pre></div>\n<p>æˆ–æ˜¯ç›´æ¥è¼¸å…¥ (with root)ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> ~$ <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'%sudo ALL=(ALL) NOPASSWD:ALL'</span> <span class=\"token operator\">>></span> /etc/sudoers</code></pre></div>\n<h2>æœå°‹æ‰“éçš„æŒ‡ä»¤</h2>\n<p><code class=\"language-text\">ctrl + r</code>ï¼Œç„¶å¾Œæ‰“ä¸Šéƒ¨åˆ†è¨˜å¾—çš„æŒ‡ä»¤ï¼Œå°±æœƒè‡ªå‹•è£œå®Œ</p>\n<h2>è¼¸å‡ºå°é€² less</h2>\n<p>æœ‰æ™‚æŒ‡ä»¤è¼¸å‡ºå¾ˆé•·ï¼Œéœ€è¦ç¿»é é¡¯ç¤ºæ™‚ï¼Œå¯ä»¥ç”¨ <code class=\"language-text\">|</code> å°å…¥ <code class=\"language-text\">less</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ <span class=\"token function\">cat</span> /proc/cpuinfo <span class=\"token operator\">|</span> <span class=\"token function\">less</span></code></pre></div>\n<h2>æ¸…æ‰ä¸€æ•´è¡Œ</h2>\n<p><code class=\"language-text\">ctrl + u</code> æŠŠé‚„æ²’ enter çš„æŒ‡ä»¤æ¸…æ‰</p>\n<h2>å…‰æ¨™åˆ°æœ€å‰æˆ–æœ€å¾Œ</h2>\n<p><code class=\"language-text\">ctrl + a</code> ç§»å‹•å…‰æ¨™åˆ°æœ€å‰</p>\n<p><code class=\"language-text\">ctrl + e</code> ç§»å‹•å…‰æ¨™åˆ°æœ€å¾Œ</p>\n<h2>é€£çºŒåŸ·è¡ŒæŒ‡ä»¤</h2>\n<p><code class=\"language-text\">;</code> ä¸ç®¡å‰é¢æœ‰æ²’æœ‰æˆåŠŸï¼Œéƒ½åŸ·è¡Œå¾Œé¢çš„å‘½ä»¤</p>\n<p><code class=\"language-text\">&amp;&amp;</code> è¦å‰é¢å¾—åŸ·è¡ŒæˆåŠŸï¼Œæ‰åŸ·è¡Œå¾Œé¢çš„å‘½ä»¤</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ <span class=\"token function\">ls</span> / <span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">echo</span> hi\nbin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nhi\n\n~$ <span class=\"token function\">ls</span> / <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> hi\nbin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nhi\n\n~$ <span class=\"token function\">ls</span> /no_such_dir <span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">echo</span> hi\nls: cannot access <span class=\"token string\">'/no_such_dir'</span><span class=\"token builtin class-name\">:</span> No such <span class=\"token function\">file</span> or directory\nhi\n\n~$ <span class=\"token function\">ls</span> /no_such_dir <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> hi\nls: cannot access <span class=\"token string\">'/no_such_dir'</span><span class=\"token builtin class-name\">:</span> No such <span class=\"token function\">file</span> or directory</code></pre></div>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://youtube.com/watch?v=AVXYq8aL47Q\">18 Commands That Will Change The Way You Use Linux Forever</a></li>\n</ul>","rawMarkdownBody":"\nè¨˜éŒ„ä¸€äº›æˆ‘æ€•å¿˜çš„ Command Line æŠ€å·§ï¼Œç•¶ä½œå­—å…¸ç”¨ã€‚\n\n<!--more-->\n\n## æ¸…è¢å¹•\n\n`clear` æˆ–æ˜¯ `ctrl + L`\n\n## å®¶ç›®éŒ„\n\n`~` æ³¢æµªç¬¦å°±æ˜¯ä»£è¡¨å®¶ç›®éŒ„\n\n```bash\n/etc$ cd ~\n\n~$\n```\n\n## é è¨­æ–‡å­—ç·¨è¼¯å™¨\n\næœ‰æ™‚é è¨­çš„æ–‡å­—ç·¨è¼¯å™¨ä¸æ˜¯ vimï¼Œè€Œæ˜¯ `nano` æˆ–æ˜¯ `emacs`ï¼Œåœ¨æ‰“ git æŒ‡ä»¤æ™‚ï¼Œæœƒé€²éŒ¯ç·¨è¼¯å™¨ã€‚åªè¦åœ¨ `.bashrc` ä¸­åŠ å…¥ä»¥ä¸‹å…©è¡Œï¼š\n\n```bash\nexport EDITOR=vim\nexport VISUAL=vim\n```\n\n## è®Šæ›´ rc file å¾Œé¦¬ä¸Šç”Ÿæ•ˆ\n\n`source ~/.bashrc`\n\n## è¿”å›ä¸Šä¸€å€‹è·¯å¾‘\n\n`cd -`\n\n```bash\n~$ cd /etc\n\n/etc$ cd /var\n\n/var$ cd -\n\n/etc$ cd ~\n\n~$\n```\n\n## æŠŠè·¯å¾‘æ”¾é€² Stack\n\n`pushd` æŠŠç¾åœ¨çš„è·¯å¾‘æ¨é€² Stackï¼Œä¸¦ cd åˆ°å¾Œé¢çš„åƒæ•¸\n\n`popd` æ‹¿å‡ºä¾†\n\n```bash\n/etc$ pushd /var\n/var /etc\n\n/var$ pushd /home\n/home /var /etc\n\n/home$ cd ~\n\n~$ cd /var/\n\n~$ cd /var/lib/\n\n/var/lib$ popd\n/var /etc\n\n/var$ popd\n/etc\n\n/etc$\n```\n\n## æŠŠå·¥ä½œæ”¾åˆ°èƒŒæ™¯\n\n`ctrl + z`\n\næ³¨æ„ï¼Œé€™æœƒæš«åœæ•´å€‹ processï¼Œä¸¦ä¸æ˜¯æ”¾åˆ°èƒŒæ™¯åŸ·è¡Œ\n\n```bash\n~$ vim /proc/cpuinfo\n\n[1]+  Stopped                 vim /proc/cpuinfo\n\n~$\n```\n\n`fg` (foreground) æŠŠæ”¾åˆ°èƒŒæ™¯çš„ process å–å›å‰æ™¯ç¹¼çºŒåŸ·è¡Œ\n\nShell çµæŸæ™‚ï¼Œæ‰€æœ‰è¢«æš«åœçš„ process ä¹Ÿæœƒä¸€èµ·è¢«æ®ºæ‰\n\n## é‡è¤‡ä¸Šä¸€å€‹ Command\n\n`!!` å°±æ˜¯ä»£è¡¨ä¸Šä¸€å€‹ Command\n\n```bash\n~$ echo HI\nHI\n\n~$ !!\necho HI\nHI\n\n~$\n```\n\né€™æ˜¯å¯ä»¥çµ„åˆæŠ€çš„ï¼šå¿˜è¨˜æ‰“ sudo å°± `sudo !!`\n\n```bash\n~$ apt update\nReading package lists... Done\nE: Could not open lock file /var/lib/apt/lists/lock - open (13: Permission denied)\nE: Unable to lock directory /var/lib/apt/lists/\n\n~$ sudo !!\nsudo apt update\nHit:1 http://archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://security.ubuntu.com/ubuntu jammy-security InRelease [110 kB]\nGet:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease [109 kB]\nGet:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease [99.8 kB]\nGet:5 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [230 kB]\nGet:6 http://archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [143 kB]\nFetched 693 kB in 2s (328 kB/s)\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\n1 package can be upgraded. Run 'apt list --upgradable' to see it.\n~$\n```\n\n## sudo ä¸è¼¸å…¥å¯†ç¢¼\n\nåªè¦è®“ä¸‹é¢é‚£ä¸€è¡Œå‡ºç¾åœ¨ `/etc/sudoers` ä¸­å°±å¯ä»¥ï¼š\n\n```text\n%sudo ALL=(ALL) NOPASSWD:ALL\n```\n\næˆ–æ˜¯ç›´æ¥è¼¸å…¥ (with root)ï¼š\n\n```bash\n(root) ~$ echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers\n```\n\n## æœå°‹æ‰“éçš„æŒ‡ä»¤\n\n`ctrl + r`ï¼Œç„¶å¾Œæ‰“ä¸Šéƒ¨åˆ†è¨˜å¾—çš„æŒ‡ä»¤ï¼Œå°±æœƒè‡ªå‹•è£œå®Œ\n\n## è¼¸å‡ºå°é€² less\n\næœ‰æ™‚æŒ‡ä»¤è¼¸å‡ºå¾ˆé•·ï¼Œéœ€è¦ç¿»é é¡¯ç¤ºæ™‚ï¼Œå¯ä»¥ç”¨ `|` å°å…¥ `less`\n\n```bash\n~$ cat /proc/cpuinfo | less\n```\n\n## æ¸…æ‰ä¸€æ•´è¡Œ\n\n`ctrl + u` æŠŠé‚„æ²’ enter çš„æŒ‡ä»¤æ¸…æ‰\n\n## å…‰æ¨™åˆ°æœ€å‰æˆ–æœ€å¾Œ\n\n`ctrl + a` ç§»å‹•å…‰æ¨™åˆ°æœ€å‰\n\n`ctrl + e` ç§»å‹•å…‰æ¨™åˆ°æœ€å¾Œ\n\n## é€£çºŒåŸ·è¡ŒæŒ‡ä»¤\n\n`;` ä¸ç®¡å‰é¢æœ‰æ²’æœ‰æˆåŠŸï¼Œéƒ½åŸ·è¡Œå¾Œé¢çš„å‘½ä»¤\n\n`&&` è¦å‰é¢å¾—åŸ·è¡ŒæˆåŠŸï¼Œæ‰åŸ·è¡Œå¾Œé¢çš„å‘½ä»¤\n\n```bash\n~$ ls / ; echo hi\nbin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nhi\n\n~$ ls / && echo hi\nbin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\nhi\n\n~$ ls /no_such_dir ; echo hi\nls: cannot access '/no_such_dir': No such file or directory\nhi\n\n~$ ls /no_such_dir && echo hi\nls: cannot access '/no_such_dir': No such file or directory\n```\n\n## Reference\n\n- [18 Commands That Will Change The Way You Use Linux Forever](https://youtube.com/watch?v=AVXYq8aL47Q)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/Linux/command tips.md","excerpt":"è¨˜éŒ„ä¸€äº›æˆ‘æ€•å¿˜çš„ Command Line æŠ€å·§ï¼Œç•¶ä½œå­—å…¸ç”¨ã€‚ æ¸…è¢å¹•  æˆ–æ˜¯  å®¶ç›®éŒ„  æ³¢æµªç¬¦å°±æ˜¯ä»£è¡¨å®¶ç›®éŒ„ é è¨­æ–‡å­—ç·¨è¼¯å™¨ æœ‰æ™‚é è¨­çš„æ–‡å­—ç·¨è¼¯å™¨ä¸æ˜¯ vimï¼Œè€Œæ˜¯  æˆ–æ˜¯ ï¼Œåœ¨æ‰“ git æŒ‡ä»¤æ™‚ï¼Œæœƒé€²éŒ¯ç·¨è¼¯å™¨ã€‚åªè¦åœ¨  ä¸­åŠ å…¥ä»¥ä¸‹å…©è¡Œï¼š è®Šæ›´ rc file å¾Œé¦¬ä¸Šç”Ÿæ•ˆ  è¿”å›ä¸Šä¸€å€‹è·¯å¾‘  æŠŠè·¯å¾‘æ”¾é€² Stack  æŠŠç¾åœ¨çš„è·¯å¾‘æ¨é€² Stackï¼Œä¸¦ cd åˆ°å¾Œé¢çš„åƒæ•¸  æ‹¿å‡ºä¾† æŠŠå·¥ä½œæ”¾åˆ°â€¦","frontmatter":{"title":"ä¸€äº› Command Line æŠ€å·§","date":"2022-05-25T15:27:30.000Z","draft":false,"tags":["linux","ubuntu","mac","command","max"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/9dfac9e4-1de1-43dc-eead-381301a1b500/public","description":null}}},{"node":{"id":"22c3b17c-4301-5fb4-9145-fa9a71fdb584","html":"<p>ç‚ºä»€éº¼è¦åœ¨ Container ä¸­ Codingï¼Ÿå› çˆ²é–‹ç™¼ä¸­æœ€å¤§çš„é›£é¡Œç¸½æ˜¯åœ¨ç’°å¢ƒå»ºç½®ï¼Œå¥½ä¸å®¹æ˜“å»ºç½®å¥½ç’°å¢ƒï¼Œè¦å¯«ä¸‹å€‹å°ˆæ¡ˆæ™‚ï¼Œå› ç‚ºé›»è…¦å·²ç¶“é«’å…®å…®ï¼Œå®‰è£ç’°å¢ƒæ™‚å°±æœƒå®¹æ˜“è¡åˆ°ç‰ˆæœ¬ï¼Œè€Œé€ æˆæƒ¡æ€§å¾ªç’°ï¼Œç’°å¢ƒå»ºç½®ä¸€æ¬¡æ¯”ä¸€æ¬¡å›°é›£ï¼Œæœ€å¾Œç™¼ç¾é‡çŒé›»è…¦æœ€å¿«ã€‚åœ¨ Container ä¸­ Coding å°±å¯ä»¥ç°¡å–®ç”¨å®Œå³ä¸Ÿï¼Œæ¯æ¬¡éƒ½å¯ä»¥åœ¨ä¹¾æ·¨çš„é›»è…¦å®‰è£ç’°å¢ƒï¼Œè£ä»»ä½•æ±è¥¿ä¹Ÿä¸æ€•æŠŠæœ¬æ©Ÿå¼„é«’ï¼Œåœ¨ Windows ä¸Šæ›´å¯ä»¥ç°¡å–®çš„åœ¨ Linux ä¸­é–‹ç™¼ã€‚</p>\n<!--more-->\n<p>åœ¨ Container è£¡ Coding å·²ç¶“ä¸æ˜¯ä»€éº¼æ–°é®®äº‹ï¼ŒVSCode çš„å®˜æ–¹å°±æœ‰æä¾› <a href=\"https://code.visualstudio.com/docs/remote/containers\">Developing inside a Container</a> çš„å®˜æ–¹æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æœ¬æ©Ÿçš„ Docker å¿«é€Ÿçš„ç”¢ç”Ÿ Container ä¸¦ä¸”åœ¨è£¡é¢é–‹ç™¼ã€‚å£è™•å°±æ˜¯åªèƒ½åœ¨æœ¬æ©Ÿé€£ç·šï¼Œå¦‚æœæœ‰å¤šå°é›»è…¦æƒ³è¦å…±åŒé–‹ç™¼çš„éœ€æ±‚ï¼Œå°±åªå¥½ç”¨ä»Šå¤©è¦ä»‹ç´¹çš„æ–¹å¼ï¼Œç”¨ SSH é€£å…¥ Containerï¼Œåªè¦é€£å¾—ä¸Š SSH å°±å¯ä»¥é–‹ç™¼ï¼Œé–‹ç™¼æ™‚ä¹Ÿä¸ç”¨è¢«ä¾·é™åœ¨ä¸€å°é›»è…¦çš„ Docker ä¸Šã€‚ç•¶ç„¶ï¼Œæœ€å¤§çš„ç¼ºé»å°±æ˜¯è¦æœ‰ä¸€å°ä¸€ç›´é‹ä½œè‘— Docker çš„ Server å¯ä»¥è®“ä½ éš¨æ™‚é€£ç·šã€‚GitHub æœ‰ä¸€å€‹ <a href=\"https://github.com/features/codespaces\">Codespace</a> çš„åŠŸèƒ½ï¼Œå°±æ˜¯å¾ˆé¡ä¼¼çš„æƒ³æ³•ï¼ŒCode in Cloudï¼Œä½†ç•¢ç«Ÿæ˜¯ä¼æ¥­çš„æ”¶è²»æœå‹™ï¼Œæˆ‘ä¹‹å‰æœ‰æŠ½åˆ°é è¦½ç‰ˆï¼Œåˆ°ç¾åœ¨éƒ½å¯ä»¥å…è²»ä½¿ç”¨ï¼Œæ˜¯çœŸçš„å¾ˆæ–¹ä¾¿çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ä»–çš„æ–¹ä¾¿ï¼Œè®“æˆ‘æƒ³ç ”ç©¶å¦‚ä½•è‡ªå·±æ¶é¡ä¼¼çš„æœå‹™ã€‚</p>\n<h2>Dockerfile</h2>\n<p>ç°¡å–®ä¾†èªªå°±æ˜¯å‰µå»ºä¸€å€‹å·²ç¶“è¢«é è£ SSH Server çš„ Linuxï¼Œæˆ‘å€‘ä»Šå¤©å°±ç”¨ Ubuntuï¼Œç„¶å¾Œé †ä¾¿é è£ä¸€äº›é–‹ç™¼ä¸­å¸¸æœƒç”¨åˆ°å¥—ä»¶ï¼Œåƒæ˜¯ <code class=\"language-text\">git</code>, <code class=\"language-text\">vim</code> ç­‰ç­‰ã€‚</p>\n<blockquote>\n<p>å¦‚æœæƒ³è·³éé€™æ­¥é©Ÿï¼Œç”¨æˆ‘å‰µå»ºå¥½çš„ Image å¯ä»¥æ‹‰åˆ°ä¸‹ä¸€å€‹ç« ç¯€å»çœ‹</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">ARG</span> UBUNTU_VERSION=latest</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">FROM</span> ubuntu:<span class=\"token variable\">${UBUNTU_VERSION}</span></span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">ENV</span> DEBIAN_FRONTEND noninteractive</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt update <span class=\"token operator\">\\</span>\n    &amp;&amp; apt install -y openssh-server ssh sudo git vim <span class=\"token operator\">\\</span>\n    &amp;&amp; useradd -rm -d /home/ubuntu -s /bin/bash -g root -G sudo -u 1000 ubuntu <span class=\"token operator\">\\</span>\n    &amp;&amp; echo <span class=\"token string\">\"ubuntu:ubuntu\"</span> | chpasswd <span class=\"token operator\">\\</span>\n    &amp;&amp; echo <span class=\"token string\">'%sudo ALL=(ALL) NOPASSWD:ALL'</span> >> /etc/sudoers <span class=\"token operator\">\\</span>\n    &amp;&amp; service ssh start</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 22</span>\n\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [<span class=\"token string\">\"/usr/sbin/sshd\"</span>, <span class=\"token string\">\"-D\"</span>]</span></code></pre></div>\n<p>å¯ä»¥çœ‹åˆ°æˆ‘æŠŠå¸³è™Ÿå¯†ç¢¼éƒ½è¨­ç½®ç‚º <code class=\"language-text\">ubuntu</code>ï¼Œç„¶å¾Œè®“ <code class=\"language-text\">sudo</code> æ™‚å¯ä»¥ä¸ç”¨å¯†ç¢¼ã€‚ç„¶å¾Œå®‰è£å•Ÿå‹• ssh serviceï¼Œæœ€å¾Œé–‹å•Ÿ 22 portã€‚ç”¨ä¸‹é¢çš„ Docker æŒ‡ä»¤å°±å¯ä»¥å‰µå»ºè‡ªå·±çš„ Imageï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> build -t ssh-ubuntu <span class=\"token builtin class-name\">.</span></code></pre></div>\n<h3>æˆ‘æ§‹å»ºå¥½çš„ Image</h3>\n<p>æˆ‘æœ‰å‰µä¸€å€‹ GitHub Repo æ”¾æˆ‘çš„ Dockerfileï¼Œä¸¦ç”¨ GitHub Actions + Packages ä¾†ç™¼å¸ƒ Imageï¼ŒImage åç¨±ç‚º <code class=\"language-text\">ghcr.io/tonypepebear/ssh-dev-ubuntu</code>ã€‚</p>\n<p><a href=\"https://github.com/TonyPepeBear/ssh-dev-container/pkgs/container/ssh-dev-ubuntu\">Package ç¶²å€</a></p>\n<h2>å•Ÿå‹• Container ä¸¦ SSH é€£å…¥</h2>\n<p>å•Ÿå‹• Container ä¸¦æŠŠ 22 Port å¼„å‡ºä¾†ï¼Œæˆ‘æ˜¯æ˜ å°„åˆ° 8222ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">docker</span> run -dp <span class=\"token number\">8222</span>:22 ssh-ubuntu\n\nå¦‚æœè¦ç”¨æˆ‘çš„ Imageï¼š\n<span class=\"token function\">docker</span> run -dp <span class=\"token number\">8222</span>:22 ghcr.io/tonypepebear/ssh-dev-ubuntu</code></pre></div>\n<p>SSH é€£å…¥ï¼Œè©¢å•å¯†ç¢¼å°±æ˜¯ <code class=\"language-text\">ubuntu</code>ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">ssh</span> -p <span class=\"token number\">8222</span> ubuntu@localhost</code></pre></div>\n<p>å¦‚æœæ²’ç™¼ç”Ÿå•é¡Œï¼Œåˆ°ç¾åœ¨æ‡‰è©²å°±å¯ä»¥é †åˆ©çš„é€£åˆ° Container ä¸­ã€‚</p>\n<h2>VSCode SSH é€£ç·š</h2>\n<p>éœ€è¦å…ˆåœ¨ VSCode ä¸­å®‰è£ Remote - SSH å¥—ä»¶ï¼Œå¦‚åœ–ï¼š</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/be8ec8dc-8900-4cbe-1587-45fa6f3f6500/public\" alt=\"img\"></p>\n<p>å®‰è£å®Œæˆå¾Œï¼Œé»æ“Šæœ€å·¦ä¸‹è§’çš„ Remote åŠŸèƒ½ï¼Œå†é¸æ“‡ Connect to SSH Hostï¼Œè¼¸å…¥ SSH æŒ‡ä»¤ <code class=\"language-text\">ssh -p 8222 ubuntu@localhost</code>ï¼Œå°±å¯ä»¥é †åˆ©é€£åˆ° Container ä¸­ã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/960ea18c-82c7-4ce1-73d3-8ff092f2b000/public\" alt=\"img\"></p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/814b9dac-f39d-4d07-1095-2d280cd5e300/public\" alt=\"img\"></p>\n<h2>å¾Œè¨˜</h2>\n<p>å…¶å¯¦æˆ‘ä¹Ÿä¸æœƒæ¯å€‹å°ˆæ¡ˆéƒ½æ–°å¢ä¸€å€‹æ–°çš„ Containerï¼Œè€Œæ˜¯ç”¨åˆ°æˆ‘å—ä¸äº†æˆ–è¡çªåˆ°å¾Œï¼Œæ‰å‰µå»ºä¸€å€‹æ–°çš„ï¼Œç•¢ç«Ÿæ¯æ¬¡å‰µæ–°çš„ Container ä¹Ÿæ˜¯æœ‰é»éº»ç…©ï¼Œä½†æ˜¯èƒ½è®“æˆ‘åœ¨å®‰è£ä¸€äº›äº‚ä¸ƒå…«ç³Ÿçš„ç’°å¢ƒ (å°±æ˜¯åœ¨èªªä½ å€‘ npm, pip) æ™‚ï¼Œå¯ä»¥å¤§è†½åœ°æŒ‰ä¸‹å»ï¼Œä¸ç”¨æ“”å¿ƒæŠŠé›»è…¦æåˆ°å—ä¸äº†æ‰æ˜¯é‡é»ã€‚å¸Œæœ›å¤§å®¶åœ¨é–‹ç™¼çš„è·¯ä¸Šå¯ä»¥æ›´åŠ é †åˆ©ã€‚</p>\n<p>å¦å¤–ï¼ŒVSCode çš„ SSH é€£ç·šåŠŸèƒ½çœŸçš„åšçš„ä¸éŒ¯ï¼Œç”šè‡³å¯ä»¥ Port Forwardingï¼Œåœ¨é–‹ç™¼ç¶²é çš„æ™‚å€™ä¸ç”¨åœ¨ Docker ä¸­å¤š Forwarding ä¸€å€‹ Portï¼Œå¯ä»¥éš¨æ™‚ç”¨ VSCode Forwarding åˆ°æœ¬æ©Ÿä¸Šã€‚</p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://code.visualstudio.com/docs/remote/ssh\">Remote Development using SSH</a></li>\n</ul>","rawMarkdownBody":"\nç‚ºä»€éº¼è¦åœ¨ Container ä¸­ Codingï¼Ÿå› çˆ²é–‹ç™¼ä¸­æœ€å¤§çš„é›£é¡Œç¸½æ˜¯åœ¨ç’°å¢ƒå»ºç½®ï¼Œå¥½ä¸å®¹æ˜“å»ºç½®å¥½ç’°å¢ƒï¼Œè¦å¯«ä¸‹å€‹å°ˆæ¡ˆæ™‚ï¼Œå› ç‚ºé›»è…¦å·²ç¶“é«’å…®å…®ï¼Œå®‰è£ç’°å¢ƒæ™‚å°±æœƒå®¹æ˜“è¡åˆ°ç‰ˆæœ¬ï¼Œè€Œé€ æˆæƒ¡æ€§å¾ªç’°ï¼Œç’°å¢ƒå»ºç½®ä¸€æ¬¡æ¯”ä¸€æ¬¡å›°é›£ï¼Œæœ€å¾Œç™¼ç¾é‡çŒé›»è…¦æœ€å¿«ã€‚åœ¨ Container ä¸­ Coding å°±å¯ä»¥ç°¡å–®ç”¨å®Œå³ä¸Ÿï¼Œæ¯æ¬¡éƒ½å¯ä»¥åœ¨ä¹¾æ·¨çš„é›»è…¦å®‰è£ç’°å¢ƒï¼Œè£ä»»ä½•æ±è¥¿ä¹Ÿä¸æ€•æŠŠæœ¬æ©Ÿå¼„é«’ï¼Œåœ¨ Windows ä¸Šæ›´å¯ä»¥ç°¡å–®çš„åœ¨ Linux ä¸­é–‹ç™¼ã€‚\n\n<!--more-->\n\nåœ¨ Container è£¡ Coding å·²ç¶“ä¸æ˜¯ä»€éº¼æ–°é®®äº‹ï¼ŒVSCode çš„å®˜æ–¹å°±æœ‰æä¾› [Developing inside a Container](https://code.visualstudio.com/docs/remote/containers) çš„å®˜æ–¹æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æœ¬æ©Ÿçš„ Docker å¿«é€Ÿçš„ç”¢ç”Ÿ Container ä¸¦ä¸”åœ¨è£¡é¢é–‹ç™¼ã€‚å£è™•å°±æ˜¯åªèƒ½åœ¨æœ¬æ©Ÿé€£ç·šï¼Œå¦‚æœæœ‰å¤šå°é›»è…¦æƒ³è¦å…±åŒé–‹ç™¼çš„éœ€æ±‚ï¼Œå°±åªå¥½ç”¨ä»Šå¤©è¦ä»‹ç´¹çš„æ–¹å¼ï¼Œç”¨ SSH é€£å…¥ Containerï¼Œåªè¦é€£å¾—ä¸Š SSH å°±å¯ä»¥é–‹ç™¼ï¼Œé–‹ç™¼æ™‚ä¹Ÿä¸ç”¨è¢«ä¾·é™åœ¨ä¸€å°é›»è…¦çš„ Docker ä¸Šã€‚ç•¶ç„¶ï¼Œæœ€å¤§çš„ç¼ºé»å°±æ˜¯è¦æœ‰ä¸€å°ä¸€ç›´é‹ä½œè‘— Docker çš„ Server å¯ä»¥è®“ä½ éš¨æ™‚é€£ç·šã€‚GitHub æœ‰ä¸€å€‹ [Codespace](https://github.com/features/codespaces) çš„åŠŸèƒ½ï¼Œå°±æ˜¯å¾ˆé¡ä¼¼çš„æƒ³æ³•ï¼ŒCode in Cloudï¼Œä½†ç•¢ç«Ÿæ˜¯ä¼æ¥­çš„æ”¶è²»æœå‹™ï¼Œæˆ‘ä¹‹å‰æœ‰æŠ½åˆ°é è¦½ç‰ˆï¼Œåˆ°ç¾åœ¨éƒ½å¯ä»¥å…è²»ä½¿ç”¨ï¼Œæ˜¯çœŸçš„å¾ˆæ–¹ä¾¿çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ä»–çš„æ–¹ä¾¿ï¼Œè®“æˆ‘æƒ³ç ”ç©¶å¦‚ä½•è‡ªå·±æ¶é¡ä¼¼çš„æœå‹™ã€‚\n\n## Dockerfile\n\nç°¡å–®ä¾†èªªå°±æ˜¯å‰µå»ºä¸€å€‹å·²ç¶“è¢«é è£ SSH Server çš„ Linuxï¼Œæˆ‘å€‘ä»Šå¤©å°±ç”¨ Ubuntuï¼Œç„¶å¾Œé †ä¾¿é è£ä¸€äº›é–‹ç™¼ä¸­å¸¸æœƒç”¨åˆ°å¥—ä»¶ï¼Œåƒæ˜¯ `git`, `vim` ç­‰ç­‰ã€‚\n\n> å¦‚æœæƒ³è·³éé€™æ­¥é©Ÿï¼Œç”¨æˆ‘å‰µå»ºå¥½çš„ Image å¯ä»¥æ‹‰åˆ°ä¸‹ä¸€å€‹ç« ç¯€å»çœ‹\n\n```Dockerfile\nARG UBUNTU_VERSION=latest\n\nFROM ubuntu:${UBUNTU_VERSION}\n\nENV DEBIAN_FRONTEND noninteractive\n\nRUN apt update \\\n    && apt install -y openssh-server ssh sudo git vim \\\n    && useradd -rm -d /home/ubuntu -s /bin/bash -g root -G sudo -u 1000 ubuntu \\\n    && echo \"ubuntu:ubuntu\" | chpasswd \\\n    && echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers \\\n    && service ssh start\n\nEXPOSE 22\n\nCMD [\"/usr/sbin/sshd\", \"-D\"]\n```\n\nå¯ä»¥çœ‹åˆ°æˆ‘æŠŠå¸³è™Ÿå¯†ç¢¼éƒ½è¨­ç½®ç‚º `ubuntu`ï¼Œç„¶å¾Œè®“ `sudo` æ™‚å¯ä»¥ä¸ç”¨å¯†ç¢¼ã€‚ç„¶å¾Œå®‰è£å•Ÿå‹• ssh serviceï¼Œæœ€å¾Œé–‹å•Ÿ 22 portã€‚ç”¨ä¸‹é¢çš„ Docker æŒ‡ä»¤å°±å¯ä»¥å‰µå»ºè‡ªå·±çš„ Imageï¼š\n\n```shell\ndocker build -t ssh-ubuntu .\n```\n\n### æˆ‘æ§‹å»ºå¥½çš„ Image\n\næˆ‘æœ‰å‰µä¸€å€‹ GitHub Repo æ”¾æˆ‘çš„ Dockerfileï¼Œä¸¦ç”¨ GitHub Actions + Packages ä¾†ç™¼å¸ƒ Imageï¼ŒImage åç¨±ç‚º `ghcr.io/tonypepebear/ssh-dev-ubuntu`ã€‚\n\n[Package ç¶²å€](https://github.com/TonyPepeBear/ssh-dev-container/pkgs/container/ssh-dev-ubuntu)\n\n## å•Ÿå‹• Container ä¸¦ SSH é€£å…¥\n\nå•Ÿå‹• Container ä¸¦æŠŠ 22 Port å¼„å‡ºä¾†ï¼Œæˆ‘æ˜¯æ˜ å°„åˆ° 8222ï¼š\n\n```shell\ndocker run -dp 8222:22 ssh-ubuntu\n\nå¦‚æœè¦ç”¨æˆ‘çš„ Imageï¼š\ndocker run -dp 8222:22 ghcr.io/tonypepebear/ssh-dev-ubuntu\n```\n\nSSH é€£å…¥ï¼Œè©¢å•å¯†ç¢¼å°±æ˜¯ `ubuntu`ï¼š\n\n```shell\nssh -p 8222 ubuntu@localhost\n```\n\nå¦‚æœæ²’ç™¼ç”Ÿå•é¡Œï¼Œåˆ°ç¾åœ¨æ‡‰è©²å°±å¯ä»¥é †åˆ©çš„é€£åˆ° Container ä¸­ã€‚\n\n## VSCode SSH é€£ç·š\n\néœ€è¦å…ˆåœ¨ VSCode ä¸­å®‰è£ Remote - SSH å¥—ä»¶ï¼Œå¦‚åœ–ï¼š\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/be8ec8dc-8900-4cbe-1587-45fa6f3f6500/public)\n\nå®‰è£å®Œæˆå¾Œï¼Œé»æ“Šæœ€å·¦ä¸‹è§’çš„ Remote åŠŸèƒ½ï¼Œå†é¸æ“‡ Connect to SSH Hostï¼Œè¼¸å…¥ SSH æŒ‡ä»¤ `ssh -p 8222 ubuntu@localhost`ï¼Œå°±å¯ä»¥é †åˆ©é€£åˆ° Container ä¸­ã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/960ea18c-82c7-4ce1-73d3-8ff092f2b000/public)\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/814b9dac-f39d-4d07-1095-2d280cd5e300/public)\n\n## å¾Œè¨˜\n\nå…¶å¯¦æˆ‘ä¹Ÿä¸æœƒæ¯å€‹å°ˆæ¡ˆéƒ½æ–°å¢ä¸€å€‹æ–°çš„ Containerï¼Œè€Œæ˜¯ç”¨åˆ°æˆ‘å—ä¸äº†æˆ–è¡çªåˆ°å¾Œï¼Œæ‰å‰µå»ºä¸€å€‹æ–°çš„ï¼Œç•¢ç«Ÿæ¯æ¬¡å‰µæ–°çš„ Container ä¹Ÿæ˜¯æœ‰é»éº»ç…©ï¼Œä½†æ˜¯èƒ½è®“æˆ‘åœ¨å®‰è£ä¸€äº›äº‚ä¸ƒå…«ç³Ÿçš„ç’°å¢ƒ (å°±æ˜¯åœ¨èªªä½ å€‘ npm, pip) æ™‚ï¼Œå¯ä»¥å¤§è†½åœ°æŒ‰ä¸‹å»ï¼Œä¸ç”¨æ“”å¿ƒæŠŠé›»è…¦æåˆ°å—ä¸äº†æ‰æ˜¯é‡é»ã€‚å¸Œæœ›å¤§å®¶åœ¨é–‹ç™¼çš„è·¯ä¸Šå¯ä»¥æ›´åŠ é †åˆ©ã€‚\n\nå¦å¤–ï¼ŒVSCode çš„ SSH é€£ç·šåŠŸèƒ½çœŸçš„åšçš„ä¸éŒ¯ï¼Œç”šè‡³å¯ä»¥ Port Forwardingï¼Œåœ¨é–‹ç™¼ç¶²é çš„æ™‚å€™ä¸ç”¨åœ¨ Docker ä¸­å¤š Forwarding ä¸€å€‹ Portï¼Œå¯ä»¥éš¨æ™‚ç”¨ VSCode Forwarding åˆ°æœ¬æ©Ÿä¸Šã€‚\n\n## Reference\n\n- [Remote Development using SSH](https://code.visualstudio.com/docs/remote/ssh)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/VSCode/SSH Dev Container.md","excerpt":"ç‚ºä»€éº¼è¦åœ¨ Container ä¸­ Codingï¼Ÿå› çˆ²é–‹ç™¼ä¸­æœ€å¤§çš„é›£é¡Œç¸½æ˜¯åœ¨ç’°å¢ƒå»ºç½®ï¼Œå¥½ä¸å®¹æ˜“å»ºç½®å¥½ç’°å¢ƒï¼Œè¦å¯«ä¸‹å€‹å°ˆæ¡ˆæ™‚ï¼Œå› ç‚ºé›»è…¦å·²ç¶“é«’å…®å…®ï¼Œå®‰è£ç’°å¢ƒæ™‚å°±æœƒå®¹æ˜“è¡åˆ°ç‰ˆæœ¬ï¼Œè€Œé€ æˆæƒ¡æ€§å¾ªç’°ï¼Œç’°å¢ƒå»ºç½®ä¸€æ¬¡æ¯”ä¸€æ¬¡å›°é›£ï¼Œæœ€å¾Œç™¼ç¾é‡çŒé›»è…¦æœ€å¿«ã€‚åœ¨ Container ä¸­ Coding å°±å¯ä»¥ç°¡å–®ç”¨å®Œå³ä¸Ÿï¼Œæ¯æ¬¡éƒ½å¯ä»¥åœ¨ä¹¾æ·¨çš„é›»è…¦å®‰è£ç’°å¢ƒï¼Œè£ä»»ä½•æ±è¥¿ä¹Ÿä¸æ€•æŠŠæœ¬æ©Ÿå¼„é«’ï¼Œåœ¨ Windows ä¸Šæ›´å¯ä»¥ç°¡å–®çš„åœ¨ Linâ€¦","frontmatter":{"title":"VSCode SSH é€£å…¥ Docker Container","date":"2022-05-21T14:07:16.000Z","draft":false,"tags":["vscode","ssh","docker"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/0f3867f8-dd79-482c-1f27-a7a166f7dc00/public","description":null}}},{"node":{"id":"9b4fd17c-47e0-5706-ae0f-62acdd29fab4","html":"<p>Kotlin åœ¨å¤šå·¥è™•ç†ä¸Šæä¾›éå¸¸å¥½ç”¨çš„ Coroutineã€‚ç•¶ä¸åŒ Job ä¹‹é–“éœ€è¦å‚³éè³‡æ–™æ™‚ï¼Œç¸½æœƒé‡åˆ°è¨±å¤šå•é¡Œï¼Œä»¥å‰æœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯ Callbackï¼Œä½† Callback æ¨¡å¼å·²ç¶“åœ¨å„å€‹ç¨‹å¼èªè¨€ä¸­ç”¢ç”Ÿè¨±å¤šå•é¡Œï¼Œé€™é‚Šå°±ä¸å¤šè¨è«–ã€‚Kotlin Coroutine å¦‚æœåªæ˜¯è¦å›å‚³ä¸€å€‹å€¼ï¼Œå¯ä»¥ç›´æ¥ç”¨ Suspend çš„ Return å€¼ï¼Œä½†å¦‚æœæ˜¯è¦å›å‚³å¾ˆå¤šè³‡æ–™å‘¢ï¼Ÿç°¡å–®çš„æ–¹å¼æ˜¯ç›´æ¥å›å‚³ Listï¼Œå¯æ˜¯å¦‚æœè³‡æ–™éå¸¸å¤§ï¼Œä¹Ÿæœƒç”¢ç”Ÿå‡ºå•é¡Œã€‚æ‰€ä»¥ Kotlin æä¾› Flow ä¾†å¹«åŠ©è§£æ±ºå¤§é‡è³‡æ–™å‚³éçš„å•é¡Œã€‚</p>\n<!--more-->\n<h2>Kotline Coroutine</h2>\n<p>å¦‚æœé‚„ä¸çŸ¥é“ä»€éº¼æ˜¯ Coroutine çš„ï¼Œæˆ‘ä»¥å‰ä¹Ÿæœ‰å¯«é<a href=\"/posts/kotlin/kotlin-coroutine/\">Kotlin Coroutine</a>ã€‚</p>\n<h2>List OF Numbers</h2>\n<p>è®“æˆ‘å€‘å…ˆä¾†çœ‹ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼Œç”¢ç”Ÿä¸€å€‹æœƒå›å‚³ 1 åˆ° 100 çš„ Int Functionï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> ans <span class=\"token operator\">=</span> mutableListOf<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        ans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> ans\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span> <span class=\"token punctuation\">{</span> value <span class=\"token operator\">-></span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä¹çœ‹ä¹‹ä¸‹æ²’ä»€éº¼å•é¡Œï¼Œä½†æ˜¯å¦‚æœé€™æ˜¯ä¸€å€‹éœ€è¦å¤§é‡ CPU æˆ– IO è™•ç†çš„å·¥ä½œè€Œä¸”å›å‚³å€¼éå¸¸å¤§ï¼Œå°±æœƒå°è¨˜æ†¶é«”ç”¢ç”Ÿè² æ“”ã€‚ä¸‹é¢å‡è¨­æˆ‘å€‘éœ€è¦ 1 åˆ° 100,000ï¼Œä¸¦ç”¨ <code class=\"language-text\">delay()</code> æ¨¡æ“¬ CPU å·¥ä½œï¼Œç„¶å¾Œæ”¹æˆ Suspend Functionã€‚ä¸‹é¢ä¹ŸæŠŠ main æ”¹æˆ <code class=\"language-text\">runBlocking</code>ï¼Œæ–¹ä¾¿åŸ·è¡Œ Suspend Functionï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> ans <span class=\"token operator\">=</span> mutableListOf<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">100_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n        ans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> ans\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> runBlocking <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span> <span class=\"token punctuation\">{</span> value <span class=\"token operator\">-></span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä¸Šé¢çš„ç¯„ä¾‹å°±æœƒå°è¨˜æ†¶é«”ç”¢ç”Ÿä¸€å®šçš„è² æ“”ï¼Œé€™æ™‚å°±æ˜¯æ”¹æˆ Flow çš„å¥½æ™‚æ©Ÿï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> flow <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">100_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> runBlocking <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¯„ä¾‹æ²’æœ‰ä¸€æ¬¡ç”¢ç”Ÿä¸€å€‹å¾ˆå¤§çš„ Listï¼Œå†ä¸€æ¬¡æŠŠè³‡æ–™å›å‚³ï¼Œå¯«çš„ä¹Ÿå¯ä»¥æ›´ç°¡æ½”ã€‚</p>\n<h2>Flow is Cold</h2>\n<p>é€™å¥è©±çš„æ„æ€æ˜¯ï¼Œå¦‚æœ Flow æ²’æœ‰è¢« Collectï¼Œé‚£éº¼ Flow å°±æ°¸é ä¸æœƒè¢«åŸ·è¡Œã€‚</p>\n<p>ä¸‹é¢çš„ä¾‹å­æˆ‘å€‘åœ¨ Emit å‰åŠ ä¸Šä¸€å€‹ <code class=\"language-text\">println</code> ï¼Œä¸¦ç”¨ä¸€å€‹è®Šæ•¸æ¥ä½ä¸€å€‹ Flowï¼Œä½†ä¸å»å‘¼å« Collectï¼Œæ‰€ä»¥æœƒå…ˆè¼¸å‡º <code class=\"language-text\">Hello World</code> æ‰æœƒè¼¸å‡º <code class=\"language-text\">Start Flow</code>ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> flow <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Start Flow\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> runBlocking <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> n<span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Hello World\"</span></span><span class=\"token punctuation\">)</span>\n    n<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è¼¸å‡ºï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hello World\nStart Flow\n1\n2\n3\n4\n5</code></pre></div>\n<h2>Emit æ™‚ æ‰æœƒå‘¼å« Collect</h2>\n<p>æŠŠä¸Šé¢çš„ä¾‹å­å† emit å‰åŠ ä¸Šä¸€å€‹ <code class=\"language-text\">println()</code>ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> flow <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Start Flow\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"emit </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">i</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> runBlocking <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> n<span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Hello World\"</span></span><span class=\"token punctuation\">)</span>\n    n<span class=\"token punctuation\">.</span><span class=\"token function\">collect</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>çœ‹åˆ°è¼¸å‡ºå¯ä»¥ç™¼ç¾ï¼Œæœƒå…ˆçœ‹åˆ° emit() ä¸Šé¢çš„ print è¢«åŸ·è¡Œï¼Œæ‰æœƒåŸ·è¡Œåˆ°å‘¼å« collect æ™‚å‚³é€²å»çš„ functionã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hello World\nStart Flow\nemit 1\n1\nemit 2\n2\nemit 3\n3\nemit 4\n4\nemit 5\n5</code></pre></div>\n<h2>Flow çš„è³‡æ–™é‡æ˜¯å›ºå®šçš„</h2>\n<p>é€™å¥è©±çš„æ„æ€ä¸¦ä¸æ˜¯èªª flow åªèƒ½å®šç¾©å¥½æ•¸é‡å†å›å‚³ï¼Œè€Œæ˜¯èªªå¦‚æœ flow è£¡çš„æ‰€æœ‰ emit æ²’æœ‰è¢« collectï¼Œå°±æœƒå‡ºéŒ¯ã€‚</p>\n<p>ä¸‹é¢çš„ flow å°±ä¸€å®šè¦è¢« collect äº”æ¬¡ï¼Œå¦‚æœå› ç‚ºå‘¼å«ä»–çš„ function è¢«æ„å¤–ä¸­æ–·ï¼Œé€™å€‹ flow ä¹Ÿæœƒæ‹‹å‡ºéŒ¯èª¤ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">nums</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> flow <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>é‚£éº¼å¦‚æœæˆ‘åªè¦ä¸€å®šæ•¸é‡çš„è³‡æ–™æ€éº¼è¾¦ï¼Ÿä¸‹é¢ç¯„ä¾‹å–è‡ªå®˜æ–¹æ–‡ä»¶ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">numbers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> flow <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"This line will not execute\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Finally in numbers\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> runBlocking<span class=\"token operator\">&lt;</span>Unit<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">numbers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// take only the first two</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span> <span class=\"token punctuation\">{</span> value <span class=\"token operator\">-></span> <span class=\"token function\">println</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* output:\n1\n2\nFinally in numbers\n*/</span></code></pre></div>\n<h2>Flow mapping</h2>\n<p>Flow å¯ä»¥ç”¨ map çš„æ–¹å¼ï¼Œè½‰æ›æˆå¦ä¸€å€‹ Flowã€‚</p>\n<p>é€™å€‹ä¾‹å­ç”¢ç”Ÿå¹³æ–¹æ•¸ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">allNumbers</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> flow <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">square</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">allNumbers</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span> <span class=\"token punctuation\">{</span> it <span class=\"token operator\">*</span> it <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> runBlocking <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">square</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">it</span></span><span class=\"token string\"> \"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// output: 1 4 9 16 25 36 49 64 81 100</span></code></pre></div>\n<h2>Flow Filter</h2>\n<p>é€™å€‹ä¾‹å­è¼¸å‡º 1 åˆ° 100 ä¹‹é–“çš„æ‰€æœ‰è³ªæ•¸(å‹¿æ¨¡ä»¿ï¼Œæ•ˆç‡å ªæ†‚)ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">allNumbers</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> flow <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">1</span><span class=\"token operator\">..</span>n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">suspend</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">primeNumbers</span><span class=\"token punctuation\">(</span>n<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Flow<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">allNumbers</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">isPrime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> Int<span class=\"token punctuation\">.</span><span class=\"token function\">isPrime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Boolean <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token operator\">&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i <span class=\"token keyword\">in</span> <span class=\"token number\">2</span><span class=\"token operator\">..</span>this <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span> <span class=\"token operator\">%</span> i <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> runBlocking <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">primeNumbers</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">it</span></span><span class=\"token string\"> \"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// output: 2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97</span></code></pre></div>\n<blockquote>\n<p>ç¢å¿µï¼šé€™æ®µç¨‹å¼çœŸçš„å……åˆ†å±•ç¾ Kotlin çš„å¨åŠ›..</p>\n</blockquote>\n<h2>å¾Œè¨˜</h2>\n<p>Flow é‚„æœ‰å¾ˆå¤šè¤‡é›œçš„ç”¨æ³•ï¼Œåƒæ˜¯åˆä½µå…©å€‹ flow ä¹‹é¡çš„ï¼Œå»ºè­°æœ‰èˆˆè¶£çš„äººå¯ä»¥è‡ªå·±å»çœ‹å®˜æ–¹æ–‡ä»¶ã€‚</p>\n<p>å¦å¤–ï¼ŒKotlin å…¶å¯¦é‚„æœ‰ä¸€å€‹å«åš Sequence çš„ Interfaceï¼Œè·Ÿ Flow éå¸¸åƒï¼Œåœ¨ä¸æ˜¯éœ€è¦å¤šç·šç¨‹çš„æ™‚å€™å°±å·²ç¶“å¾ˆå¤ ç”¨ï¼ŒFlow ä¸»è¦åœ¨å¤šç·šç¨‹ä¸­ä½¿ç”¨ï¼ŒSequence å–®ç·šç¨‹ä¸­ä½¿ç”¨ã€‚</p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://kotlinlang.org/docs/flow.html\">Asynchronous Flow</a></li>\n</ul>","rawMarkdownBody":"\nKotlin åœ¨å¤šå·¥è™•ç†ä¸Šæä¾›éå¸¸å¥½ç”¨çš„ Coroutineã€‚ç•¶ä¸åŒ Job ä¹‹é–“éœ€è¦å‚³éè³‡æ–™æ™‚ï¼Œç¸½æœƒé‡åˆ°è¨±å¤šå•é¡Œï¼Œä»¥å‰æœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯ Callbackï¼Œä½† Callback æ¨¡å¼å·²ç¶“åœ¨å„å€‹ç¨‹å¼èªè¨€ä¸­ç”¢ç”Ÿè¨±å¤šå•é¡Œï¼Œé€™é‚Šå°±ä¸å¤šè¨è«–ã€‚Kotlin Coroutine å¦‚æœåªæ˜¯è¦å›å‚³ä¸€å€‹å€¼ï¼Œå¯ä»¥ç›´æ¥ç”¨ Suspend çš„ Return å€¼ï¼Œä½†å¦‚æœæ˜¯è¦å›å‚³å¾ˆå¤šè³‡æ–™å‘¢ï¼Ÿç°¡å–®çš„æ–¹å¼æ˜¯ç›´æ¥å›å‚³ Listï¼Œå¯æ˜¯å¦‚æœè³‡æ–™éå¸¸å¤§ï¼Œä¹Ÿæœƒç”¢ç”Ÿå‡ºå•é¡Œã€‚æ‰€ä»¥ Kotlin æä¾› Flow ä¾†å¹«åŠ©è§£æ±ºå¤§é‡è³‡æ–™å‚³éçš„å•é¡Œã€‚\n\n<!--more-->\n\n## Kotline Coroutine\n\nå¦‚æœé‚„ä¸çŸ¥é“ä»€éº¼æ˜¯ Coroutine çš„ï¼Œæˆ‘ä»¥å‰ä¹Ÿæœ‰å¯«é[Kotlin Coroutine](/posts/kotlin/kotlin-coroutine/)ã€‚\n\n## List OF Numbers\n\nè®“æˆ‘å€‘å…ˆä¾†çœ‹ä¸€å€‹ç°¡å–®çš„ç¯„ä¾‹ï¼Œç”¢ç”Ÿä¸€å€‹æœƒå›å‚³ 1 åˆ° 100 çš„ Int Functionï¼š\n\n```kotlin\nfun nums(): List<Int> {\n    val ans = mutableListOf<Int>()\n    for (i in 1..100) {\n        ans.add(i)\n    }\n    return ans\n}\n\nfun main() {\n    nums().forEach { value ->\n        println(value)\n    }\n}\n```\n\nä¹çœ‹ä¹‹ä¸‹æ²’ä»€éº¼å•é¡Œï¼Œä½†æ˜¯å¦‚æœé€™æ˜¯ä¸€å€‹éœ€è¦å¤§é‡ CPU æˆ– IO è™•ç†çš„å·¥ä½œè€Œä¸”å›å‚³å€¼éå¸¸å¤§ï¼Œå°±æœƒå°è¨˜æ†¶é«”ç”¢ç”Ÿè² æ“”ã€‚ä¸‹é¢å‡è¨­æˆ‘å€‘éœ€è¦ 1 åˆ° 100,000ï¼Œä¸¦ç”¨ `delay()` æ¨¡æ“¬ CPU å·¥ä½œï¼Œç„¶å¾Œæ”¹æˆ Suspend Functionã€‚ä¸‹é¢ä¹ŸæŠŠ main æ”¹æˆ `runBlocking`ï¼Œæ–¹ä¾¿åŸ·è¡Œ Suspend Functionï¼š\n\n```kotlin\nsuspend fun nums(): List<Int> {\n    val ans = mutableListOf<Int>()\n    for (i in 1..100_000) {\n        delay(100)\n        ans.add(i)\n    }\n    return ans\n}\n\nfun main() = runBlocking {\n    nums().forEach { value ->\n        println(value)\n    }\n}\n```\n\nä¸Šé¢çš„ç¯„ä¾‹å°±æœƒå°è¨˜æ†¶é«”ç”¢ç”Ÿä¸€å®šçš„è² æ“”ï¼Œé€™æ™‚å°±æ˜¯æ”¹æˆ Flow çš„å¥½æ™‚æ©Ÿï¼š\n\n```kotlin\nsuspend fun nums(): Flow<Int> = flow {\n    for (i in 1..100_000) {\n        delay(100)\n        emit(i)\n    }\n}\n\nfun main() = runBlocking {\n    nums().collect {\n        println(it)\n    }\n}\n```\n\nå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ç¯„ä¾‹æ²’æœ‰ä¸€æ¬¡ç”¢ç”Ÿä¸€å€‹å¾ˆå¤§çš„ Listï¼Œå†ä¸€æ¬¡æŠŠè³‡æ–™å›å‚³ï¼Œå¯«çš„ä¹Ÿå¯ä»¥æ›´ç°¡æ½”ã€‚\n\n## Flow is Cold\n\né€™å¥è©±çš„æ„æ€æ˜¯ï¼Œå¦‚æœ Flow æ²’æœ‰è¢« Collectï¼Œé‚£éº¼ Flow å°±æ°¸é ä¸æœƒè¢«åŸ·è¡Œã€‚\n\nä¸‹é¢çš„ä¾‹å­æˆ‘å€‘åœ¨ Emit å‰åŠ ä¸Šä¸€å€‹ `println` ï¼Œä¸¦ç”¨ä¸€å€‹è®Šæ•¸æ¥ä½ä¸€å€‹ Flowï¼Œä½†ä¸å»å‘¼å« Collectï¼Œæ‰€ä»¥æœƒå…ˆè¼¸å‡º `Hello World` æ‰æœƒè¼¸å‡º `Start Flow`ã€‚\n\n```kotlin\nsuspend fun nums(): Flow<Int> = flow {\n    println(\"Start Flow\")\n    for (i in 1..5) {\n        delay(100)\n        emit(i)\n    }\n}\n\nfun main() = runBlocking {\n    var n: Flow<Int> = nums()\n    println(\"Hello World\")\n    n.collect {\n        println(it)\n    }\n}\n```\n\nè¼¸å‡ºï¼š\n\n```text\nHello World\nStart Flow\n1\n2\n3\n4\n5\n```\n\n## Emit æ™‚ æ‰æœƒå‘¼å« Collect\n\næŠŠä¸Šé¢çš„ä¾‹å­å† emit å‰åŠ ä¸Šä¸€å€‹ `println()`ï¼š\n\n```kotlin\nsuspend fun nums(): Flow<Int> = flow {\n    println(\"Start Flow\")\n    for (i in 1..5) {\n        delay(100)\n        println(\"emit $i\")\n        emit(i)\n    }\n}\n\nfun main() = runBlocking {\n    var n: Flow<Int> = nums()\n    println(\"Hello World\")\n    n.collect {\n        println(it)\n    }\n}\n```\n\nçœ‹åˆ°è¼¸å‡ºå¯ä»¥ç™¼ç¾ï¼Œæœƒå…ˆçœ‹åˆ° emit() ä¸Šé¢çš„ print è¢«åŸ·è¡Œï¼Œæ‰æœƒåŸ·è¡Œåˆ°å‘¼å« collect æ™‚å‚³é€²å»çš„ functionã€‚\n\n```text\nHello World\nStart Flow\nemit 1\n1\nemit 2\n2\nemit 3\n3\nemit 4\n4\nemit 5\n5\n```\n\n## Flow çš„è³‡æ–™é‡æ˜¯å›ºå®šçš„\n\né€™å¥è©±çš„æ„æ€ä¸¦ä¸æ˜¯èªª flow åªèƒ½å®šç¾©å¥½æ•¸é‡å†å›å‚³ï¼Œè€Œæ˜¯èªªå¦‚æœ flow è£¡çš„æ‰€æœ‰ emit æ²’æœ‰è¢« collectï¼Œå°±æœƒå‡ºéŒ¯ã€‚\n\nä¸‹é¢çš„ flow å°±ä¸€å®šè¦è¢« collect äº”æ¬¡ï¼Œå¦‚æœå› ç‚ºå‘¼å«ä»–çš„ function è¢«æ„å¤–ä¸­æ–·ï¼Œé€™å€‹ flow ä¹Ÿæœƒæ‹‹å‡ºéŒ¯èª¤ã€‚\n\n```kotlin\nsuspend fun nums(): Flow<Int> = flow {\n    for (i in 1..5) {\n        emit(i)\n    }\n}\n```\n\né‚£éº¼å¦‚æœæˆ‘åªè¦ä¸€å®šæ•¸é‡çš„è³‡æ–™æ€éº¼è¾¦ï¼Ÿä¸‹é¢ç¯„ä¾‹å–è‡ªå®˜æ–¹æ–‡ä»¶ï¼š\n\n```kotlin\nfun numbers(): Flow<Int> = flow {\n    try {\n        emit(1)\n        emit(2)\n        println(\"This line will not execute\")\n        emit(3)\n    } finally {\n        println(\"Finally in numbers\")\n    }\n}\n\nfun main() = runBlocking<Unit> {\n    numbers()\n        .take(2) // take only the first two\n        .collect { value -> println(value) }\n}\n\n/* output:\n1\n2\nFinally in numbers\n*/\n```\n\n## Flow mapping\n\nFlow å¯ä»¥ç”¨ map çš„æ–¹å¼ï¼Œè½‰æ›æˆå¦ä¸€å€‹ Flowã€‚\n\né€™å€‹ä¾‹å­ç”¢ç”Ÿå¹³æ–¹æ•¸ï¼š\n\n```kotlin\nsuspend fun allNumbers(n: Int): Flow<Int> = flow {\n    for (i in 1..n) {\n        emit(i)\n    }\n}\n\nsuspend fun square(n: Int): Flow<Int> = allNumbers(n).map { it * it }\n\nfun main() = runBlocking {\n    square(10).collect {\n        print(\"$it \")\n    }\n}\n\n// output: 1 4 9 16 25 36 49 64 81 100\n```\n\n## Flow Filter\n\né€™å€‹ä¾‹å­è¼¸å‡º 1 åˆ° 100 ä¹‹é–“çš„æ‰€æœ‰è³ªæ•¸(å‹¿æ¨¡ä»¿ï¼Œæ•ˆç‡å ªæ†‚)ï¼š\n\n```kotlin\nsuspend fun allNumbers(n: Int): Flow<Int> = flow {\n    for (i in 1..n) {\n        emit(i)\n    }\n}\n\nsuspend fun primeNumbers(n: Int): Flow<Int> = allNumbers(n).filter { it.isPrime() }\n\nfun Int.isPrime(): Boolean {\n    if (this <= 1) return false\n    for (i in 2..this / 2) {\n        if (this % i == 0) {\n            return false\n        }\n    }\n    return true\n}\n\nfun main() = runBlocking {\n    primeNumbers(100).collect {\n        print(\"$it \")\n    }\n}\n\n// output: 2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97\n```\n\n> ç¢å¿µï¼šé€™æ®µç¨‹å¼çœŸçš„å……åˆ†å±•ç¾ Kotlin çš„å¨åŠ›..\n\n## å¾Œè¨˜\n\nFlow é‚„æœ‰å¾ˆå¤šè¤‡é›œçš„ç”¨æ³•ï¼Œåƒæ˜¯åˆä½µå…©å€‹ flow ä¹‹é¡çš„ï¼Œå»ºè­°æœ‰èˆˆè¶£çš„äººå¯ä»¥è‡ªå·±å»çœ‹å®˜æ–¹æ–‡ä»¶ã€‚\n\nå¦å¤–ï¼ŒKotlin å…¶å¯¦é‚„æœ‰ä¸€å€‹å«åš Sequence çš„ Interfaceï¼Œè·Ÿ Flow éå¸¸åƒï¼Œåœ¨ä¸æ˜¯éœ€è¦å¤šç·šç¨‹çš„æ™‚å€™å°±å·²ç¶“å¾ˆå¤ ç”¨ï¼ŒFlow ä¸»è¦åœ¨å¤šç·šç¨‹ä¸­ä½¿ç”¨ï¼ŒSequence å–®ç·šç¨‹ä¸­ä½¿ç”¨ã€‚\n\n## Reference\n\n- [Asynchronous Flow](https://kotlinlang.org/docs/flow.html)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/Kotlin/Kotlin Flow.md","excerpt":"Kotlin åœ¨å¤šå·¥è™•ç†ä¸Šæä¾›éå¸¸å¥½ç”¨çš„ Coroutineã€‚ç•¶ä¸åŒ Job ä¹‹é–“éœ€è¦å‚³éè³‡æ–™æ™‚ï¼Œç¸½æœƒé‡åˆ°è¨±å¤šå•é¡Œï¼Œä»¥å‰æœ€ç°¡å–®çš„æ–¹å¼å°±æ˜¯ Callbackï¼Œä½† Callback æ¨¡å¼å·²ç¶“åœ¨å„å€‹ç¨‹å¼èªè¨€ä¸­ç”¢ç”Ÿè¨±å¤šå•é¡Œï¼Œé€™é‚Šå°±ä¸å¤šè¨è«–ã€‚Kotlin Coroutine å¦‚æœåªæ˜¯è¦å›å‚³ä¸€å€‹å€¼ï¼Œå¯ä»¥ç›´æ¥ç”¨ Suspend çš„ Return å€¼ï¼Œä½†å¦‚æœæ˜¯è¦å›å‚³å¾ˆå¤šè³‡æ–™å‘¢ï¼Ÿç°¡å–®çš„æ–¹å¼æ˜¯ç›´æ¥å›å‚³ Listï¼Œå¯â€¦","frontmatter":{"title":"Kotlin Flow","date":"2022-04-17T14:00:13.000Z","draft":false,"tags":["kotlin","coroutines","flow","android"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/973beda6-caa9-4559-1f92-8ab5bd7d2700/public","description":null}}},{"node":{"id":"90e0fd93-6420-5e55-aef4-b691b3fcf6e2","html":"<p>æœ€è¿‘å¸¸å¸¸æœƒçœ‹åˆ°åˆ¥å…¥ GitHub ä¸Šçš„ Commit æœƒæœ‰ Verified çš„å­—æ¨£ï¼ŒæŸ¥äº†æ‰çŸ¥é“é€™æ˜¯ç‚ºäº†é˜²æ­¢æœ‰äººç›œç”¨ä½ çš„ email ç°½ commitï¼Œç•¢ç«Ÿ git çš„ user.email æ˜¯å¯ä»¥è‡ªå·±éš¨ä¾¿è¨­çš„ï¼Œæ‰€ä»¥ GitHub å°±æä¾›ä¸€å€‹å¯ä»¥ç”¨å…¬ç§é‘°çš„æ–¹å¼ä¾†ç¢ºèªèº«ä»½ã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/6e429f76-94c1-46ff-77da-7d50a886d100/public\" alt=\"img\"></p>\n<!--more-->\n<h2>GnuPG</h2>\n<p>æˆ‘å€‘è¦åˆ©ç”¨ GnuPG ä¾†ç”¢ç”Ÿé‡‘é‘°å’Œç°½ç½² Commitï¼Œç•¶ç„¶è¦å…ˆå®‰è£ä»–ï¼Œå¯ä»¥è‡ªå·±æŸ¥ä¸€ä¸‹è‡ªå·±çš„ OS è¦æ€éº¼è£ï¼š</p>\n<p><a href=\"https://www.gnupg.org/download\">Download GnuPG</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">brew install gnupg     # macOS\nchoco install gnupg    # Windows\napt install gnupg      # Ubuntu</code></pre></div>\n<h2>ç”¢ç”Ÿ GPG Key</h2>\n<p>ç”¨ä¸‹é¢çš„ä¸€è¡ŒæŒ‡ä»¤å°±æœƒé€²åˆ°äº’å‹•å¼çš„ç•«é¢ï¼Œæ¥ä¸‹ä¾†éœ€è¦è¼¸å…¥ä¸€äº›è³‡æ–™ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gpg --full-generate-key</code></pre></div>\n<ol>\n<li>ç”¢ç”Ÿ Rsa and Rsa</li>\n<li>GitHub å»ºè­°ä½¿ç”¨ 4096ï¼Œæœ€è¤‡é›œçš„å°±å°äº†</li>\n<li>é‡‘é‘°è¦ä¸è¦éæœŸå¯ä»¥è‡ªå·±è©•ä¼°ï¼Œæˆ‘æ˜¯é¸ä¸éæœŸ</li>\n<li>ç¢ºèªè³‡æ–™è¼¸å…¥æ­£ç¢º</li>\n</ol>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/d6411985-0b33-4ab2-e883-f95ce0da3c00/public\" alt=\"img\"></p>\n<ol>\n<li>è¼¸å…¥è¦ç°½ç½²çš„åå­—</li>\n<li>è¼¸å…¥è¦ç°½ç½²çš„ emailï¼Œæ³¨æ„å¿…é ˆèˆ‡ GitHub Email å’Œ <code class=\"language-text\">git config user.email</code> çš„ä¸€æ¨£ã€‚</li>\n<li>è¨»é‡‹éš¨ä¾¿è¼¸å…¥å³å¯</li>\n<li>ç¢ºèªè³‡æ–™è¼¸å…¥æ­£ç¢º</li>\n</ol>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/594a269c-ab4f-4484-fa9a-c74307454600/public\" alt=\"img\"></p>\n<p>æ¥ä¸‹ä¾†æœƒè·³å‡ºä¸€å€‹è¦è¼¸å…¥å¯†ç¢¼çš„ç•«é¢ï¼Œä¸€æ¨£ä¾è‡ªå·±éœ€æ±‚è¨­å®šå³å¯</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/6b11a19b-c7fa-4697-0861-5fb4c66ff800/public\" alt=\"img\"></p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/56a8fc50-5a1e-4a0e-e9ef-30b9fe74fc00/public\" alt=\"img\"></p>\n<p>é€™æ¨£å°±ç”¢ç”ŸæˆåŠŸäº†ï¼Œå¯ä»¥è¨˜ä¸€ä¸‹é€™å€‹ç•«é¢å‡ºç¾çš„è³‡æ–™</p>\n<p>å¦‚æœè¦é¡¯ç¤ºæ‰€æœ‰çš„ Keyï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gpg --list-secret-keys</code></pre></div>\n<h2>è¤‡è£½ GPG Key åˆ° GitHub</h2>\n<p>ç”¨å„å€‹æŒ‡ä»¤ä¾†é¡¯ç¤ºå…¬é‘°ï¼Œä¸¦ä¸”è¤‡è£½åˆ° GitHub ä¸Šï¼ŒåŒ…å« Begin å’Œ End å…©è¡Œï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gpg --armor --export <span class=\"token operator\">&lt;</span>Your Key<span class=\"token operator\">></span></code></pre></div>\n<p>é€²åˆ°è¨­å®šè£¡ï¼Œæ–°å¢ GPG Keyï¼Œè²¼ä¸Šå‰›å‰›è¤‡è£½ä¸‹çš„é‡‘é‘°</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/8a75edb9-4a08-4060-608a-d63353a77c00/public\" alt=\"img\"></p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/9c5ad211-0bcc-4058-a304-6903e69c8700/public\" alt=\"img\"></p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/0ef8e55b-7f1b-43ab-cd40-43303b98bc00/public\" alt=\"img\"></p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/32e1e3a5-2fdc-4e6d-aef3-08122d448d00/public\" alt=\"img\"></p>\n<h2>ç°½ç½² Commit</h2>\n<p>è¦ç°½ç½² Commit æˆ‘å€‘éœ€è¦å…ˆå‘Šè¨´ git æˆ‘å€‘è¦ç”¨å“ªæ”¯é‘°åŒ™ï¼Œä¹Ÿæ˜¯ç”¨ git config è¨­å®šï¼Œå¦‚æœè¦æ¯å€‹å€‰åº«éƒ½ç”¨é€™æ”¯é‘°åŒ™ï¼Œå¯ä»¥ç›´æ¥è¨­å®š globalï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> config user.signingkey <span class=\"token operator\">&lt;</span>Your Key<span class=\"token operator\">></span>\n<span class=\"token function\">git</span> config --global user.signingkey <span class=\"token operator\">&lt;</span>Your Key<span class=\"token operator\">></span></code></pre></div>\n<p>è¨­å®šå¥½å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹ç°½ Commitï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åœ¨ Commit æ™‚åŠ ä¸Š <code class=\"language-text\">-S</code>ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> commit -S -m <span class=\"token string\">\"Commit Message\"</span></code></pre></div>\n<p>å¦‚æœè¦ºå¾—æ¯æ¬¡éƒ½è¦åŠ ä¸Šåƒæ•¸å¾ˆéº»ç…©ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åŠ åˆ° config ä¸­ï¼Œè®“æ¯æ¬¡ Commit éƒ½é è¨­ç°½ç½²ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> config commit.gpgsign <span class=\"token boolean\">true</span>\n<span class=\"token function\">git</span> config --global commit.gpgsign <span class=\"token boolean\">true</span></code></pre></div>\n<p>æ¥ä¸‹ä¾†ï¼Œåªè¦ push åˆ° GitHub ä¸Šï¼Œå°±æœƒçœ‹åˆ°æœ‰ Verified çš„æ¨™ç±¤ï¼š</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/6e429f76-94c1-46ff-77da-7d50a886d100/public\" alt=\"img\"></p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key\">Generating a new GPG key</a></li>\n<li><a href=\"https://docs.github.com/en/authentication/managing-commit-signature-verification/adding-a-new-gpg-key-to-your-github-account\">Adding a new GPG key to your GitHub account</a></li>\n<li><a href=\"https://www.gnupg.org/\">GnuPG</a></li>\n</ul>","rawMarkdownBody":"\næœ€è¿‘å¸¸å¸¸æœƒçœ‹åˆ°åˆ¥å…¥ GitHub ä¸Šçš„ Commit æœƒæœ‰ Verified çš„å­—æ¨£ï¼ŒæŸ¥äº†æ‰çŸ¥é“é€™æ˜¯ç‚ºäº†é˜²æ­¢æœ‰äººç›œç”¨ä½ çš„ email ç°½ commitï¼Œç•¢ç«Ÿ git çš„ user.email æ˜¯å¯ä»¥è‡ªå·±éš¨ä¾¿è¨­çš„ï¼Œæ‰€ä»¥ GitHub å°±æä¾›ä¸€å€‹å¯ä»¥ç”¨å…¬ç§é‘°çš„æ–¹å¼ä¾†ç¢ºèªèº«ä»½ã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/6e429f76-94c1-46ff-77da-7d50a886d100/public)\n\n<!--more-->\n\n## GnuPG\n\næˆ‘å€‘è¦åˆ©ç”¨ GnuPG ä¾†ç”¢ç”Ÿé‡‘é‘°å’Œç°½ç½² Commitï¼Œç•¶ç„¶è¦å…ˆå®‰è£ä»–ï¼Œå¯ä»¥è‡ªå·±æŸ¥ä¸€ä¸‹è‡ªå·±çš„ OS è¦æ€éº¼è£ï¼š\n\n[Download GnuPG](https://www.gnupg.org/download)\n\n```text\nbrew install gnupg     # macOS\nchoco install gnupg    # Windows\napt install gnupg      # Ubuntu\n```\n\n## ç”¢ç”Ÿ GPG Key\n\nç”¨ä¸‹é¢çš„ä¸€è¡ŒæŒ‡ä»¤å°±æœƒé€²åˆ°äº’å‹•å¼çš„ç•«é¢ï¼Œæ¥ä¸‹ä¾†éœ€è¦è¼¸å…¥ä¸€äº›è³‡æ–™ï¼š\n\n```shell\ngpg --full-generate-key\n```\n\n1. ç”¢ç”Ÿ Rsa and Rsa\n2. GitHub å»ºè­°ä½¿ç”¨ 4096ï¼Œæœ€è¤‡é›œçš„å°±å°äº†\n3. é‡‘é‘°è¦ä¸è¦éæœŸå¯ä»¥è‡ªå·±è©•ä¼°ï¼Œæˆ‘æ˜¯é¸ä¸éæœŸ\n4. ç¢ºèªè³‡æ–™è¼¸å…¥æ­£ç¢º\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/d6411985-0b33-4ab2-e883-f95ce0da3c00/public)\n\n1. è¼¸å…¥è¦ç°½ç½²çš„åå­—\n2. è¼¸å…¥è¦ç°½ç½²çš„ emailï¼Œæ³¨æ„å¿…é ˆèˆ‡ GitHub Email å’Œ `git config user.email` çš„ä¸€æ¨£ã€‚\n3. è¨»é‡‹éš¨ä¾¿è¼¸å…¥å³å¯\n4. ç¢ºèªè³‡æ–™è¼¸å…¥æ­£ç¢º\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/594a269c-ab4f-4484-fa9a-c74307454600/public)\n\næ¥ä¸‹ä¾†æœƒè·³å‡ºä¸€å€‹è¦è¼¸å…¥å¯†ç¢¼çš„ç•«é¢ï¼Œä¸€æ¨£ä¾è‡ªå·±éœ€æ±‚è¨­å®šå³å¯\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/6b11a19b-c7fa-4697-0861-5fb4c66ff800/public)\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/56a8fc50-5a1e-4a0e-e9ef-30b9fe74fc00/public)\n\né€™æ¨£å°±ç”¢ç”ŸæˆåŠŸäº†ï¼Œå¯ä»¥è¨˜ä¸€ä¸‹é€™å€‹ç•«é¢å‡ºç¾çš„è³‡æ–™\n\nå¦‚æœè¦é¡¯ç¤ºæ‰€æœ‰çš„ Keyï¼š\n\n```shell\ngpg --list-secret-keys\n```\n\n## è¤‡è£½ GPG Key åˆ° GitHub\n\nç”¨å„å€‹æŒ‡ä»¤ä¾†é¡¯ç¤ºå…¬é‘°ï¼Œä¸¦ä¸”è¤‡è£½åˆ° GitHub ä¸Šï¼ŒåŒ…å« Begin å’Œ End å…©è¡Œï¼š\n\n```shell\ngpg --armor --export <Your Key>\n```\n\né€²åˆ°è¨­å®šè£¡ï¼Œæ–°å¢ GPG Keyï¼Œè²¼ä¸Šå‰›å‰›è¤‡è£½ä¸‹çš„é‡‘é‘°\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/8a75edb9-4a08-4060-608a-d63353a77c00/public)\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/9c5ad211-0bcc-4058-a304-6903e69c8700/public)\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/0ef8e55b-7f1b-43ab-cd40-43303b98bc00/public)\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/32e1e3a5-2fdc-4e6d-aef3-08122d448d00/public)\n\n## ç°½ç½² Commit\n\nè¦ç°½ç½² Commit æˆ‘å€‘éœ€è¦å…ˆå‘Šè¨´ git æˆ‘å€‘è¦ç”¨å“ªæ”¯é‘°åŒ™ï¼Œä¹Ÿæ˜¯ç”¨ git config è¨­å®šï¼Œå¦‚æœè¦æ¯å€‹å€‰åº«éƒ½ç”¨é€™æ”¯é‘°åŒ™ï¼Œå¯ä»¥ç›´æ¥è¨­å®š globalï¼š\n\n```shell\ngit config user.signingkey <Your Key>\ngit config --global user.signingkey <Your Key>\n```\n\nè¨­å®šå¥½å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹ç°½ Commitï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯åœ¨ Commit æ™‚åŠ ä¸Š `-S`ï¼š\n\n```shell\ngit commit -S -m \"Commit Message\"\n```\n\nå¦‚æœè¦ºå¾—æ¯æ¬¡éƒ½è¦åŠ ä¸Šåƒæ•¸å¾ˆéº»ç…©ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åŠ åˆ° config ä¸­ï¼Œè®“æ¯æ¬¡ Commit éƒ½é è¨­ç°½ç½²ï¼š\n\n```shell\ngit config commit.gpgsign true\ngit config --global commit.gpgsign true\n```\n\næ¥ä¸‹ä¾†ï¼Œåªè¦ push åˆ° GitHub ä¸Šï¼Œå°±æœƒçœ‹åˆ°æœ‰ Verified çš„æ¨™ç±¤ï¼š\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/6e429f76-94c1-46ff-77da-7d50a886d100/public)\n\n## Reference\n\n- [Generating a new GPG key](https://docs.github.com/en/authentication/managing-commit-signature-verification/generating-a-new-gpg-key)\n- [Adding a new GPG key to your GitHub account](https://docs.github.com/en/authentication/managing-commit-signature-verification/adding-a-new-gpg-key-to-your-github-account)\n- [GnuPG](https://www.gnupg.org/)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/Git/github gpg.md","excerpt":"æœ€è¿‘å¸¸å¸¸æœƒçœ‹åˆ°åˆ¥å…¥ GitHub ä¸Šçš„ Commit æœƒæœ‰ Verified çš„å­—æ¨£ï¼ŒæŸ¥äº†æ‰çŸ¥é“é€™æ˜¯ç‚ºäº†é˜²æ­¢æœ‰äººç›œç”¨ä½ çš„ email ç°½ commitï¼Œç•¢ç«Ÿ git çš„ user.email æ˜¯å¯ä»¥è‡ªå·±éš¨ä¾¿è¨­çš„ï¼Œæ‰€ä»¥ GitHub å°±æä¾›ä¸€å€‹å¯ä»¥ç”¨å…¬ç§é‘°çš„æ–¹å¼ä¾†ç¢ºèªèº«ä»½ã€‚ img GnuPG æˆ‘å€‘è¦åˆ©ç”¨ GnuPG ä¾†ç”¢ç”Ÿé‡‘é‘°å’Œç°½ç½² Commitï¼Œç•¶ç„¶è¦å…ˆå®‰è£ä»–ï¼Œå¯ä»¥è‡ªå·±æŸ¥ä¸€ä¸‹è‡ªå·±çš„ OS è¦æ€â€¦","frontmatter":{"title":"GitHub GPG - Verified Commit","date":"2022-03-24T14:32:19.000Z","draft":false,"tags":["git","github","gpg","verified","commit"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/eb2adedc-6625-46d1-73ea-07c01fc92000/public","description":"æœ€è¿‘å¸¸å¸¸æœƒçœ‹åˆ°åˆ¥å…¥ GitHub ä¸Šçš„ Commit æœƒæœ‰ Verified çš„å­—æ¨£ï¼ŒæŸ¥äº†æ‰çŸ¥é“é€™æ˜¯ç‚ºäº†é˜²æ­¢æœ‰äººç›œç”¨ä½ çš„ email ç°½ commitï¼Œç•¢ç«Ÿ git çš„ user.email æ˜¯å¯ä»¥è‡ªå·±éš¨ä¾¿è¨­çš„ï¼Œæ‰€ä»¥ GitHub å°±æä¾›ä¸€å€‹å¯ä»¥ç”¨å…¬ç§é‘°çš„æ–¹å¼ä¾†ç¢ºèªèº«ä»½ã€‚"}}},{"node":{"id":"8e495473-8d57-530c-bb3f-4262fce2dde7","html":"<p>èªªåˆ°æœå°‹çš„è§£æ±ºæ–¹æ¡ˆï¼Œæœ€æœ‰åçš„å¤§æ¦‚å°±æ˜¯ <a href=\"https://www.algolia.com/\">Algolia</a>ï¼Œå¯ä»¥æ–¹ä¾¿çš„å‰µå»ºç´¢å¼•ï¼Œä¹Ÿæœ‰å¾ˆå¤šå¯«å¥½çš„å‰ç«¯ç¶²é å…ƒä»¶å¯ä»¥ä½¿ç”¨ï¼Œå”¯ä¸€çš„ç¼ºé»å°±æ˜¯æ”¶è²»ã€‚é›–ç„¶ Algolia è¦æ”¶è²»ï¼Œä½†å…¶å¯¦å°æ–¼æˆ‘é€™å€‹å°ç¶²é éƒ½ç´¢å¼•é‡æ˜¯å®Œå…¨ä¸ç”¨éŒ¢çš„ï¼Œä½†æ˜¯å°±é‚„æ˜¯è¦ºå¾—è‡ªå·±æ¶ä¸€å€‹ç´¢å¼•ç³»çµ±æ¯”è¼ƒæœ‰æ„Ÿè¦ºï¼Œç„¶å¾Œæˆ‘å°±åœ¨ GitHub ä¸Šç™¼ç¾äº†é–‹æºçš„ <a href=\"https://meilisearch.com\">MeiliSearch</a>ï¼ŒåŠŸèƒ½åŸºæœ¬ä¸Šè·Ÿ Algolia å¾ˆåƒï¼Œä¹Ÿæ”¯æ´ä¸­æ–‡ï¼Œç”šè‡³æœ‰äº›å‰ç«¯å…ƒä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ Algolia çš„ï¼Œç¼ºé»å°±æ˜¯è¦è‡ªå·±æ¶è¨­ Serverã€‚</p>\n<!--more-->\n<p>æœ¬æ–‡ä»¥æœå°‹æœ¬ç«™ç‚ºç›®çš„æ’°å¯«ï¼Œæ‰€ä»¥å¾Œé¢çš„ç¯„ä¾‹å¤§å¤šèˆ‡ Hugo ç›¸é—œï¼Œå¦‚æœæƒ³è¦çœ‹å®Œæ•´çš„ç¨‹å¼ç¢¼ï¼Œå¯ä»¥ç›´æ¥åˆ°æœ¬ç«™çš„ GitHubã€‚</p>\n<h2>ç°¡ä»‹ MeiliSearch Server</h2>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/f93885e8-f670-44ec-ea24-264a97c9a500/public\" alt=\"img\"></p>\n<p>åŸºæœ¬ä¸Š MeiliSearch å°±æ˜¯ä¸€å€‹ RESTful APIï¼Œç›®æ¨™æ˜¯è¦æä¾›ç¾æˆçš„æœå°‹è§£æ±ºæ–¹æ¡ˆï¼Œå®Œå…¨é–‹æºï¼Œæä¾›å³æ™‚æœå°‹ã€æ‹¼å¯«éŒ¯èª¤ã€åŒç¾©è©ã€æ¨¡ç³Šæœå°‹ã€è‡ªè¨‚æ’åã€æ’åºå’Œå¤šèªè¨€æœå°‹çš„æ”¯æ´ï¼Œé€£ä¸­æ–‡ä¹Ÿä¸ä¾‹å¤–ã€‚æ ¹æ“šå®˜æ–¹æ–‡ä»¶çš„ä»‹ç´¹ï¼ŒMeiliSearch ä»¥æ˜“ç”¨æ€§ç‚ºé¦–è¦ç›®æ¨™ï¼Œå°æ–¼é–‹ç™¼è€…ï¼Œåªéœ€è¦å°‘å°‘å¹¾è¡Œ code å°±å¯ä»¥ä½¿ç”¨ï¼›å°æ–¼ä½¿ç”¨è€…ï¼Œæä¾›ç›´è§€çš„å³æ™‚è¼¸å…¥å³æ™‚åæ‡‰çš„æœå°‹çµæœã€‚</p>\n<p>å®˜æ–¹ä¹Ÿæœ‰å¾ˆå¤šçš„ SDKï¼Œ.NET, Dart, Go, Java, JS, Python, Swiftï¼Œè€Œä¸”ä¸Šé¢é€™äº›é‚„ä¸æ˜¯å…¨éƒ¨ï¼Œæ‰€ä»¥åœ¨é–‹ç™¼å„èªè¨€çš„æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œéƒ½å¯ä»¥è€ƒæ…®ç”¨ MeiliSearch åšç‚ºå¾Œç«¯æœå°‹å¼•æ“ã€‚</p>\n<p>MeiliSearch ä¹Ÿä¸æ˜¯å®Œå…¨æ²’æœ‰ç¼ºé»ï¼Œç¼ºé»å°±æ˜¯è¦è‡ªå·±æœ‰ä¼ºæœå™¨ï¼Œåƒæ˜¯æœ¬æ–‡ä»Šå¤©çš„æ¡ˆä¾‹å°±æ˜¯è¦å¹« Static Site åšæœå°‹çš„åŠŸèƒ½ï¼Œé€šå¸¸ Static Site å¤§å®¶æ‡‰è©²éƒ½æ˜¯ç”¨ GitHub Pages ç­‰ Statice Site Hosting æœå‹™ï¼Œæ‰€ä»¥ç¶²é æœ¬èº«æ˜¯æ²’æœ‰è‡ªå·±æ¶ Server çš„ï¼Œç‚ºäº†åŠ å€‹æœå°‹åŠŸèƒ½æœƒè¦å¤šä¸€å€‹ Server å°±æ˜¯å¾ˆå¤§çš„ç¼ºé»ã€‚</p>\n<h2>SearchIndex.json</h2>\n<p>åœ¨é–‹å§‹ä½¿ç”¨ MeiliSearch ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†æŠŠè¦ç´¢å¼•çš„è³‡æ–™æº–å‚™å¥½ï¼ŒMeiliSearch æœƒéœ€è¦ä½¿ç”¨ json ç•¶ä½œç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘å€‘è¦ç”¢ç”Ÿä¸€å€‹ json çš„ç¯„æœ¬ã€‚å‰µå»º <code class=\"language-text\">/layouts/list.searchindex.json</code>ï¼Œå…§å®¹å¦‚ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[ {{- $i := 0 -}}\n    {{- range where .Site.RegularPages \"Section\" \"ne\" \"\" -}}\n       {{- if not .Params.noSearch -}}\n          {{- if gt $i 0 }},{{ end -}}\n          {\"id\":{{ $i }}, \"date\":\"{{ .Date.Unix }}\", \"url\":\"{{ .Permalink }}\", \"title\":{{ .Title | jsonify  }}, \"summary\":{{ with .Description}}{{ . | plainify | jsonify }}{{ else }}{{ .Summary | plainify | jsonify }}{{ end }}, \"content\":{{ .Content | plainify | jsonify }},\"tags\":[ {{- $t := 0 }}{{- range .Param \"tags\" -}}{{ if gt $t 0 }},{{ end }}{{ . | jsonify }}{{ $t = add $t 1 }}{{ end -}} ], \"section\": {{ .Section | jsonify -}} }\n        {{- $i = add $i 1 -}}\n    {{- end -}}\n{{- end -}} ]</code></pre></div>\n<p>ç„¶å¾Œåœ¨ <code class=\"language-text\">config.yaml</code> ä¸­åŠ å…¥ä¸‹é¢çš„è¨­å®šå€¼ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">outputFormats</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">SearchIndex</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">mediaType</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/json\"</span>\n    <span class=\"token key atrule\">baseName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"searchindex\"</span>\n    <span class=\"token key atrule\">isPlainText</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">notAlternative</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n<span class=\"token key atrule\">outputs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">home</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"HTML\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"RSS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"SearchIndex\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>å®Œæˆä¸Šé¢å…©æ¨£è¨­å®šå¾Œï¼Œå¯ä»¥ <code class=\"language-text\">hugo</code> ä¸€ä¸‹è©¦è©¦çœ‹ï¼Œæœ‰æ²’æœ‰åœ¨ <code class=\"language-text\">/public/searchindex.json</code> ä¸­çœ‹åˆ°ç´¢å¼•æª”æ¡ˆï¼Œæ‡‰è©²æœƒé¡ä¼¼å¦‚ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1622891718\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"https://tonypepe.com/posts/others/hello-world/\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"summary\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Hello World. This is a test post.\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"This is my first post in hugo\\ncontent\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"tags\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"hugo\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"section\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"posts\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>æ¶è¨­ MeiliSearch Server</h2>\n<p>æº–å‚™å¥½ç´¢å¼•æª”æ¡ˆå¾Œï¼Œæˆ‘å€‘å°±ä¾†æ¶è¨­ MeiliSearch çš„ Serverï¼ŒMeiliSearch æ˜¯ç”¨ Rust ç·¨å¯«ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯è·¨å¹³å°é€šç”¨ã€‚å®˜æ–¹æä¾›å¾ˆå¤šç¨®å®‰è£æ–¹å¼ï¼Œé‚„æœ‰ä¸€éµå•Ÿå‹•è…³æœ¬ï¼Œç•¶ç„¶ï¼Œç‚ºäº†é¿å…å¼„é«’ç’°å¢ƒï¼Œæœ€æ¨è–¦çš„ç•¶ç„¶é‚„æ˜¯ Dockerï¼Œä¸‹é¢å°±å…ˆä»¥ Docker ç‚ºç¯„ä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run -it --rm <span class=\"token punctuation\">\\</span>\n    -p <span class=\"token number\">7700</span>:7700 <span class=\"token punctuation\">\\</span>\n    -v <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>/data.ms:/data.ms <span class=\"token punctuation\">\\</span>\n    getmeili/meilisearch:latest</code></pre></div>\n<p>æ³¨æ„ä¸€ä¸‹ï¼Œä¸Šé¢æ›è¼‰äº†ä¸€å€‹ <code class=\"language-text\">data.ms</code> çš„è³‡æ–™å¤¾ï¼Œæ‰€ä»¥åœ¨åŸ·è¡Œä¸Šé¢çš„æŒ‡ä»¤å‰ï¼Œè¨˜å¾—å…ˆå‰µå»ºå¥½ã€‚<code class=\"language-text\">data.ms</code> é€™å€‹è³‡æ–™å¤¾æ˜¯ç‚ºäº†å­˜æ”¾ç´¢å¼•è³‡æ–™ï¼Œé¿å…å› ç‚º Docker å®¹å™¨é‡å•Ÿå°±æå¤±è³‡æ–™ï¼Œæ‰€ä»¥å¾ˆé‡è¦ã€‚</p>\n<p>ç¾åœ¨å¯ä»¥åˆ° <a href=\"http://localhost:7700\">http://localhost:7700</a>ï¼Œæœƒçœ‹åˆ°æœ‰ä¸€å€‹ç°¡æ˜“çš„ WEB UIã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/5664dc51-5d55-415a-3633-ac45e17d7a00/public\" alt=\"img\"></p>\n<p>å¦‚æœä¸æƒ³ç”¨ Dockerï¼Œé‚„æ˜¯å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„å…¶ä»–å®‰è£æ–¹å¼å®‰è£ã€‚</p>\n<h2>æäº¤ç´¢å¼•è³‡æ–™</h2>\n<p>å‰é¢æœ‰æåˆ° MeiliSearch æ˜¯ RESTful APIï¼Œæ‰€ä»¥è¦å‘ä»–æœå°‹æˆ–æ˜¯æä¾›è³‡æ–™ï¼Œéƒ½æ˜¯ç”¨ HTTP Methodã€‚å®˜æ–¹æ–‡ä»¶å¯«çš„éƒ½æ˜¯ curlï¼Œæˆ‘å€‘é‚„æ˜¯ä½¿ç”¨ GUI çš„æ–¹å¼ä»‹ç´¹ã€‚HTTP çš„ GUI å¤§å®¶æ‡‰è©²éƒ½æœƒæƒ³åˆ° Postmanï¼Œä½†ä»Šå¤©æˆ‘å€‘è¦ä½¿ç”¨ä»–çš„é–‹æºæ›¿ä»£ <a href=\"https://hoppspot.io\">Hoppsotch</a>ï¼Œä»–æ˜¯ä¸€å€‹ç¶²é å·¥å…·ï¼Œæ‰€ä»¥ä¸éœ€è¦å®‰è£ã€‚</p>\n<p>å¯ä»¥å…ˆå° <code class=\"language-text\">/health</code> åš <code class=\"language-text\">GET</code> è©¦è©¦çœ‹æœ‰æ²’æœ‰é€£ä¸Šï¼Œå¦‚æœæ²’æœ‰é€£ä¸Šï¼Œå¯èƒ½è¦æª¢æŸ¥ä¸€ä¸‹æœ‰æ²’æœ‰æˆåŠŸå•Ÿå‹• MeiliSearch Serverã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/cf86e106-a1f6-472e-d2c1-a6b186944f00/public\" alt=\"img\"></p>\n<p>ç¢ºå®šé€£ä¸Šå¾Œï¼Œæˆ‘å€‘å°±ä¾†æäº¤ç´¢å¼•è³‡æ–™ï¼Œå¦‚æœé‚„æ²’æœ‰ Hugo ç”¢ç”Ÿçš„ç´¢å¼•è³‡æ–™ï¼Œå¯ä»¥å…ˆåˆ°æœ¬ç«™çš„ GitHubï¼Œæ‹¿æœ¬ç«™çš„ <a href=\"https://github.com/TonyPepeBear/HugoBlog/blob/1bfae9859a44338d24a9f6676be37f72cc983505/searchindex.json\">searchindex.json</a> åšæ¸¬è©¦ã€‚</p>\n<p>å› ç‚º MeiliSearch ä¹Ÿå¯ä»¥åŒæ™‚æœ‰å¤šå€‹ Indexes åšæœå°‹ï¼Œæˆ‘å€‘ä¸‹é¢çš„ç¯„ä¾‹ä»¥ <code class=\"language-text\">hugo_blog</code> ä½œç‚ºç¯„ä¾‹åç¨±ï¼Œå¤§å®¶å¯ä»¥æ ¹æ“šéœ€æ±‚è‡ªå·±æ±ºå®šä½¿ç”¨çš„åç¨±ã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/71797a57-6f97-44cd-f4dc-675ec42ffd00/public\" alt=\"img\"></p>\n<p>å¯ä»¥çœ‹åˆ°ä¸Šåœ–å° <code class=\"language-text\">/indexes/&lt;&lt;IndexName>>/documents</code> åš <code class=\"language-text\">POST</code> æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠç´¢å¼•è³‡æ–™æäº¤åˆ° MeiliSearch Serverã€‚è¨˜å¾—å…§å®¹é¡å‹æ˜¯ <code class=\"language-text\">application/json</code>ï¼Œç„¶å¾ŒæŠŠç´¢å¼•è³‡æ–™æ”¾åˆ° bodyã€‚</p>\n<p>ç¾åœ¨å›åˆ° <a href=\"http://localhost:7700\">localhost:7700</a>ï¼Œæ‡‰è©²å°±å¯ä»¥çœ‹åˆ°åŸæœ¬ç©ºç©ºå¦‚ä¹Ÿçš„ WEB UI ç¾åœ¨å¯ä»¥åšæœå°‹äº†ï¼Œå¯ä»¥å…ˆåœ¨é€™è£¡åšä¸€äº›ç°¡å–®çš„æœå°‹ï¼Œè©¦è©¦çœ‹è‡ªå·±çš„ç´¢å¼•è³‡æ–™æœ‰æ²’æœ‰è¢«æˆåŠŸçš„ä½¿ç”¨ã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/c58970b0-53b5-4a16-50bb-ff40fa6fde00/public\" alt=\"img\"></p>\n<h2>MeiliSearch in Production</h2>\n<p>MeiliSearch é è¨­çš„å•Ÿå‹•æ–¹å¼å…¶å¯¦æ˜¯ <code class=\"language-text\">development</code>ï¼Œé€™æ¨¡å¼åªæ˜¯æ–¹ä¾¿æœ¬åœ°åšæ¸¬è©¦ä½¿ç”¨çš„ï¼Œå¦‚æœè¦ä½¿ç”¨åœ¨ç”Ÿç”¢ç’°å¢ƒï¼Œæ‡‰è©²è¦ä»¥ <code class=\"language-text\">production</code> æ¨¡å¼å•Ÿå‹•ã€‚åœ¨ Production æ¨¡å¼ä¸‹ï¼Œæœƒæœ‰å…©å€‹ä¸ä¸€æ¨£çš„åœ°æ–¹ï¼Œç¬¬ä¸€é …æ˜¯ Web UI æœƒè¢«åœç”¨ï¼Œç¬¬äºŒé …æ˜¯æœƒå¿…é ˆè¦è¨­å®š <code class=\"language-text\">Master Key</code>ï¼Œä¸‹é¢é‚„æ˜¯ç”¨ Docker ä½œç‚ºç¯„ä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">docker</span> run -it --rm <span class=\"token punctuation\">\\</span>\n    -p <span class=\"token number\">7700</span>:7700 <span class=\"token punctuation\">\\</span>\n    -v <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">pwd</span><span class=\"token variable\">)</span></span>/data.ms:/data.ms <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token assign-left variable\">MEILI_ENV</span><span class=\"token operator\">=</span>production <span class=\"token punctuation\">\\</span>\n    -e <span class=\"token assign-left variable\">MEILI_MASTER_KEY</span><span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>Your Master Key<span class=\"token operator\">></span> <span class=\"token punctuation\">\\</span>\n    getmeili/meilisearch:latest</code></pre></div>\n<p>ä¸Šé¢è¨­å®šçš„ Master Keyï¼Œå°±æ˜¯ç®¡ç†æ¬Šé™æœ€å¤§çš„ API Keyï¼Œæ‰€ä»¥è¦è¨˜å¾—å¦¥å–„ä¿å­˜ã€‚</p>\n<p>ä¸‹é¢ç”¨å‰›å‰›çš„ Master Key å»å° <code class=\"language-text\">/keys</code> åš <code class=\"language-text\">GET</code>ï¼Œç„¶å¾Œåœ¨ Headers ä¸­ï¼ŒåŠ ä¸Šå‰›å‰›çš„ Master Keyï¼Œå°±å¯ä»¥æ‹¿åˆ°é è¨­çš„æœå°‹ KEYï¼Œå’Œé è¨­çš„ ADMIN KEYã€‚å¦‚æœè¦å†å¦å¤–æ–°å¢ API KEYï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹çš„æ–‡ä»¶ï¼Œé€™è£¡å°±ä¸å¤šè‘—å¢¨ã€‚</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/91af11f7-29fc-446b-7ae1-dcb47f82b900/public\" alt=\"img\"></p>\n<h2>ç‚ºç¶²é åŠ ä¸Šæœå°‹åŠŸèƒ½</h2>\n<p>æˆ‘å€‘æœƒç”¨åˆ° MeiliSearch æä¾›çš„ <a href=\"https://github.com/meilisearch/instant-meilisearch\">Instant MeiliSearch</a>ï¼Œé€™å€‹ JS åº«å°±æ˜¯ä½¿ç”¨ Algolia çš„ Instant Search æ”¹çš„ï¼Œæ‰€ä»¥æœ‰äº›æ–‡ä»¶å¯ä»¥ç›´æ¥å»çœ‹ Algolia çš„å®˜æ–¹æ–‡ä»¶ã€‚Instant MeiliSearch æœ€ç°¡å–®çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ˜¯ç›´æ¥ç”¨ CDN çš„æ–¹å¼ï¼Œä¸‹é¢æ˜¯ä¸€å€‹æœ€ç°¡å–®çš„æ¨¡æ¿ï¼Œçœ‹æ‡‚å¾Œç”¨é¡ä¼¼çš„é‚è¼¯åŠ åˆ°è‡ªå·±çš„ç¶²é ä¸­å°±å¥½ã€‚</p>\n<p>html:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>utf-8<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>searchbox<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hits<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdn.jsdelivr.net/npm/@meilisearch/instant-meilisearch/dist/instant-meilisearch.umd.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://cdn.jsdelivr.net/npm/instantsearch.js@4<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>./app.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>ä¸‹é¢æ˜¯å‰›å‰›çš„ html æœƒç”¨åˆ°çš„ <code class=\"language-text\">app.js</code>ï¼Œç”¨ä¾†ä½œç‚º Search çš„è¨­å®šå€¼ï¼Œåªè¦æŠŠä¸‹é¢çš„ç¶²å€è¨­å®šæˆè‡ªå·±çš„ç¶²å€ï¼Œå’Œè‡ªå·±åœ¨å‰å¹¾æ­¥é©Ÿæ‹¿åˆ°çš„æœå°‹ API KEY å°±å¯ä»¥ä½¿ç”¨äº†ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> search <span class=\"token operator\">=</span> <span class=\"token function\">instantsearch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">indexName</span><span class=\"token operator\">:</span> <span class=\"token string\">\"steam-video-games\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">searchClient</span><span class=\"token operator\">:</span> <span class=\"token function\">instantMeiliSearch</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">\"https://integration-demos.meilisearch.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"q7QHwGiX841a509c8b05ef29e55f2d94c02c00635f729ccf097a734cbdf7961530f47c47\"</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nsearch<span class=\"token punctuation\">.</span><span class=\"token function\">addWidgets</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  instantsearch<span class=\"token punctuation\">.</span>widgets<span class=\"token punctuation\">.</span><span class=\"token function\">searchBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">container</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#searchbox\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  instantsearch<span class=\"token punctuation\">.</span>widgets<span class=\"token punctuation\">.</span><span class=\"token function\">hits</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">container</span><span class=\"token operator\">:</span> <span class=\"token string\">\"#hits\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">templates</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">item</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n        &lt;div>\n          &lt;div class=\"hit-name\">\n            {{#helpers.highlight}}{ \"attribute\": \"name\" }{{/helpers.highlight}}\n          &lt;/div>\n        &lt;/div>\n      </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nsearch<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>å¦‚æœè¦ºå¾—ä»–é è¨­æä¾›çš„ UI å¾ˆé†œï¼Œå¯ä»¥ç”¨ CSS çš„æ–¹å¼å»æ”¹ä»–ã€‚</p>\n<h2>GitHub Actions è‡ªå‹•æäº¤ç´¢å¼•</h2>\n<p>ä¸å»¢è©±ï¼Œç›´æ¥ä¸Šæœ¬ç«™çš„ yml:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MeiliSearch Index\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master <span class=\"token comment\"># Set a branch to deploy</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span><span class=\"token number\">20.04</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">submodules</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span> <span class=\"token comment\"># Fetch Hugo themes (true OR recursive)</span>\n          <span class=\"token key atrule\">fetch-depth</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token comment\"># Fetch all history for .GitInfo and .Lastmod</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup Node\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"14\"</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Setup Hugo\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>hugo@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">hugo-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"latest\"</span>\n          <span class=\"token key atrule\">extended</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          npm i\n          hugo --minify</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Post Index\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          curl \\\n            -X POST \"https://search.tonypepe.com/indexes/hugo_blog/documents\" \\\n            -H 'Authorization: Bearer ${{ secrets.MEILISEARCH_KEY }}' \\\n            -H 'Content-Type: application/json' \\\n            --data-binary \"@public/searchindex.json\"</span></code></pre></div>\n<p>å…¶å¯¦é‡é»å°±æ˜¯åœ¨æœ€å¾Œä¸€æ­¥ï¼ŒæŠŠç´¢å¼•æª”æ¡ˆ POST åˆ° MeiliSearch å°±å¯ä»¥äº†ã€‚</p>\n<h2>Referenc</h2>\n<ul>\n<li><a href=\"https://meilisearch.com\">MeiliSearch</a></li>\n<li><a href=\"https://discourse.gohugo.io/t/a-simple-javascript-based-full-text-search-function/29119\">A simple javascript based full text search function</a></li>\n<li><a href=\"https://hoppspot.io\">Hoppsotch</a></li>\n<li><a href=\"https://github.com/meilisearch/instant-meilisearch\">Instant MeiliSearch</a></li>\n</ul>","rawMarkdownBody":"\nèªªåˆ°æœå°‹çš„è§£æ±ºæ–¹æ¡ˆï¼Œæœ€æœ‰åçš„å¤§æ¦‚å°±æ˜¯ [Algolia](https://www.algolia.com/)ï¼Œå¯ä»¥æ–¹ä¾¿çš„å‰µå»ºç´¢å¼•ï¼Œä¹Ÿæœ‰å¾ˆå¤šå¯«å¥½çš„å‰ç«¯ç¶²é å…ƒä»¶å¯ä»¥ä½¿ç”¨ï¼Œå”¯ä¸€çš„ç¼ºé»å°±æ˜¯æ”¶è²»ã€‚é›–ç„¶ Algolia è¦æ”¶è²»ï¼Œä½†å…¶å¯¦å°æ–¼æˆ‘é€™å€‹å°ç¶²é éƒ½ç´¢å¼•é‡æ˜¯å®Œå…¨ä¸ç”¨éŒ¢çš„ï¼Œä½†æ˜¯å°±é‚„æ˜¯è¦ºå¾—è‡ªå·±æ¶ä¸€å€‹ç´¢å¼•ç³»çµ±æ¯”è¼ƒæœ‰æ„Ÿè¦ºï¼Œç„¶å¾Œæˆ‘å°±åœ¨ GitHub ä¸Šç™¼ç¾äº†é–‹æºçš„ [MeiliSearch](https://meilisearch.com)ï¼ŒåŠŸèƒ½åŸºæœ¬ä¸Šè·Ÿ Algolia å¾ˆåƒï¼Œä¹Ÿæ”¯æ´ä¸­æ–‡ï¼Œç”šè‡³æœ‰äº›å‰ç«¯å…ƒä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ Algolia çš„ï¼Œç¼ºé»å°±æ˜¯è¦è‡ªå·±æ¶è¨­ Serverã€‚\n\n<!--more-->\n\næœ¬æ–‡ä»¥æœå°‹æœ¬ç«™ç‚ºç›®çš„æ’°å¯«ï¼Œæ‰€ä»¥å¾Œé¢çš„ç¯„ä¾‹å¤§å¤šèˆ‡ Hugo ç›¸é—œï¼Œå¦‚æœæƒ³è¦çœ‹å®Œæ•´çš„ç¨‹å¼ç¢¼ï¼Œå¯ä»¥ç›´æ¥åˆ°æœ¬ç«™çš„ GitHubã€‚\n\n## ç°¡ä»‹ MeiliSearch Server\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/f93885e8-f670-44ec-ea24-264a97c9a500/public)\n\nåŸºæœ¬ä¸Š MeiliSearch å°±æ˜¯ä¸€å€‹ RESTful APIï¼Œç›®æ¨™æ˜¯è¦æä¾›ç¾æˆçš„æœå°‹è§£æ±ºæ–¹æ¡ˆï¼Œå®Œå…¨é–‹æºï¼Œæä¾›å³æ™‚æœå°‹ã€æ‹¼å¯«éŒ¯èª¤ã€åŒç¾©è©ã€æ¨¡ç³Šæœå°‹ã€è‡ªè¨‚æ’åã€æ’åºå’Œå¤šèªè¨€æœå°‹çš„æ”¯æ´ï¼Œé€£ä¸­æ–‡ä¹Ÿä¸ä¾‹å¤–ã€‚æ ¹æ“šå®˜æ–¹æ–‡ä»¶çš„ä»‹ç´¹ï¼ŒMeiliSearch ä»¥æ˜“ç”¨æ€§ç‚ºé¦–è¦ç›®æ¨™ï¼Œå°æ–¼é–‹ç™¼è€…ï¼Œåªéœ€è¦å°‘å°‘å¹¾è¡Œ code å°±å¯ä»¥ä½¿ç”¨ï¼›å°æ–¼ä½¿ç”¨è€…ï¼Œæä¾›ç›´è§€çš„å³æ™‚è¼¸å…¥å³æ™‚åæ‡‰çš„æœå°‹çµæœã€‚\n\nå®˜æ–¹ä¹Ÿæœ‰å¾ˆå¤šçš„ SDKï¼Œ.NET, Dart, Go, Java, JS, Python, Swiftï¼Œè€Œä¸”ä¸Šé¢é€™äº›é‚„ä¸æ˜¯å…¨éƒ¨ï¼Œæ‰€ä»¥åœ¨é–‹ç™¼å„èªè¨€çš„æ‡‰ç”¨ç¨‹å¼æ™‚ï¼Œéƒ½å¯ä»¥è€ƒæ…®ç”¨ MeiliSearch åšç‚ºå¾Œç«¯æœå°‹å¼•æ“ã€‚\n\nMeiliSearch ä¹Ÿä¸æ˜¯å®Œå…¨æ²’æœ‰ç¼ºé»ï¼Œç¼ºé»å°±æ˜¯è¦è‡ªå·±æœ‰ä¼ºæœå™¨ï¼Œåƒæ˜¯æœ¬æ–‡ä»Šå¤©çš„æ¡ˆä¾‹å°±æ˜¯è¦å¹« Static Site åšæœå°‹çš„åŠŸèƒ½ï¼Œé€šå¸¸ Static Site å¤§å®¶æ‡‰è©²éƒ½æ˜¯ç”¨ GitHub Pages ç­‰ Statice Site Hosting æœå‹™ï¼Œæ‰€ä»¥ç¶²é æœ¬èº«æ˜¯æ²’æœ‰è‡ªå·±æ¶ Server çš„ï¼Œç‚ºäº†åŠ å€‹æœå°‹åŠŸèƒ½æœƒè¦å¤šä¸€å€‹ Server å°±æ˜¯å¾ˆå¤§çš„ç¼ºé»ã€‚\n\n## SearchIndex.json\n\nåœ¨é–‹å§‹ä½¿ç”¨ MeiliSearch ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†æŠŠè¦ç´¢å¼•çš„è³‡æ–™æº–å‚™å¥½ï¼ŒMeiliSearch æœƒéœ€è¦ä½¿ç”¨ json ç•¶ä½œç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘å€‘è¦ç”¢ç”Ÿä¸€å€‹ json çš„ç¯„æœ¬ã€‚å‰µå»º `/layouts/list.searchindex.json`ï¼Œå…§å®¹å¦‚ä¸‹ï¼š\n\n```text\n[ {{- $i := 0 -}}\n    {{- range where .Site.RegularPages \"Section\" \"ne\" \"\" -}}\n       {{- if not .Params.noSearch -}}\n          {{- if gt $i 0 }},{{ end -}}\n          {\"id\":{{ $i }}, \"date\":\"{{ .Date.Unix }}\", \"url\":\"{{ .Permalink }}\", \"title\":{{ .Title | jsonify  }}, \"summary\":{{ with .Description}}{{ . | plainify | jsonify }}{{ else }}{{ .Summary | plainify | jsonify }}{{ end }}, \"content\":{{ .Content | plainify | jsonify }},\"tags\":[ {{- $t := 0 }}{{- range .Param \"tags\" -}}{{ if gt $t 0 }},{{ end }}{{ . | jsonify }}{{ $t = add $t 1 }}{{ end -}} ], \"section\": {{ .Section | jsonify -}} }\n        {{- $i = add $i 1 -}}\n    {{- end -}}\n{{- end -}} ]\n```\n\nç„¶å¾Œåœ¨ `config.yaml` ä¸­åŠ å…¥ä¸‹é¢çš„è¨­å®šå€¼ï¼š\n\n```yaml\noutputFormats:\n  SearchIndex:\n    mediaType: \"application/json\"\n    baseName: \"searchindex\"\n    isPlainText: true\n    notAlternative: true\noutputs:\n  home: [\"HTML\", \"RSS\", \"SearchIndex\"]\n```\n\nå®Œæˆä¸Šé¢å…©æ¨£è¨­å®šå¾Œï¼Œå¯ä»¥ `hugo` ä¸€ä¸‹è©¦è©¦çœ‹ï¼Œæœ‰æ²’æœ‰åœ¨ `/public/searchindex.json` ä¸­çœ‹åˆ°ç´¢å¼•æª”æ¡ˆï¼Œæ‡‰è©²æœƒé¡ä¼¼å¦‚ä¸‹ï¼š\n\n```json\n[\n  {\n    \"id\": 0,\n    \"date\": \"1622891718\",\n    \"url\": \"https://tonypepe.com/posts/others/hello-world/\",\n    \"title\": \"Hello World\",\n    \"summary\": \"Hello World. This is a test post.\",\n    \"content\": \"This is my first post in hugo\\ncontent\",\n    \"tags\": [\"hugo\", \"test\"],\n    \"section\": \"posts\"\n  }\n]\n```\n\n## æ¶è¨­ MeiliSearch Server\n\næº–å‚™å¥½ç´¢å¼•æª”æ¡ˆå¾Œï¼Œæˆ‘å€‘å°±ä¾†æ¶è¨­ MeiliSearch çš„ Serverï¼ŒMeiliSearch æ˜¯ç”¨ Rust ç·¨å¯«ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯è·¨å¹³å°é€šç”¨ã€‚å®˜æ–¹æä¾›å¾ˆå¤šç¨®å®‰è£æ–¹å¼ï¼Œé‚„æœ‰ä¸€éµå•Ÿå‹•è…³æœ¬ï¼Œç•¶ç„¶ï¼Œç‚ºäº†é¿å…å¼„é«’ç’°å¢ƒï¼Œæœ€æ¨è–¦çš„ç•¶ç„¶é‚„æ˜¯ Dockerï¼Œä¸‹é¢å°±å…ˆä»¥ Docker ç‚ºç¯„ä¾‹ï¼š\n\n```bash\ndocker run -it --rm \\\n    -p 7700:7700 \\\n    -v $(pwd)/data.ms:/data.ms \\\n    getmeili/meilisearch:latest\n```\n\næ³¨æ„ä¸€ä¸‹ï¼Œä¸Šé¢æ›è¼‰äº†ä¸€å€‹ `data.ms` çš„è³‡æ–™å¤¾ï¼Œæ‰€ä»¥åœ¨åŸ·è¡Œä¸Šé¢çš„æŒ‡ä»¤å‰ï¼Œè¨˜å¾—å…ˆå‰µå»ºå¥½ã€‚`data.ms` é€™å€‹è³‡æ–™å¤¾æ˜¯ç‚ºäº†å­˜æ”¾ç´¢å¼•è³‡æ–™ï¼Œé¿å…å› ç‚º Docker å®¹å™¨é‡å•Ÿå°±æå¤±è³‡æ–™ï¼Œæ‰€ä»¥å¾ˆé‡è¦ã€‚\n\nç¾åœ¨å¯ä»¥åˆ° [http://localhost:7700](http://localhost:7700)ï¼Œæœƒçœ‹åˆ°æœ‰ä¸€å€‹ç°¡æ˜“çš„ WEB UIã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/5664dc51-5d55-415a-3633-ac45e17d7a00/public)\n\nå¦‚æœä¸æƒ³ç”¨ Dockerï¼Œé‚„æ˜¯å¯ä»¥åƒè€ƒå®˜æ–¹æ–‡ä»¶çš„å…¶ä»–å®‰è£æ–¹å¼å®‰è£ã€‚\n\n## æäº¤ç´¢å¼•è³‡æ–™\n\nå‰é¢æœ‰æåˆ° MeiliSearch æ˜¯ RESTful APIï¼Œæ‰€ä»¥è¦å‘ä»–æœå°‹æˆ–æ˜¯æä¾›è³‡æ–™ï¼Œéƒ½æ˜¯ç”¨ HTTP Methodã€‚å®˜æ–¹æ–‡ä»¶å¯«çš„éƒ½æ˜¯ curlï¼Œæˆ‘å€‘é‚„æ˜¯ä½¿ç”¨ GUI çš„æ–¹å¼ä»‹ç´¹ã€‚HTTP çš„ GUI å¤§å®¶æ‡‰è©²éƒ½æœƒæƒ³åˆ° Postmanï¼Œä½†ä»Šå¤©æˆ‘å€‘è¦ä½¿ç”¨ä»–çš„é–‹æºæ›¿ä»£ [Hoppsotch](https://hoppspot.io)ï¼Œä»–æ˜¯ä¸€å€‹ç¶²é å·¥å…·ï¼Œæ‰€ä»¥ä¸éœ€è¦å®‰è£ã€‚\n\nå¯ä»¥å…ˆå° `/health` åš `GET` è©¦è©¦çœ‹æœ‰æ²’æœ‰é€£ä¸Šï¼Œå¦‚æœæ²’æœ‰é€£ä¸Šï¼Œå¯èƒ½è¦æª¢æŸ¥ä¸€ä¸‹æœ‰æ²’æœ‰æˆåŠŸå•Ÿå‹• MeiliSearch Serverã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/cf86e106-a1f6-472e-d2c1-a6b186944f00/public)\n\nç¢ºå®šé€£ä¸Šå¾Œï¼Œæˆ‘å€‘å°±ä¾†æäº¤ç´¢å¼•è³‡æ–™ï¼Œå¦‚æœé‚„æ²’æœ‰ Hugo ç”¢ç”Ÿçš„ç´¢å¼•è³‡æ–™ï¼Œå¯ä»¥å…ˆåˆ°æœ¬ç«™çš„ GitHubï¼Œæ‹¿æœ¬ç«™çš„ [searchindex.json](https://github.com/TonyPepeBear/HugoBlog/blob/1bfae9859a44338d24a9f6676be37f72cc983505/searchindex.json) åšæ¸¬è©¦ã€‚\n\nå› ç‚º MeiliSearch ä¹Ÿå¯ä»¥åŒæ™‚æœ‰å¤šå€‹ Indexes åšæœå°‹ï¼Œæˆ‘å€‘ä¸‹é¢çš„ç¯„ä¾‹ä»¥ `hugo_blog` ä½œç‚ºç¯„ä¾‹åç¨±ï¼Œå¤§å®¶å¯ä»¥æ ¹æ“šéœ€æ±‚è‡ªå·±æ±ºå®šä½¿ç”¨çš„åç¨±ã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/71797a57-6f97-44cd-f4dc-675ec42ffd00/public)\n\nå¯ä»¥çœ‹åˆ°ä¸Šåœ–å° `/indexes/<<IndexName>>/documents` åš `POST` æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠç´¢å¼•è³‡æ–™æäº¤åˆ° MeiliSearch Serverã€‚è¨˜å¾—å…§å®¹é¡å‹æ˜¯ `application/json`ï¼Œç„¶å¾ŒæŠŠç´¢å¼•è³‡æ–™æ”¾åˆ° bodyã€‚\n\nç¾åœ¨å›åˆ° [localhost:7700](http://localhost:7700)ï¼Œæ‡‰è©²å°±å¯ä»¥çœ‹åˆ°åŸæœ¬ç©ºç©ºå¦‚ä¹Ÿçš„ WEB UI ç¾åœ¨å¯ä»¥åšæœå°‹äº†ï¼Œå¯ä»¥å…ˆåœ¨é€™è£¡åšä¸€äº›ç°¡å–®çš„æœå°‹ï¼Œè©¦è©¦çœ‹è‡ªå·±çš„ç´¢å¼•è³‡æ–™æœ‰æ²’æœ‰è¢«æˆåŠŸçš„ä½¿ç”¨ã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/c58970b0-53b5-4a16-50bb-ff40fa6fde00/public)\n\n## MeiliSearch in Production\n\nMeiliSearch é è¨­çš„å•Ÿå‹•æ–¹å¼å…¶å¯¦æ˜¯ `development`ï¼Œé€™æ¨¡å¼åªæ˜¯æ–¹ä¾¿æœ¬åœ°åšæ¸¬è©¦ä½¿ç”¨çš„ï¼Œå¦‚æœè¦ä½¿ç”¨åœ¨ç”Ÿç”¢ç’°å¢ƒï¼Œæ‡‰è©²è¦ä»¥ `production` æ¨¡å¼å•Ÿå‹•ã€‚åœ¨ Production æ¨¡å¼ä¸‹ï¼Œæœƒæœ‰å…©å€‹ä¸ä¸€æ¨£çš„åœ°æ–¹ï¼Œç¬¬ä¸€é …æ˜¯ Web UI æœƒè¢«åœç”¨ï¼Œç¬¬äºŒé …æ˜¯æœƒå¿…é ˆè¦è¨­å®š `Master Key`ï¼Œä¸‹é¢é‚„æ˜¯ç”¨ Docker ä½œç‚ºç¯„ä¾‹ï¼š\n\n```bash\ndocker run -it --rm \\\n    -p 7700:7700 \\\n    -v $(pwd)/data.ms:/data.ms \\\n    -e MEILI_ENV=production \\\n    -e MEILI_MASTER_KEY=<Your Master Key> \\\n    getmeili/meilisearch:latest\n```\n\nä¸Šé¢è¨­å®šçš„ Master Keyï¼Œå°±æ˜¯ç®¡ç†æ¬Šé™æœ€å¤§çš„ API Keyï¼Œæ‰€ä»¥è¦è¨˜å¾—å¦¥å–„ä¿å­˜ã€‚\n\nä¸‹é¢ç”¨å‰›å‰›çš„ Master Key å»å° `/keys` åš `GET`ï¼Œç„¶å¾Œåœ¨ Headers ä¸­ï¼ŒåŠ ä¸Šå‰›å‰›çš„ Master Keyï¼Œå°±å¯ä»¥æ‹¿åˆ°é è¨­çš„æœå°‹ KEYï¼Œå’Œé è¨­çš„ ADMIN KEYã€‚å¦‚æœè¦å†å¦å¤–æ–°å¢ API KEYï¼Œå¯ä»¥åƒè€ƒå®˜æ–¹çš„æ–‡ä»¶ï¼Œé€™è£¡å°±ä¸å¤šè‘—å¢¨ã€‚\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/91af11f7-29fc-446b-7ae1-dcb47f82b900/public)\n\n## ç‚ºç¶²é åŠ ä¸Šæœå°‹åŠŸèƒ½\n\næˆ‘å€‘æœƒç”¨åˆ° MeiliSearch æä¾›çš„ [Instant MeiliSearch](https://github.com/meilisearch/instant-meilisearch)ï¼Œé€™å€‹ JS åº«å°±æ˜¯ä½¿ç”¨ Algolia çš„ Instant Search æ”¹çš„ï¼Œæ‰€ä»¥æœ‰äº›æ–‡ä»¶å¯ä»¥ç›´æ¥å»çœ‹ Algolia çš„å®˜æ–¹æ–‡ä»¶ã€‚Instant MeiliSearch æœ€ç°¡å–®çš„ä½¿ç”¨æ–¹å¼ä¹Ÿæ˜¯ç›´æ¥ç”¨ CDN çš„æ–¹å¼ï¼Œä¸‹é¢æ˜¯ä¸€å€‹æœ€ç°¡å–®çš„æ¨¡æ¿ï¼Œçœ‹æ‡‚å¾Œç”¨é¡ä¼¼çš„é‚è¼¯åŠ åˆ°è‡ªå·±çš„ç¶²é ä¸­å°±å¥½ã€‚\n\nhtml:\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\" />\n  </head>\n\n  <body>\n    <div>\n      <div id=\"searchbox\"></div>\n      <div id=\"hits\"></div>\n    </div>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/@meilisearch/instant-meilisearch/dist/instant-meilisearch.umd.min.js\"></script>\n    <script src=\"https://cdn.jsdelivr.net/npm/instantsearch.js@4\"></script>\n    <script src=\"./app.js\"></script>\n  </body>\n</html>\n```\n\nä¸‹é¢æ˜¯å‰›å‰›çš„ html æœƒç”¨åˆ°çš„ `app.js`ï¼Œç”¨ä¾†ä½œç‚º Search çš„è¨­å®šå€¼ï¼Œåªè¦æŠŠä¸‹é¢çš„ç¶²å€è¨­å®šæˆè‡ªå·±çš„ç¶²å€ï¼Œå’Œè‡ªå·±åœ¨å‰å¹¾æ­¥é©Ÿæ‹¿åˆ°çš„æœå°‹ API KEY å°±å¯ä»¥ä½¿ç”¨äº†ï¼š\n\n```js\nconst search = instantsearch({\n  indexName: \"steam-video-games\",\n  searchClient: instantMeiliSearch(\n    \"https://integration-demos.meilisearch.com\",\n    \"q7QHwGiX841a509c8b05ef29e55f2d94c02c00635f729ccf097a734cbdf7961530f47c47\"\n  ),\n});\n\nsearch.addWidgets([\n  instantsearch.widgets.searchBox({\n    container: \"#searchbox\",\n  }),\n  instantsearch.widgets.hits({\n    container: \"#hits\",\n    templates: {\n      item: `\n        <div>\n          <div class=\"hit-name\">\n            {{#helpers.highlight}}{ \"attribute\": \"name\" }{{/helpers.highlight}}\n          </div>\n        </div>\n      `,\n    },\n  }),\n]);\n\nsearch.start();\n```\n\nå¦‚æœè¦ºå¾—ä»–é è¨­æä¾›çš„ UI å¾ˆé†œï¼Œå¯ä»¥ç”¨ CSS çš„æ–¹å¼å»æ”¹ä»–ã€‚\n\n## GitHub Actions è‡ªå‹•æäº¤ç´¢å¼•\n\nä¸å»¢è©±ï¼Œç›´æ¥ä¸Šæœ¬ç«™çš„ yml:\n\n```yml\nname: MeiliSearch Index\n\non:\n  push:\n    branches:\n      - master # Set a branch to deploy\n\njobs:\n  deploy:\n    runs-on: ubuntu-20.04\n    steps:\n      - uses: actions/checkout@v2\n        with:\n          submodules: true # Fetch Hugo themes (true OR recursive)\n          fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod\n\n      - name: Setup Node\n        uses: actions/setup-node@v2\n        with:\n          node-version: \"14\"\n\n      - name: Setup Hugo\n        uses: peaceiris/actions-hugo@v2\n        with:\n          hugo-version: \"latest\"\n          extended: true\n\n      - name: Build\n        run: |\n          npm i\n          hugo --minify\n\n      - name: Post Index\n        run: |\n          curl \\\n            -X POST \"https://search.tonypepe.com/indexes/hugo_blog/documents\" \\\n            -H 'Authorization: Bearer ${{ secrets.MEILISEARCH_KEY }}' \\\n            -H 'Content-Type: application/json' \\\n            --data-binary \"@public/searchindex.json\"\n```\n\nå…¶å¯¦é‡é»å°±æ˜¯åœ¨æœ€å¾Œä¸€æ­¥ï¼ŒæŠŠç´¢å¼•æª”æ¡ˆ POST åˆ° MeiliSearch å°±å¯ä»¥äº†ã€‚\n\n## Referenc\n\n- [MeiliSearch](https://meilisearch.com)\n- [A simple javascript based full text search function](https://discourse.gohugo.io/t/a-simple-javascript-based-full-text-search-function/29119)\n- [Hoppsotch](https://hoppspot.io)\n- [Instant MeiliSearch](https://github.com/meilisearch/instant-meilisearch)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/Web/MeiliSearch-hugo.md","excerpt":"èªªåˆ°æœå°‹çš„è§£æ±ºæ–¹æ¡ˆï¼Œæœ€æœ‰åçš„å¤§æ¦‚å°±æ˜¯ Algoliaï¼Œå¯ä»¥æ–¹ä¾¿çš„å‰µå»ºç´¢å¼•ï¼Œä¹Ÿæœ‰å¾ˆå¤šå¯«å¥½çš„å‰ç«¯ç¶²é å…ƒä»¶å¯ä»¥ä½¿ç”¨ï¼Œå”¯ä¸€çš„ç¼ºé»å°±æ˜¯æ”¶è²»ã€‚é›–ç„¶ Algolia è¦æ”¶è²»ï¼Œä½†å…¶å¯¦å°æ–¼æˆ‘é€™å€‹å°ç¶²é éƒ½ç´¢å¼•é‡æ˜¯å®Œå…¨ä¸ç”¨éŒ¢çš„ï¼Œä½†æ˜¯å°±é‚„æ˜¯è¦ºå¾—è‡ªå·±æ¶ä¸€å€‹ç´¢å¼•ç³»çµ±æ¯”è¼ƒæœ‰æ„Ÿè¦ºï¼Œç„¶å¾Œæˆ‘å°±åœ¨ GitHub ä¸Šç™¼ç¾äº†é–‹æºçš„ MeiliSearchï¼ŒåŠŸèƒ½åŸºæœ¬ä¸Šè·Ÿ Algolia å¾ˆåƒï¼Œä¹Ÿæ”¯æ´ä¸­æ–‡ï¼Œç”šè‡³æœ‰äº›å‰ç«¯å…ƒä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ Alâ€¦","frontmatter":{"title":"MeiliSearch with Hugo","date":"2022-01-17T17:40:09.000Z","draft":false,"tags":["meilisearch","search","web","hugo","github","actions"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/f9f8be53-5393-4190-b6da-baf27d8a7500/public","description":null}}},{"node":{"id":"7344f3d5-18b8-56c7-8a29-887c8c755a3a","html":"<p>GitHub ä¸Šæœ‰è¨±è¨±å¤šå¤šé–‹æºçš„ iconï¼Œä½†æ˜¯æ¯å€‹ç”¨æ³•ä¸ç›¡ç›¸åŒï¼Œç”šè‡³å¤§éƒ¨åˆ†çš„ä½¿ç”¨æ–¹å¼ï¼Œéƒ½æ˜¯ç›´æ¥ä¸‹è¼‰ SVG ä½¿ç”¨ã€‚é›–ç„¶ä½¿ç”¨ SVG ä¹Ÿä¸æ˜¯ä¸å¥½ï¼Œä½†æ˜¯å°±æœƒéœ€è¦è‡ªå·±å¤šä¸€æ­¥é©Ÿçš„ä½¿ç”¨ã€‚Iconify æŠŠè¨±å¤š icon æ•´åˆåœ¨ä¸€èµ·ï¼Œä¸¦ä¸”æä¾›éå¸¸ç°¡å–®çš„è¾¦æ³•ï¼Œå°±å¯ä»¥è®“ç¶²é æœ‰å¾ˆç²¾ç¾çš„ iconã€‚</p>\n<!--more-->\n<h2>ä½¿ç”¨ Iconify</h2>\n<p>ä½¿ç”¨ Iconify åªéœ€è¦å…ˆåœ¨ HTML ä¸­å¼•å…¥ Iconify çš„ Scriptï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://code.iconify.design/2/2.1.0/iconify.min.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>æ¥ä¸‹ä¾†åªéœ€è¦åœ¨è¦ä½¿ç”¨ icon çš„åœ°æ–¹ï¼Œæ–°å¢ä¸€å€‹ spanï¼Œå…¶ä¸­è¦æœ‰åŒ…å« <code class=\"language-text\">class=\"iconify\"</code> å’Œ <code class=\"language-text\">data-icon</code>ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>iconify<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">data-icon</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>fa:home<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>æ­£ç¢ºä½¿ç”¨å¾Œï¼Œæ‡‰è©²å°±å¯ä»¥åœ¨ç¶²é ä¸­æ­£ç¢ºçš„é¡¯ç¤ºä¸‹é¢çš„ iconï¼š</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/f0141e02-3e26-415d-1ee2-438dc4d43600/public\" alt=\"img\"></p>\n<h2>æœå°‹ Icon</h2>\n<p>å°±åƒå‰é¢èªªçš„ï¼ŒIconify æä¾›éå¸¸å¤šçš„ iconï¼Œæ‰€ä»¥ä½œè€…ä¹Ÿæœ‰å¯«ä¸€å€‹å¯ä»¥æœå°‹åœ–æ¨™çš„åœ°æ–¹ï¼Œè€Œä¸”æœå°‹åˆ°åœ–æ¨™å¾Œï¼Œé‚„æä¾›è¨±å¤šå¯ä»¥å”åŠ©å®¢è£½åŒ–åœ–æ¨™çš„æ–¹æ³•ï¼š</p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/44c38b28-baa8-4faa-6d06-8e2615f19500/public\" alt=\"img\"></p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/c330c161-f8b4-41d2-db15-b02079185b00/public\" alt=\"\"></p>\n<p><img src=\"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/f0141e02-3e26-415d-1ee2-438dc4d43600/public\" alt=\"img\"></p>\n<p>å¦‚æœçœŸçš„ä¸æƒ³ä½¿ç”¨ Iconify çš„æ–¹å¼é¡¯ç¤ºåœ–æ¨™ï¼Œä¹Ÿå¯ä»¥å–®ç´”çš„ç•¶ä½œåœ–æ¨™è’å°‹å™¨ï¼Œæœå°‹åˆ°ä¹‹å¾Œç›´æ¥ä¸‹è¼‰ SVG ä½¿ç”¨å³å¯ã€‚</p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://iconify.design/\">Iconify</a></li>\n</ul>","rawMarkdownBody":"\nGitHub ä¸Šæœ‰è¨±è¨±å¤šå¤šé–‹æºçš„ iconï¼Œä½†æ˜¯æ¯å€‹ç”¨æ³•ä¸ç›¡ç›¸åŒï¼Œç”šè‡³å¤§éƒ¨åˆ†çš„ä½¿ç”¨æ–¹å¼ï¼Œéƒ½æ˜¯ç›´æ¥ä¸‹è¼‰ SVG ä½¿ç”¨ã€‚é›–ç„¶ä½¿ç”¨ SVG ä¹Ÿä¸æ˜¯ä¸å¥½ï¼Œä½†æ˜¯å°±æœƒéœ€è¦è‡ªå·±å¤šä¸€æ­¥é©Ÿçš„ä½¿ç”¨ã€‚Iconify æŠŠè¨±å¤š icon æ•´åˆåœ¨ä¸€èµ·ï¼Œä¸¦ä¸”æä¾›éå¸¸ç°¡å–®çš„è¾¦æ³•ï¼Œå°±å¯ä»¥è®“ç¶²é æœ‰å¾ˆç²¾ç¾çš„ iconã€‚\n\n<!--more-->\n\n## ä½¿ç”¨ Iconify\n\nä½¿ç”¨ Iconify åªéœ€è¦å…ˆåœ¨ HTML ä¸­å¼•å…¥ Iconify çš„ Scriptï¼š\n\n```html\n<script src=\"https://code.iconify.design/2/2.1.0/iconify.min.js\"></script>\n```\n\næ¥ä¸‹ä¾†åªéœ€è¦åœ¨è¦ä½¿ç”¨ icon çš„åœ°æ–¹ï¼Œæ–°å¢ä¸€å€‹ spanï¼Œå…¶ä¸­è¦æœ‰åŒ…å« `class=\"iconify\"` å’Œ `data-icon`ï¼š\n\n```html\n<span class=\"iconify\" data-icon=\"fa:home\"></span>\n```\n\næ­£ç¢ºä½¿ç”¨å¾Œï¼Œæ‡‰è©²å°±å¯ä»¥åœ¨ç¶²é ä¸­æ­£ç¢ºçš„é¡¯ç¤ºä¸‹é¢çš„ iconï¼š\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/f0141e02-3e26-415d-1ee2-438dc4d43600/public)\n\n## æœå°‹ Icon\n\nå°±åƒå‰é¢èªªçš„ï¼ŒIconify æä¾›éå¸¸å¤šçš„ iconï¼Œæ‰€ä»¥ä½œè€…ä¹Ÿæœ‰å¯«ä¸€å€‹å¯ä»¥æœå°‹åœ–æ¨™çš„åœ°æ–¹ï¼Œè€Œä¸”æœå°‹åˆ°åœ–æ¨™å¾Œï¼Œé‚„æä¾›è¨±å¤šå¯ä»¥å”åŠ©å®¢è£½åŒ–åœ–æ¨™çš„æ–¹æ³•ï¼š\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/44c38b28-baa8-4faa-6d06-8e2615f19500/public)\n\n![](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/c330c161-f8b4-41d2-db15-b02079185b00/public)\n\n![img](https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/f0141e02-3e26-415d-1ee2-438dc4d43600/public)\n\nå¦‚æœçœŸçš„ä¸æƒ³ä½¿ç”¨ Iconify çš„æ–¹å¼é¡¯ç¤ºåœ–æ¨™ï¼Œä¹Ÿå¯ä»¥å–®ç´”çš„ç•¶ä½œåœ–æ¨™è’å°‹å™¨ï¼Œæœå°‹åˆ°ä¹‹å¾Œç›´æ¥ä¸‹è¼‰ SVG ä½¿ç”¨å³å¯ã€‚\n\n## Reference\n\n- [Iconify](https://iconify.design/)\n","fileAbsolutePath":"/home/runner/work/Blog/Blog/src/posts/Web/iconify.md","excerpt":"GitHub ä¸Šæœ‰è¨±è¨±å¤šå¤šé–‹æºçš„ iconï¼Œä½†æ˜¯æ¯å€‹ç”¨æ³•ä¸ç›¡ç›¸åŒï¼Œç”šè‡³å¤§éƒ¨åˆ†çš„ä½¿ç”¨æ–¹å¼ï¼Œéƒ½æ˜¯ç›´æ¥ä¸‹è¼‰ SVG ä½¿ç”¨ã€‚é›–ç„¶ä½¿ç”¨ SVG ä¹Ÿä¸æ˜¯ä¸å¥½ï¼Œä½†æ˜¯å°±æœƒéœ€è¦è‡ªå·±å¤šä¸€æ­¥é©Ÿçš„ä½¿ç”¨ã€‚Iconify æŠŠè¨±å¤š icon æ•´åˆåœ¨ä¸€èµ·ï¼Œä¸¦ä¸”æä¾›éå¸¸ç°¡å–®çš„è¾¦æ³•ï¼Œå°±å¯ä»¥è®“ç¶²é æœ‰å¾ˆç²¾ç¾çš„ iconã€‚ ä½¿ç”¨ Iconify ä½¿ç”¨ Iconify åªéœ€è¦å…ˆåœ¨ HTML ä¸­å¼•å…¥ Iconify çš„ Scriptï¼š æ¥ä¸‹â€¦","frontmatter":{"title":"Iconify -- icon å¤§ç¦®åŒ…","date":"2022-01-14T13:48:25.000Z","draft":false,"tags":["icon","web","ios","android","design"],"image":"https://imagedelivery.net/cdkaXPuFls5qlrh3GM4hfA/ca9b8ae2-b684-421a-a662-2dd4356ce600/public","description":null}}}]}},"pageContext":{"limit":8,"skip":0,"numPages":4,"currentPage":1}},"staticQueryHashes":[]}